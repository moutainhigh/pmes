!function(e){"use strict";e.module("PMES2",["CONSTANTS","DIRECTIVES","COMPONENTS","SERVICES","MODALS","FILTERS","SIDEBAR","Expert","Statistics","Dashboard","Message","System","Configuration","Patent","Enterprise","ProcessOrder","Search","ElSearch","Instance","toaster","ngAnimate","ngRoute","ui.router","ui.router.state.events","ngSanitize","ui.select"]).config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]).factory("AuthInterceptor",["$rootScope","$q","$log","GLOBAL_EVENTS",function(t,n,r,a){return{responseError:function(r){var o=r.data;return!e.isObject(o)||401!==r.status&&403!==r.status&&500!==r.status||t.$broadcast({401:a.UnAuthenticated,403:a.UnAuthorized,500:a.ServerException}[r.status],r),n.reject(r)}}}]).config(["$httpProvider",function(e){e.interceptors.push("AuthInterceptor"),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}])}(angular),function(e,t,n){"use strict";function r(t,n){var r=e.element("#js_tree"),a=this;a.createTree=function(){var t=["unique","search"];a.checkbox&&t.push("checkbox"),r.on("select_node.jstree",function(e,t){var n=t.selected[0];a.onNodeSelected&&a.onNodeSelected({id:n})}).on("ready.jstree",function(e,t){a.onInitDone&&a.onInitDone({tree:r,controller:a})}).on("refresh.jstree",function(t,n){if(a.checkbox&&a.checkedNodes){var o=r.jstree(!0);e.forEach(a.checkedNodes,function(e){o.check_node(e)})}}).jstree({core:{multiple:!!a.checkbox,check_callback:!0,themes:{stripes:!1,dots:!1,responsive:!0},data:a.nodes},force_text:!0,plugins:t})},a.destroy=function(){var e=r.jstree(!0);e&&e.destroy()},a.$onInit=function(){a.createTree()},a.$onDestroy=function(){a.destroy()},a.refresh=function(){r.jstree(!0).settings&&(r.jstree(!0).settings.core.data=a.nodes,r.jstree(!0).refresh())}}function a(e,t){var r=this;r.setOption=function(){var e=document.getElementById("echarts_container");$(e).css("width",r.width||"420px"),$(e).css("height",r.height||"400px"),r.chart||(r.chart=n.init(e));var t={tooltip:{trigger:"item",triggerOn:"mousemove"},series:[{type:"tree",top:"1%",left:"7%",bottom:"1%",right:"20%",symbolSize:10,symbol:"circle",initialTreeDepth:-1,itemStyle:{borderColor:"#ccc"},label:{normal:{position:"bottom",verticalAlign:"middle",align:"left",fontSize:12}},leaves:{label:{normal:{position:"right",verticalAlign:"middle",align:"left",fontSize:12}}},data:[r.tree],expandAndCollapse:!1,animation:!0,animationDuration:300,animationDurationUpdate:300}]};r.chart.clear(),r.chart.setOption(t,!0),r.chart.resize()},r.showLoading=function(){r.chart&&r.chart.showLoading()},r.hideLoading=function(){r.chart&&r.chart.hideLoading()},r.$onInit=function(){r.setOption(),r.onChartCtrlAware&&r.onChartCtrlAware({ctrl:r}),r.chart&&r.chart.on("click",function(n){t.log("params",n),r.onTreeSelected&&e.$apply(function(){r.onTreeSelected({label:n.data})})})}}e.module("COMPONENTS",["CONSTANTS","Configuration"]).component("jsTree",{templateUrl:t+"/static/tpls/components/tree.html",controller:["$scope","$timeout",r],bindings:{checkbox:"<",nodes:"<",checkedNodes:"<",onInitDone:"&",onNodeSelected:"&"}}).component("echartsTree",{template:'<div id="echarts_container" style="min-width: 420px; height: 400px;"></div>',controller:["$scope","$log",a],controllerAs:"et",bindings:{width:"@",height:"@",tree:"=",onTreeSelected:"&",onChartCtrlAware:"&"}})}(angular,CONTEXT_PATH,echarts),function(e){"use strict";e.module("CONSTANTS",[]).constant("GLOBAL_EVENTS",{UnAuthenticated:"UnAuthenticated",UnAuthorized:"UnAuthorized",ServerException:"ServerException",PendingToast:"PendingToast"}).constant("META_TYPE",[{id:1,name:"专利标签元数据"},{id:2,name:"企业信息标签元数据"},{id:3,name:"企业需求标签元数据"},{id:4,name:"专家标签元数据"},{id:5,name:"流程元数据"},{id:6,name:"通用元数据"}]).constant("VALUE_TYPE",[{id:1,name:"单行文本"},{id:2,name:"多行文本"},{id:3,name:"时间"},{id:4,name:"附件"},{id:5,name:"数字"},{id:6,name:"布尔"}]).constant("LABEL_TYPE",[{id:1,name:"专利标签"},{id:2,name:"企业信息标签"},{id:3,name:"企业需求标签"},{id:4,name:"专家标签"}]).constant("PATENT_INDEX_TYPE",[{id:1,name:"自动获取"},{id:2,name:"自动计算"},{id:3,name:"自动获取人工修改"},{id:4,name:"自动计算人工修改"},{id:5,name:"人工标引"}]).constant("PATENT_LABEL_SOURCE",[{id:1,name:"中高"},{id:2,name:"国家知识产权局"},{id:3,name:"出版社"},{id:4,name:"innography"},{id:5,name:"智慧芽"},{id:6,name:"发明人"},{id:7,name:"五星资产评估"}]).constant("ENTERPRISE_INFO_INDEX_TYPE",[{id:1,name:"自动获取"},{id:5,name:"人工标引"}]).constant("ENTERPRISE_INFO_LABEL_SOURCE",[{id:8,name:"中高交易平台"},{id:2,name:"中高"},{id:9,name:"爬虫"}]).constant("ENTERPRISE_REQUIREMENT_INDEX_TYPE",[{id:1,name:"自动获取"},{id:5,name:"人工标引"}]).constant("ENTERPRISE_REQUIREMENT_LABEL_SOURCE",[{id:8,name:"中高交易平台"},{id:2,name:"中高"}]).constant("PROFESSOR_LABEL_SOURCE",[{id:10,name:"专利书包"}]).constant("TREE_NODE_TYPES",[{id:0,name:"叶子节点"},{id:1,name:"非叶子节点"}]).constant("INSTANCE_TYPE",[{id:1,name:"专利实例",key:"Patent"},{id:2,name:"企业信息实例",key:"EnterpriseInfo"},{id:3,name:"企业需求实例",key:"EnterpriseRequire"},{id:4,name:"专家实例",key:"Expert"},{id:5,name:"匹配实例",key:"MATCH"}]).constant("PATENT_PROCESS_TYPE",[{id:1,name:"专利批量处理",key:"batchUpdate",show:!1},{id:2,name:"专利基础标引",key:"patentBasicIndex",show:!0},{id:5,name:"专利深度标引",key:"patentDeepIndex",show:!0},{id:3,name:"专利价值评估",key:"patentValueIndex",show:!0},{id:4,name:"专利价格评估",key:"patentPriceIndex",show:!0},{id:6,name:"企业信息评估",key:"enterpriseInfoIndex",show:!1},{id:7,name:"企业需求评估",key:"enterpriseRequireIndex",show:!1},{id:8,name:"企业需求匹配",key:"enterpriseRequireMatch",show:!1}]).constant("PATENT_PROCESS_IMAGES",[{id:2,url:"/static/images/patentBasicIndex.png"},{id:5,url:"/static/images/patentDeepIndex.png"},{id:4,url:"/static/images/patentPriceIndex.png"},{id:3,url:"/static/images/patentValueIndex.png"},{id:6,url:"/static/images/enterpriseInfoIndex.png"},{id:7,url:"/static/images/enterpriseRequireIndex.png"}]).constant("PATENT_TASK_TYPE",[{id:1,name:"派单",key:"AssignOrder"},{id:2,name:"自动标引",key:"AutoIndex"},{id:3,name:"人工标引",key:"ManualIndex"},{id:4,name:"人工标引审核",key:"ManualIndexAudit"},{id:5,name:"价值评估",key:"ValueIndex"},{id:6,name:"价格评估",key:"PriceIndex"},{id:7,name:"深度标引",key:"DeepIndex"},{id:8,name:"半自动标引",key:"SemiAutoIndex"},{id:9,name:"人工筛选",key:"ArtificialSelection"},{id:10,name:"半自动标引审核",key:"SemiAutoIndexAudit"}]).constant("PROCESS_ORDER_STATE",[{id:0,name:"未完成"},{id:1,name:"已完成"}]).constant("TASK_ORDER_STATE",[{id:0,name:"未完成"},{id:1,name:"已完成"},{id:2,name:"被退单"}]).constant("TIMED_TASK_TYPE",[{id:1,name:"批量更新专利"},{id:2,name:"同步sub1"},{id:3,name:"同步sub3"},{id:4,name:"同步st_legalstatusinfo"},{id:5,name:"同步st_patfeeinfo"},{id:6,name:"同步st_patprsexploitationinfo"},{id:7,name:"同步st_patprspreservationinfo"},{id:8,name:"同步st_patprstransferinfo"},{id:9,name:"同步st_scoreinfo"},{id:10,name:"批量快速计算专利任务0"},{id:11,name:"批量快速计算专利任务1"},{id:12,name:"批量快速计算专利任务2"},{id:13,name:"批量快速计算专利任务3"},{id:14,name:"批量快速计算专利任务4"},{id:15,name:"批量快速计算专利任务5"},{id:16,name:"批量快速计算专利任务6"},{id:17,name:"批量快速计算专利任务7"},{id:18,name:"批量快速计算专利任务8"},{id:19,name:"批量快速计算专利任务9"},{id:20,name:"批量快速计算专利任务10"},{id:21,name:"批量快速计算专利任务11"},{id:22,name:"批量快速计算专利任务12"},{id:23,name:"批量快速计算专利任务13"},{id:24,name:"批量快速计算专利任务14"},{id:25,name:"批量快速计算专利任务15"},{id:26,name:"批量快速计算专利任务16"},{id:27,name:"批量快速计算专利任务17"},{id:28,name:"批量快速计算专利任务18"},{id:29,name:"批量快速计算专利任务19"},{id:30,name:"批量快速计算专利任务20"},{id:31,name:"批量快速计算专利任务21"},{id:32,name:"批量快速计算专利任务22"},{id:33,name:"批量快速计算专利任务23"},{id:34,name:"批量快速计算专利任务24"},{id:35,name:"批量快速计算专利任务25"},{id:36,name:"批量快速计算专利任务26"},{id:37,name:"批量快速计算专利任务27"},{id:38,name:"批量快速计算专利任务28"},{id:39,name:"批量快速计算专利任务29"},{id:110,name:"快速同步an尾号为0的专利"},{id:111,name:"快速同步an尾号为1的专利"},{id:112,name:"快速同步an尾号为2的专利"},{id:113,name:"快速同步an尾号为3的专利"},{id:114,name:"快速同步an尾号为4的专利"},{id:115,name:"快速同步an尾号为5的专利"},{id:116,name:"快速同步an尾号为6的专利"},{id:117,name:"快速同步an尾号为7的专利"},{id:118,name:"快速同步an尾号为8的专利"},{id:119,name:"快速同步an尾号为9的专利"},{id:120,name:"快速同步an尾号为X的专利"}]).constant("EXTRA_VALUE_LABELS",[{key:"ecoValueSimilarPatentNumCV",name:"经济价值相似专利数量计算值"},{key:"durationOfPatentCV",name:"保护年限计算值"},{key:"costHandingStatusCV",name:"费用处理状态计算值"},{key:"familyPatentNumCV",name:"同族专利数量计算值"},{key:"familyPatentCodeCV",name:"同族专利号计算值"},{key:"inventorNumCV",name:"发明人数量计算值"},{key:"classiflcationCodeNumCV",name:"分类号数量计算值"},{key:"nonPatentQuotationNumCV",name:"非专利引用数量计算值"},{key:"patentReferenceNumCV",name:"专利引用数量计算值"},{key:"classiflcationCodeNumCV",name:"分类号数量计算值"},{key:"tecValueIndependentClaimsNumCV",name:"技术价值独立权利要求数计算值"},{key:"tecValueDependentClaimsNumCV",name:"技术价值从属权利要求数计算值"},{key:"tecValueSimilarPatentNumCV",name:"技术价值相似专利数量计算值"},{key:"meanOfSimilarityCV",name:"相似度均值计算值"},{key:"pattypeCV",name:"专利类型计算值"},{key:"lastLegalStatusCV",name:"最新法律状态计算值"},{key:"citedPatentNumCV",name:"引证专利数计算值"},{key:"nonPatentReferenceNumCV",name:"非专利引文数计算值"},{key:"lawValueIndependentClaimsNumCV",name:"法律价值独立权利要求数计算值"},{key:"lawValueDependentClaimsNumCV",name:"法律价值从属权利要求数计算值"},{key:"familyPatentDistribution",name:"同族专利分布"}])}(angular),function(e,t){"use strict";function n(e,n,r,a,o,i,s,l,c){var u=this;u.selectedState=a.current.name,e.$on("$stateChangeSuccess",function(e,t,n,r){u.selectedState=t.name}),e.$on(c.UnAuthorized,function(e){l.openAlert({type:"error",title:"提示",hideCancel:!0,message:"您没有访问权限!"}).then(function(e){i.info("AlertModal result: ",e)}).catch(function(e){i.info("AlertModal dismissed at: "+new Date,e)})}),e.$on(c.UnAuthenticated,function(e){u.login()}),e.$on(c.ServerException,function(e){}),e.$on(c.PendingToast,function(e,t){o.pop(t)}),n.nullIfSpaceOrEmpty=function(e){if("string"==typeof e){var t=e.trim();return 0===t.length?null:t}return e},n.getNationalEconomy=function(e){return null==e?null:null!=e.t4?e.t4:null!=e.t3?e.t3:null!=e.t2?e.t2:null!=e.t1?e.t1:null},n.getCssClasses=function(e){return{"has-error":e&&e.$dirty&&e.$invalid}},n.showError=function(e,t){return e&&e.$dirty&&e.$error[t]},n.formCanSave=function(e){return e&&e.$dirty&&e.$valid},u.login=function(){r.location.href=t+"/login"}}function r(e,n,r,a,o,i,s,l){var c=this;c.contextPath=t,o.getLoginUser().then(function(e){c.loginUser=e,c.getAllMessage()}).catch(i.errHandler),c.logout=function(){r.location.href=t+"/logout"},c.openChangePassword=function(){s.openChangePasswordEditer({}).then(function(e){}).catch(function(e){a.info(e)})},c.openChangeProfile=function(){s.openChangeProfileEditer({}).then(function(e){}).catch(function(e){a.info(e)})},c.getAllMessage=function(){l.getMessages(1,10).then(function(e){if(0===e.code){c.messages=e.result.list,c.unreadNum=0;for(var t=0;t<c.messages.length;t++){c.messages[t]}}else i.toast({type:"error",body:"获取消息列表出错："+e.message})}).catch(i.errHandler)},c.dealMessage=function(e){e.url&&n.go(e.url)}}e.module("PMES2").controller("AppCtrl",["$rootScope","$scope","$window","$state","toaster","$log","AuthService","ModalService","GLOBAL_EVENTS",n]).controller("NavCtrl",["$scope","$state","$window","$log","AuthService","ToastService","ModalService","MessageService",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(t,n,r){t.checkAll=Boolean(t.allChecked),t.model&&(t.defaultValueList=t.model.split(",")),r.getMeta(t.metaKey).then(function(n){if(n&&0===n.code){switch(t.meta=n.result,t.meta.valueType){case 5:e.forEach(t.meta.values,function(e){e.value=parseInt(e)});break;case 6:e.forEach(t.meta.values,function(e){e.value=Boolean(e)})}e.forEach(t.meta.values,function(e){if(e.selected=t.checkAll,t.defaultValueList)for(var n=0;n<t.defaultValueList.length;n++)t.defaultValueList[n]==e.name&&(e.selected=!0)})}}).catch(function(e){n.error(t.metaKey,e)}),t.$watch(function(){return t.meta&&t.meta.values?t.meta.values.map(function(e){return e.selected}).join(","):""},function(){if(!t.meta||!t.meta.values)return!1;var e=[];t.meta.values.map(function(t){t.selected&&e.push(t.name)}),t.model=e.join(",")||""})}function r(t,n,r){r.getMeta(t.metaKey).then(function(n){if(n&&0===n.code)switch(t.meta=n.result,t.meta.valueType){case 5:e.forEach(t.meta.values,function(e){e.value=parseInt(e)});break;case 6:e.forEach(t.meta.values,function(e){e.value=Boolean(e)})}}).catch(function(e){n.error(t.metaKey,e)})}function a(t,n,r){t.checkAll=Boolean(t.allChecked),t.model&&(t.defaultValueList=t.model.split(",")),r.getMeta(t.metaKey).then(function(n){if(n&&0===n.code){switch(t.meta=n.result,t.meta.valueType){case 5:e.forEach(t.meta.values,function(e){e.value=parseInt(e)});break;case 6:e.forEach(t.meta.values,function(e){e.value=Boolean(e)})}e.forEach(t.meta.values,function(e){e.selected=t.checkAll})}}).catch(function(e){n.error(t.metaKey,e)}),t.$watch(function(){return t.meta&&t.meta.values?t.meta.values.map(function(e){return e.selected}).join(","):""},function(){if(!t.meta||!t.meta.values)return!1;var e=t.meta.values.filter(function(e){return e.selected});t.onSelectionChanged&&t.onSelectionChanged({selected:e})}),t.toggleCheckAll=function(){var n=t.shouldAllChecked();e.forEach(t.meta.values,function(e){e.selected=!n})},t.shouldAllChecked=function(){return!(!t.meta||!t.meta.values)&&t.meta.values.filter(function(e){return e.selected}).length===t.meta.values.length}}function o(t,n,r){r.getMeta(t.metaKey).then(function(n){if(n&&0===n.code)switch(t.meta=n.result,t.meta.valueType){case 5:e.forEach(t.meta.values,function(e){e.value=parseInt(e)});break;case 6:e.forEach(t.meta.values,function(e){e.value=Boolean(e)})}}).catch(function(e){n.error(t.metaKey,e)})}function i(e,t,n,r,a,o){e.options={title:{text:e.eTitle,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{data:[],axisTick:{show:!1},axisLabel:{rotate:30}},yAxis:{splitLine:{show:!1},name:""},animationDurationUpdate:1200,series:[{type:"bar",itemStyle:{normal:{color:"#277EAB"}},silent:!0,barWidth:40,barGap:"-100%",data:[]}]},e.onChartAware=function(t){e.chart=t;var n=0;e.options.series[0].data=e.numList;for(var r=0;r<e.numList.length;r++)n=Math.max(n,e.numList[r]);e.options.xAxis.data=e.xs,e.options.yAxis.max=n,e.options.yAxis.name=e.yName,e.options.title.text=e.eTitle,e.chart.clear(),e.chart.setOption(e.options,!0),e.chart.resize()},e.resize=function(t){t&&e.chart&&o(function(){e.onChartAware(e.chart),e.chart.resize(n.position(e.chart.getDom()))},100)},e.$watch(function(){return e.searchTime},e.resize)}function s(e,t,n,r,a,o,i){var s=this;s.init=function(){s.mode=e.mode,i(function(){e.selectedList=e.defaultValue||[],"spec"==s.mode?s.getAllNationals():"ipc"==s.mode&&s.getAllIpc(),e.$watch(function(){return e.selectedList.length},function(){for(var t=[],n=[],r=0;r<e.selectedList.length;r++)t.push(e.selectedList[r].code),n.push(e.selectedList[r].name);e.selectedValue=t.join(","),e.showValue=n.join(",")})},500)},e.changeSon=function(t){"spec"==e.mode&&(e.sonList=t.sons),"ipc"==e.mode&&(e.sonList=t.sonIPCFields)},e.selectOne=function(t){for(var n=0;n<e.selectedList.length;n++)if(t.id==e.selectedList[n].id)return void a.toast({type:"info",body:"该领域已被选择,无需重复选择"});e.selectedList.push(t)},e.deleteOne=function(t){for(var n=0;n<e.selectedList.length;n++)if(t.id==e.selectedList[n].id)return void e.selectedList.splice(n,1)},s.getAllNationals=function(){e.loading=!0,r.getAllNationals().then(function(t){e.loading=!1,t&&0===t.code?(s.nationals=t.result,s.t1s=[],s.nationals.forEach(function(e){if(0==e.parentId||null==e.parentId){e.sons=[];for(var t=0;t<s.nationals.length;t++)s.nationals[t].parentId==e.id&&e.sons.push(s.nationals[t]);s.t1s.push(e)}}),e.list=s.t1s):a.toast({type:"error",body:"请求国名经济代码失败:"+t.message})}).catch(function(t){e.loading=!1,a.errHandler(t)})},s.getAllIpc=function(){e.loading=!0,o.getAllIPC().then(function(t){e.loading=!1,t&&0===t.code?(s.ipcs=t.result,e.list=s.ipcs):a.toast({type:"error",body:"请求IPC领域失败:"+t.message})}).catch(function(t){e.loading=!1,a.errHandler(t)})},s.init()}function l(e,t,n,r,a,o,i){e.loading=!1,e.title=i(e.processId)+(e.isAlert?"预警监测（按人员）":"超时监测（按人员）"),e.options={title:{text:e.title,left:"center"},tooltip:{trigger:"axis"},grid:{top:50,width:"100%",bottom:"0%",left:10,containLabel:!0},xAxis:{type:"value",max:10887,splitLine:{show:!1}},yAxis:{type:"category",data:[],axisLabel:{interval:0,rotate:30},splitLine:{show:!1}},series:[{type:"bar",stack:"chart",z:3,barWidth:5,data:[]}]},e.onChartAware=function(t){if(e.chart=t,e.processId){e.loading=!0;var n=null;n=e.isAlert?a.countMaxUserAlert(e.processId):a.countMaxUserDue(e.processId),n.then(function(t){if(e.loading=!1,t&&0===t.code){for(var n=10,r=0;r<t.result.length;r++){var a=t.result[r];e.options.yAxis.data.push(a.name),e.options.series[0].data.push(a.count),n=Math.max(n,a.count)}e.options.xAxis.max=n,e.chart.clear(),e.chart.setOption(e.options,!0),e.chart.resize()}}).catch(function(t){e.loading=!1})}},e.resize=function(t){t&&e.chart&&r(function(){e.chart.resize(n.position(e.chart.getDom()))},100)},e.$watch(function(){return e.cpId===e.processId},e.resize)}function c(e,t,n,r,a,o,i){e.loading=!1,e.title=i(e.processId)+(e.isAlert?"预警监测（按环节）":"超时监测（按环节）"),e.options={title:{text:e.title,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{data:[],axisTick:{show:!1}},yAxis:{splitLine:{show:!1},name:"人数"},animationDurationUpdate:1200,series:[{type:"bar",itemStyle:{normal:{color:"#277EAB"}},silent:!0,barWidth:40,barGap:"-100%",data:[]}]},e.onChartAware=function(t){if(e.chart=t,e.processId){e.loading=!0;var n=null;n=e.isAlert?a.countAlertNumByProcess(e.processId):a.countDueNumByProcess(e.processId),n.then(function(t){if(e.loading=!1,t&&0===t.code){for(var n=0;n<t.result.length;n++){var r=t.result[n];e.options.xAxis.data.push(o(r.taskType)),e.options.series[0].data.push(r.count)}e.chart.clear(),e.chart.setOption(e.options,!0),e.chart.resize()}}).catch(function(t){e.loading=!1})}},e.resize=function(t){t&&e.chart&&r(function(){e.chart.resize(n.position(e.chart.getDom()))},100)},e.$watch(function(){return e.cpId===e.processId},e.resize)}function u(e,t,n,r,a,o){e.loading=!1,e.title="完成时间",e.options={title:{text:e.title,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["最大时间","平均时间","最小时间"],top:30},xAxis:{data:[],axisTick:{show:!1}},yAxis:{splitLine:{show:!1},name:"时间(小时)"},animationDurationUpdate:1200,series:[{name:"最大时间",type:"bar",itemStyle:{normal:{color:"#277EAB"}},silent:!0,barWidth:40,barGap:"-100%",data:[]},{name:"平均时间",type:"bar",barWidth:40,z:10,data:[]},{name:"最小时间",type:"bar",barWidth:40,z:10,data:[]}]},e.onChartAware=function(t){e.chart=t,e.processId&&(e.loading=!0,a.countUseTimeByProcess(e.processId).then(function(t){if(e.loading=!1,t&&0===t.code){for(var n=0;n<t.result.length;n++){var r=t.result[n];e.options.xAxis.data.push(o(r.taskType)),e.options.series[0].data.push(parseFloat((r.max||0)/3600).toFixed(3)),e.options.series[1].data.push(parseFloat((r.avg||0)/3600).toFixed(3)),e.options.series[2].data.push(parseFloat((r.min||0)/3600).toFixed(3))}e.chart.clear(),e.chart.setOption(e.options,!0),e.chart.resize()}}).catch(function(t){e.loading=!1}))},e.resize=function(t){t&&e.chart&&r(function(){e.chart.resize(n.position(e.chart.getDom()))},100)},e.$watch(function(){return e.cpId===e.processId},e.resize)}function d(e,t,n){e.loading=!1;var r={due:"超时定单分类",alert:"预警定单分类",processing:"进行中定单分类",done:"已完成定单分类"},a={basic:"专利基础标引",deep:"专利深度标引",value:"专利价值标引",price:"专利价格标引"};e.title=r[e.statType||"due"],e.options={tooltip:{trigger:"item",formatter:"{b} : {c} ({d}%)"},series:[{name:e.title,type:"pie",radius:"55%",center:["50%","60%"],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{position:"outside"},labelLine:{show:!0}}]},e.loading=!0,e.onChartAware=function(t){e.chart=t,"process"==e.orderType&&n.countDetailForProcessOrders(e.statType).then(function(t){e.loading=!1,t&&0===t.code&&(e.options.series[0].data=["basic","deep","value","price"].map(function(e){return{value:t.result[e],name:a[e]}}),e.chart.clear(),e.chart.setOption(e.options,!0),e.chart.resize())}).catch(function(t){e.loading=!1})}}function p(t,n,r){t.loading=!1,t.processOrderState={},t.countProcessOrders=function(){t.loading=!0,r.countProcessOrders(t.processId).then(function(n){t.loading=!1,n&&0===n.code&&e.merge(t.processOrderState,n.result)}).catch(function(e){t.loading=!1})},t.countProcessOrders()}e.module("DIRECTIVES",["SERVICES","ui.bootstrap"]).directive("tmPagination",[function(){return{restrict:"EA",template:'<div class="page-list pull-right" style=""><ul class="pagination pull-left" ng-show="conf.totalItems > 0"><li ng-class="{disabled: conf.currentPage == 1}" ng-click="prevPage()"><span>&laquo;</span></li><li ng-repeat="item in pageList track by $index" ng-class="{active: item == conf.currentPage, separate: item == \'...\'}" ng-click="changeCurrentPage(item)"><span style="cursor: pointer">{{ item }}</span></li><li ng-class="{disabled: conf.currentPage == conf.numberOfPages}" ng-click="nextPage()"><span>&raquo;</span></li></ul><div class="page-total pull-left" style="margin: 25px 0 0 10px" ng-show="conf.totalItems > 0">第<input type="text" ng-model="jumpPageNum" style="width:40px;text-align:center" ng-keyup="jumpToPage($event)"/>页 每页<select ng-model="conf.itemsPerPage" ng-options="option for option in conf.perPageOptions " ng-change="changeItemsPerPage()"></select>/共<strong>{{ conf.totalItems }}</strong>条</div><div class="no-items" ng-show="conf.totalItems <= 0"></div></div>',replace:!0,scope:{conf:"="},link:function(e,t,n){function r(){e.conf.currentPage=parseInt(e.conf.currentPage)?parseInt(e.conf.currentPage):1,e.conf.totalItems=parseInt(e.conf.totalItems),e.conf.rememberPerPage?(parseInt(localStorage[e.conf.rememberPerPage])||(localStorage[e.conf.rememberPerPage]=parseInt(e.conf.itemsPerPage)?parseInt(e.conf.itemsPerPage):15),e.conf.itemsPerPage=parseInt(localStorage[e.conf.rememberPerPage])):e.conf.itemsPerPage=parseInt(e.conf.itemsPerPage)?parseInt(e.conf.itemsPerPage):15,e.conf.numberOfPages=Math.ceil(e.conf.totalItems/e.conf.itemsPerPage),e.conf.currentPage<1&&(e.conf.currentPage=1),e.conf.currentPage>e.conf.numberOfPages&&(e.conf.currentPage=e.conf.numberOfPages),e.jumpPageNum=e.conf.currentPage;for(var t,n=e.conf.perPageOptions.length,r=0;r<n;r++)e.conf.perPageOptions[r]==e.conf.itemsPerPage&&(t=!0);if(t||e.conf.perPageOptions.push(e.conf.itemsPerPage),e.conf.perPageOptions.sort(function(e,t){return e-t}),e.pageList=[],e.conf.numberOfPages<=e.conf.pagesLength)for(r=1;r<=e.conf.numberOfPages;r++)e.pageList.push(r);else{var a=(e.conf.pagesLength-1)/2;if(e.conf.currentPage<=a){for(r=1;r<=a+1;r++)e.pageList.push(r);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}else if(e.conf.currentPage>e.conf.numberOfPages-a){for(e.pageList.push(1),e.pageList.push("..."),r=a+1;r>=1;r--)e.pageList.push(e.conf.numberOfPages-r);e.pageList.push(e.conf.numberOfPages)}else{for(e.pageList.push(1),e.pageList.push("..."),r=Math.ceil(a/2);r>=1;r--)e.pageList.push(e.conf.currentPage-r);for(e.pageList.push(e.conf.currentPage),r=1;r<=a/2;r++)e.pageList.push(e.conf.currentPage+r);e.pageList.push("..."),e.pageList.push(e.conf.numberOfPages)}}e.conf.onChange&&e.conf.onChange(),e.$parent.conf=e.conf}e.changeCurrentPage=function(t){"..."!=t&&(e.conf.currentPage=t)},e.conf.pagesLength=parseInt(e.conf.pagesLength)?parseInt(e.conf.pagesLength):9,e.conf.pagesLength%2==0&&(e.conf.pagesLength=e.conf.pagesLength-1),e.conf.perPageOptions||(e.conf.perPageOptions=[10,20,30,40,50,60]),e.prevPage=function(){e.conf.currentPage>1&&(e.conf.currentPage-=1)},e.nextPage=function(){e.conf.currentPage<e.conf.numberOfPages&&(e.conf.currentPage+=1)},e.jumpToPage=function(){e.jumpPageNum=e.jumpPageNum.replace(/[^0-9]/g,""),""!==e.jumpPageNum&&(e.conf.currentPage=e.jumpPageNum)},e.changeItemsPerPage=function(){e.conf.rememberPerPage&&localStorage.removeItem(e.conf.rememberPerPage)},e.$watch(function(){var t=e.conf.currentPage+" "+e.conf.totalItems+" ";return e.conf.rememberPerPage&&localStorage[e.conf.rememberPerPage]?t+=localStorage[e.conf.rememberPerPage]:t+=e.conf.itemsPerPage,t},r)}}}]).directive("ckeditor",function(){return{require:"?ngModel",link:function(e,t,n,r){var a=CKEDITOR.replace(t[0],{});r&&(a.on("instanceReady",function(){a.setData(r.$viewValue)}),a.on("pasteState",function(){e.$apply(function(){r.$setViewValue(a.getData())})}),r.$render=function(e){a.setData(r.$viewValue)})}}}).directive("ngThumb",["$window",function(t){var n={support:!(!t.FileReader||!t.CanvasRenderingContext2D),isFile:function(n){return e.isObject(n)&&n instanceof t.File},isImage:function(e){return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf("|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|")}};return{restrict:"A",template:"<canvas/>",link:function(e,t,r){function a(e){var t=new Image;t.onload=o,t.src=e.target.result}function o(){var e=i.width||this.width/this.height*i.height,t=i.height||this.height/this.width*i.width;s.attr({width:e,height:t}),s[0].getContext("2d").drawImage(this,0,0,e,t)}if(n.support){var i=e.$eval(r.ngThumb);if(n.isFile(i.file)&&n.isImage(i.file)){var s=t.find("canvas"),l=new FileReader;l.onload=a,l.readAsDataURL(i.file)}}}}}]).directive("resize",["$window",function(t){return function(n,r){var a=e.element(t);n.getWindowDimensions=function(){return{h:a.height(),w:a.width(),t:a.scrollTop()}},n.$watch(n.getWindowDimensions,function(e,t){n.windowHeight=e.h,n.windowWidth=e.w,n.scrollTop=e.t,n.style=function(){return{height:e.h-100+"px",width:e.w-100+"px"}};var a=106;n.windowWidth<1e3&&(a=137),n.windowWidth<770&&(a=187);n.windowWidth<482&&(a=115),r.css("min-height",n.windowHeight-a-95+"px")},!0),a.bind("resize",function(){n.$apply()})}}]).directive("metaSelector",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/components/meta-selector.html",controller:["$scope","$log","MetaService",r],scope:{classes:"@",metaKey:"@",disabled:"=",model:"=",emptyTitle:"@",emptyValue:"@"}}}).directive("metaCheckbox",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/components/meta-checkbox.html",controller:["$scope","$log","MetaService",a],scope:{metaKey:"@",checkAllTitle:"@",labelDirection:"@",allChecked:"@",onSelectionChanged:"&"}}}).directive("metaCheck",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/components/meta-check.html",controller:["$scope","$log","MetaService",n],scope:{model:"=",metaKey:"@",checkAllTitle:"@",labelDirection:"@",allChecked:"@",onSelectionChanged:"&"}}}).directive("orderMetaSelector",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/components/order-meta-selector.html",controller:["$scope","$log","MetaService",o],scope:{classes:"@",metaKey:"@",isDisabled:"@",model:"=",emptyTitle:"@",emptyValue:"@",itemName:"@"}}}).directive("datetimeRange",function(){return{restrict:"EA",replace:!0,template:'<input type="text" class="form-control" />',scope:{onDatetimeRangeChanged:"&",startDate:"=",endDate:"=",maxDate:"="},link:function(e,t,n){$(t).daterangepicker({startDate:moment(e.startDate),endDate:moment(e.endDate),maxDate:!!e.maxDate&&moment(e.maxDate),showDropdowns:!1,showWeekNumbers:!1,timePickerIncrement:1,singleDatePicker:!1,locale:{separator:"~",applyLabel:"确认",cancelLabel:"取消",format:"YYYY-MM-DD",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},opens:"right",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small btn-default",format:"YYYY-MM-DD"},function(t,n,r){e.onDatetimeRangeChanged&&e.onDatetimeRangeChanged({start:t,end:n})}).next().on("click",function(){$(this).prev().focus()})}}}).directive("myDatetimeRange",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/myDatetimeRangePicker.html",scope:{onDatetimeRangeChanged:"&",startDate:"=",endDate:"="},link:function(e,t){function n(){var t=r.val()?moment(r.val()).startOf("day"):void 0,n=a.val()?moment(a.val()).endOf("day"):void 0;e.onDatetimeRangeChanged&&e.onDatetimeRangeChanged({start:t,end:n})}var r=t.find("#d11"),a=t.find("#d12");r.on("click",function(){WdatePicker({el:r[0],firstDayOfWeek:1,maxDate:"#F{$dp.$D('d12')}",onpicked:n,oncleared:n})}),a.on("click",function(){WdatePicker({el:a[0],firstDayOfWeek:1,minDate:"#F{$dp.$D('d11')}",onpicked:n,oncleared:n})})}}}).directive("sliderValue",function(){return{restrict:"EA",replace:!0,template:'<input type="text" class="form-control slider" />',scope:{model:"=",min:"@",max:"@",onChange:"&"},link:function(e,t){e.slider=$(t).slider({min:e.min||0,max:e.max||100,value:e.model.weight}),e.$watch("model.weight",function(){e.slider.slider("setValue",e.model.weight)}),e.slider.on("change",function(t){var n=t.value.newValue,r=t.value.newValue-t.value.oldValue;e.$apply(function(){e.model.weight=n}),e.onChange&&e.onChange({label:e.model,change:r})})}}}).directive("echart",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/echart.html",scope:{width:"@",height:"@",options:"=",onChartAware:"&"},link:function(e,t){var n=t[0];$(n).css("width",e.width||"400px"),$(n).css("height",e.height||"300px"),e.chart||(e.chart=echarts.init(n)),e.chart.setOption(e.options,!0),e.$watch("options",function(t){e.chart.setOption(e.options)}),e.onChartAware&&e.onChartAware({chart:e.chart})}}}).directive("statDetail",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/stat.detail.html",controller:["$scope","$log","StatService",d],scope:{orderType:"@",statType:"@"},link:function(e,t){}}}).directive("statProcess",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/stat.process.html",controller:["$scope","$log","StatService",p],scope:{processId:"="},link:function(e,t){}}}).directive("statUseTime",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/stat.useTime.html",controller:["$scope","$log","$uibPosition","$timeout","StatService","changeTaskTypeFilter",u],scope:{processId:"=",cpId:"="},link:function(e,t){}}}).directive("statRemindNum",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/stat.remindNum.html",controller:["$scope","$log","$uibPosition","$timeout","StatService","changeTaskTypeFilter","processTypeFilter",c],scope:{processId:"=",isAlert:"=",cpId:"="},link:function(e,t){}}}).directive("statRemindUser",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/stat.remindUser.html",controller:["$scope","$log","$uibPosition","$timeout","StatService","changeTaskTypeFilter","processTypeFilter",l],scope:{processId:"=",isAlert:"=",cpId:"="},link:function(e,t){}}}).directive("twoLevelCheck",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/twoLevelCheck.html",controller:["$scope","$log","$uibPosition","ModalService","ToastService","ExpertService","$timeout",s],scope:{mode:"=",defaultValue:"=",selectedValue:"=",showValue:"="},link:function(e,t){}}}).directive("barGraph",function(){return{restrict:"EA",replace:!0,templateUrl:t+"/static/tpls/directives/barGraph.html",controller:["$scope","$log","$uibPosition","ModalService","ToastService","$timeout",i],scope:{eTitle:"=",xs:"=",numList:"=",searchTime:"=",yName:"="},link:function(e,t){}}})}(angular,CONTEXT_PATH),function(){"use strict";angular.module("FILTERS",[]).filter("changeDur",function(){return function(e){var t=parseInt(e/1e3),n=0,r=0;if(t>60)n=parseInt(t/60),t=parseInt(t%60),n>60&&(r=parseInt(n/60),n=parseInt(n%60));else if(t<60){var a="00:"+parseInt(t);return a}var o=""+parseInt(t);return n>0&&(o=(parseInt(n)>=10?parseInt(n):"0"+parseInt(n))+":"+(o>10?o:"0"+o)),r>0&&(o=(parseInt(r)>=10?parseInt(r):"0"+parseInt(r))+":"+o),o}}).filter("changeDur2",function(){return function(e){var t=parseInt(e),n=0,r=0;if(t>60)n=parseInt(t/60),t=parseInt(t%60),n>60&&(r=parseInt(n/60),n=parseInt(n%60));else if(t<60){var a="00:"+parseInt(t);return a}var o=""+parseInt(t);return n>0&&(o=(parseInt(n)>=10?parseInt(n):"0"+parseInt(n))+":"+(o>10?o:"0"+o)),r>0&&(o=(parseInt(r)>=10?parseInt(r):"0"+parseInt(r))+":"+o),o}}).filter("changeTarget",function(){return function(e){var t;return"subjectCourseDetail"!==e.target&&"subjectDetail"!==e.target?e.target:(t=JSON.parse(e.parameter),"subjectCourseDetail"===e.target?(t.isSubject=1,t):"subjectDetail"===e.target?(t.isSubject=2,t):void 0)}
}).filter("changeCkEditor",function(){return function(e){if(e){var t=function(e){var t={lt:"<",gt:">",nbsp:"",amp:"&",quot:'"'};return e.replace(/&(lt|gt|nbsp|amp|quot);/gi,function(e,n){return t[n]})}(e);return t=function(e){return e.replace(/<[^<>]+?>/g,"")}(t)}}}).filter("changeState",function(){return function(e){return 0===e?"待审核":1===e?"待编辑":2===e?"已通过":"未通过"}}).filter("addHttp",function(){return function(e){if(e){if(/.*(.jpg|.png|.gif|.JPG|.PNG|.GIF)$/.test(e)){return/(http|ftp|https):\/\/([\w.]+\/?)\S*/.test(e)?e:"http://homecare-assets.oss-cn-hangzhou.aliyuncs.com/"+e}}}}).filter("score",function(){return function(e){if(e){for(var t="",n=0;n<e;n++)t+="★";return t}}}).filter("changeMetaType",function(){return function(e){if(e){var t="";switch(e){case 1:t="专利标签元数据";break;case 2:t="企业信息标签元数据";break;case 3:t="企业需求标签元数据";break;case 4:t="专家标签元数据";break;case 5:t="流程元数据";break;case 6:t="通用元数据"}return t}}}).filter("changeValueType",function(){return function(e){if(e){var t="";switch(e){case 1:t="单行文本";break;case 2:t="多行文本";break;case 3:t="时间";break;case 4:t="附件";break;case 5:t="数字";case 6:t="布尔"}return t}}}).filter("changeLabelType",function(){return function(e){if(e){var t="";switch(e){case 1:t="专利标签";break;case 2:t="企业信息标签";break;case 3:t="企业需求标签";break;case 4:t="专家标签"}return t}}}).filter("changeIndexType",function(){return function(e){if(e){var t="";switch(e){case 1:t="自动获取";break;case 2:t="自动计算";break;case 3:t="自动获取人工修改";break;case 4:t="自动计算人工修改";break;case 5:t="人工标引"}return t}}}).filter("changeLabelSource",function(){return function(e){if(e){var t="";switch(e){case 1:t="中高";break;case 2:t="国家知识产权局";break;case 3:t="出版社";break;case 4:t="innography";break;case 5:t="智慧芽";break;case 6:t="发明人";break;case 7:t="五星资产评估";break;case 8:t="中高交易平台";break;case 9:t="爬虫"}return t}}}).filter("labelsetType",function(){return function(e){return["","专利价值快速评估体系","基础标引标签体系","价值评估标签体系","价格评估标签体系","深度标引标签体系","企业信息标签体系","企业需求标签体系","专家标签体系"][e]}}).filter("changeProcessOrderState",function(){return function(e){if(null!=e){var t="";switch(e){case 0:t="";break;case 1:t="未完成";break;case 2:t="已完成"}return t}}}).filter("changeTaskOrderState",function(){return function(e){if(null!=e){var t="";switch(e){case 0:t="未完成";break;case 1:t="已完成";break;case 2:t="被退单"}return t}}}).filter("changePatentType",function(){return function(e){if(e){var t="";switch(e){case 1:t="发明专利";break;case 2:t="实用新型";break;case 3:t="外观设计";break;case 4:t="发明授权"}return t}}}).filter("changeTaskType",function(){return function(e){if(e){var t="";switch(e){case 1:t="派单";break;case 2:t="自动标引";break;case 3:t="人工标引";break;case 4:t="人工标引审核";break;case 5:t="价值评估";break;case 6:t="价格评估";break;case 7:t="深度标引";break;case 8:t="半自动标引";break;case 9:t="匹配结果人工筛选";break;case 10:t="半自动标引审核"}return t}}}).filter("processType",function(){return function(e){return["","专利批量处理","专利基础标引","专利价值标引","专利价格标引","专利深度标引","企业信息标引","企业需求标引","企业需求匹配","专家标签体系"][e]}}).filter("labelDisplay",function(){return function(e,t){var n=e;switch(t){case 0:n=(100*parseFloat(e)).toFixed(2)}return n}}).filter("changeRegion",function(){return function(e){return(e?e.province.name+(e.city?"-"+e.city.name+(e.district?"-"+e.district.name:""):""):null)||"-"}}).filter("changeRegionWithAddress",function(){return function(e){if(!e||!e.province)return e?e.address:"-";var t=e?e.province.name+(e.city?"-"+e.city.name+(e.district?"-"+e.district.name:""):""):null;return null==t?"-":null==e.address?t:t+" - "+e.address}}).filter("changeSearchRegion",function(){return function(e,t){return e?e.t1.name+(e.t2?"-"+e.t2.name+(e.t3?"-"+e.t3.name:""):""):t||"全部"}}).filter("changeMessageType",function(){return function(e){if(e){var t="";switch(e){case 1:t="预警提醒";break;case 2:t="超时提醒";break;case 3:t="退单通知";break;case 4:t="转派通知"}return t}}}).filter("changeTimedTaskType",function(){return function(e){if(e){var t="";switch(e){case 1:t="批量更新专利";break;case 2:t="同步sub1";break;case 3:t="同步sub3";break;case 4:t="同步st_legalstatusinfo";break;case 5:t="同步st_patfeeinfo";break;case 6:t="同步st_patprsexploitationinfo";break;case 7:t="同步st_patprspreservationinfo";break;case 8:t="同步st_patprstransferinfo";break;case 9:t="同步st_scoreinfo";break;case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:case 36:case 37:case 38:case 39:t="批量快速计算专利任务"+(e-10);break;case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:t="快速同步尾号为"+(e-100)+"的专利";break;case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:t="快速同步an尾号为"+(e-100)+"的专利"}return t}}})}(),function(e,t){"use strict";e.module("PMES2").config(["$locationProvider","$stateProvider","$urlRouterProvider",function(e,n,r){e.html5Mode(!1),n.state("main",{abstract:!0,templateUrl:t+"/static/tpls/content.html"}).state("login",{url:"/login",templateUrl:t+"/static/tpls/login.html",controller:"LoginCtrl"}).state("main.console",{abstract:!0,views:{"header@main":{templateUrl:t+"/static/tpls/header/index.html",controller:"NavCtrl",controllerAs:"nav"},"sidebar@main":{templateUrl:t+"/static/tpls/sidebar/index.html",controller:"SidebarCtrl",controllerAs:"sidebar"}}}).state("main.console.dashboard",{url:"/dashboard"}).state("main.console.dashboard.personal",{url:"/personal",views:{"content@main":{templateUrl:t+"/static/tpls/dashboard/personal.html",controller:"DashboardPersonalController",controllerAs:"dpc"}}}).state("main.console.dashboard.patent",{url:"/patent",views:{"content@main":{templateUrl:t+"/static/tpls/dashboard/patent.html",controller:"PatentDashboardCtrl",controllerAs:"pdc"}}}).state("main.console.dashboard.enterprise",{url:"/enterprise",views:{"content@main":{templateUrl:t+"/static/tpls/dashboard/enterprise.html",controller:"EnterpriseDashboardCtrl",controllerAs:"pdc"}}}).state("main.console.dashboard.enterpriseReq",{url:"/enterpriseReq",views:{"content@main":{templateUrl:t+"/static/tpls/dashboard/enterpriseReq.html",controller:"EnterpriseDashboardCtrl",controllerAs:"pdc"}}}).state("main.console.dashboard.match",{url:"/match",views:{"content@main":{templateUrl:t+"/static/tpls/dashboard/match.html",controller:"EnterpriseDashboardCtrl",controllerAs:"pdc"}}}).state("main.console.system",{url:"/system"}).state("main.console.system.users",{url:"/users",views:{"content@main":{templateUrl:t+"/static/tpls/system/user/users.html",controller:"UserCtrl",controllerAs:"user"}}}).state("main.console.system.users.add",{url:"/add",views:{"content@main":{templateUrl:t+"/static/tpls/system/user/add.html",controller:"UserEditController",controllerAs:"UserEditCtrl"}}}).state("main.console.system.users.edit",{url:"/edit/:id",views:{"content@main":{templateUrl:t+"/static/tpls/system/user/edit.html",controller:"UserEditController",controllerAs:"UserEditCtrl"}}}).state("main.console.system.roles",{url:"/roles",views:{"content@main":{templateUrl:t+"/static/tpls/system/role/roles.html",controller:"RoleCtrl",controllerAs:"role"}}}).state("main.console.system.roles.check",{url:"/check/:id",views:{"content@main":{templateUrl:t+"/static/tpls/system/role/roleCheck.html",controller:"RoleCheckController",controllerAs:"roleCheck"}}}).state("main.console.system.authority",{url:"/authority",views:{"content@main":{templateUrl:t+"/static/tpls/system/authority/authority.html",controller:"AuthorityCtrl",controllerAs:"authority"}}}).state("main.console.system.organization",{url:"/organization",views:{"content@main":{templateUrl:t+"/static/tpls/system/organization/organization.html",controller:"OrganizationCtrl",controllerAs:"organization"}}}).state("main.console.configuration",{url:"/configuration"}).state("main.console.configuration.metas",{url:"/metas",views:{"content@main":{templateUrl:t+"/static/tpls/configuration/meta/metas.html",controller:"MetaCtrl",controllerAs:"meta"}}}).state("main.console.configuration.labels",{url:"/labels",views:{"content@main":{templateUrl:t+"/static/tpls/configuration/label/labels.html",controller:"LabelController",controllerAs:"label"}}}).state("main.console.configuration.label-sets",{url:"/labelsets",views:{"content@main":{templateUrl:t+"/static/tpls/configuration/labelset/labelsets.html",controller:"LabelsetController",controllerAs:"labelset"}}}).state("main.console.configuration.processes",{url:"/processes",views:{"content@main":{templateUrl:t+"/static/tpls/configuration/process/processes.html",controller:"ProcessController",controllerAs:"process"}}}).state("main.console.configuration.tasks",{url:"/tasks",views:{"content@main":{templateUrl:t+"/static/tpls/configuration/task/tasks.html",controller:"ProcessTaskController",controllerAs:"processTask"}}}).state("main.console.process",{url:"/process",abstract:!0}).state("main.console.process.order",{url:"/order",abstract:!0}).state("main.console.process.order.patent",{url:"/patent?instanceType",views:{"content@main":{templateUrl:t+"/static/tpls/processorder/patent.html",controller:"ProcessOrderQueryController",controllerAs:"poq"}}}).state("main.console.process.order.requirement",{url:"/requirement?instanceType",views:{"content@main":{templateUrl:t+"/static/tpls/processorder/requirement.html",controller:"ProcessOrderQueryController",controllerAs:"poq"}}}).state("main.console.process.order.detail",{url:"/detail/:orderId",views:{"content@main":{templateUrl:t+"/static/tpls/processorder/detail.html",controller:"ProcessDetailController",controllerAs:"pdc"}}}).state("main.console.process.order.details",{url:"/details?instanceType&instanceId",views:{"content@main":{templateUrl:t+"/static/tpls/processorder/details.html",controller:"ProcessDetailsController",controllerAs:"pdcs"}}}).state("main.console.patent",{url:"/patent",abstract:!0}).state("main.console.patent.start",{url:"/start",views:{"content@main":{templateUrl:t+"/static/tpls/patent/start/index.html",controller:"PatentProcessStartController",controllerAs:"pps"}}}).state("main.console.patent.assessment",{url:"/assessment"}).state("main.console.patent.assessment.humen",{url:"/human",views:{"content@main":{templateUrl:t+"/static/tpls/patent/assessment/humen/index.html",controller:"HumenController",controllerAs:"humen"}}}).state("main.console.patent.assessment.list",{url:"/humanList",views:{"content@main":{templateUrl:t+"/static/tpls/patent/assessment/humenList/index.html",controller:"HumenController",controllerAs:"humen"}}}).state("main.console.patent.assessment.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/patent/assessment/humen/detail.html",controller:"AssessmentController",controllerAs:"ac"}}}).state("main.console.patent.assessment.task",{url:"/task",views:{"content@main":{templateUrl:t+"/static/tpls/patent/assessment/task/index.html",controller:"TimedTaskController",controllerAs:"ttc"}}}).state("main.console.patent.assessment.errLog",{url:"/errLog",views:{"content@main":{templateUrl:t+"/static/tpls/patent/assessment/task/errLog.html",controller:"IndexErrorController",controllerAs:"ie"}}}).state("main.console.patent.process",{url:"/process",abstract:!0}).state("main.console.patent.process.order",{url:"/order?processType&taskType&actTaskId",views:{"content@main":{templateUrl:t+"/static/tpls/patent/order/index.html",controller:"TaskOrderController",controllerAs:"taskOrderCtrl"}}}).state("main.console.patent.process.index",{url:"/index?processType&taskType&taskOrderId&backUrl",views:{"content@main":{templateUrl:t+"/static/tpls/instance/indexOrder.html",controller:"IndexOrderController",controllerAs:"indexOrderCtrl"}}}).state("main.console.patent.process.audit",{url:"/audit?processType&taskType&taskOrderId",views:{"content@main":{templateUrl:t+"/static/tpls/instance/audit.html",controller:"AuditOrderController",controllerAs:"auditCtrl"}}}).state("main.console.patent.process.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/instance/valueIndexDetail.html",controller:"ValueIndexDetailController",controllerAs:"vid"}}}).state("main.console.patent.modify",{url:"/modify",views:{"content@main":{templateUrl:t+"/static/tpls/search/patent/index.html",controller:"PatentSearchController",controllerAs:"psc"}},resolve:{modifyFlag:function(){return!0}}}).state("main.console.patent.modify.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/patent/modify/index.html",controller:"PatentModifyController",controllerAs:"pmc"}}}).state("main.console.enterprise",{url:"/enterprise",abstract:!0}).state("main.console.enterprise.start",{url:"/start",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/start.html",controller:"EnterpriseListCtrl",controllerAs:"elc"}}}).state("main.console.enterprise.add",{url:"/add",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/edit.html",controller:"EnterpriseEditCtrl",controllerAs:"eec"}},resolve:{isEdit:function(){return!1}}}).state("main.console.enterprise.edit",{url:"/edit/:id",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/edit.html",controller:"EnterpriseEditCtrl",controllerAs:"eec"}},resolve:{isEdit:function(){return!0}}}).state("main.console.enterprise.process",{url:"/process",abstract:!0}).state("main.console.enterprise.process.order",{url:"/order?processType&taskType&actTaskId",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/info/index.html",controller:"TaskOrderController",controllerAs:"taskOrderCtrl"}}}).state("main.console.enterpriseRequirement",{url:"/requirement",abstract:!0}).state("main.console.enterpriseRequirement.start",{url:"/start",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/require.html",controller:"EnterpriseRequirementListCtrl",controllerAs:"erlc"}}}).state("main.console.enterpriseRequirement.process",{url:"/process",abstract:!0}).state("main.console.enterpriseRequirement.process.order",{url:"/order?processType&taskType&actTaskId",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/require/index.html",controller:"TaskOrderController",controllerAs:"taskOrderCtrl"}}}).state("main.console.match",{url:"/match",abstract:!0}).state("main.console.match.patent",{url:"/patent",abstract:!0}).state("main.console.match.patent.process",{url:"/process",abstract:!0}).state("main.console.match.patent.process.order",{url:"/order?processType&taskType&actTaskId",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/match/patent.html",controller:"TaskOrderController",controllerAs:"taskOrderCtrl"}}}).state("main.console.match.patent.detail",{url:"/detail?taskOrderId&keywords&backUrl",views:{"content@main":{templateUrl:t+"/static/tpls/enterprise/match/detail.html",controller:"ErPMatchDetailController",controllerAs:"matchDetailCtrl"}}}).state("main.console.search",{url:"/search",abstract:!0}).state("main.console.search.patent",{url:"/patent",views:{"content@main":{templateUrl:t+"/static/tpls/search/patent/index.html",controller:"PatentSearchController",controllerAs:"psc"}},resolve:{modifyFlag:function(){return!1}}}).state("main.console.search.patent.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/search/patent/detail.html",controller:"PatentDetailController",controllerAs:"pdc"}}}).state("main.console.search.enterprise",{url:"/enterprise",views:{"content@main":{templateUrl:t+"/static/tpls/search/enterprise/index.html",controller:"EnterpriseSearchController",controllerAs:"esc"}}}).state("main.console.search.enterprise.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/search/enterprise/detail.html",controller:"EnterpriseDetailController",controllerAs:"edc"}}}).state("main.console.search.requirement",{url:"/requirement",views:{"content@main":{templateUrl:t+"/static/tpls/search/requirement/index.html",controller:"RequirementSearchController",controllerAs:"rsc"}}}).state("main.console.search.requirement.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/search/requirement/detail.html",controller:"RequirementDetailController",controllerAs:"rdc"}}}).state("main.console.elsearch",{url:"/elsearch",abstract:!0}).state("main.console.elsearch.patent",{url:"/patent?keywords",views:{"content@main":{templateUrl:t+"/static/tpls/elsearch/patent/index.html",controller:"ElPatentCtrl",controllerAs:"elp"}}}).state("main.console.message",{url:"/message",views:{"content@main":{templateUrl:t+"/static/tpls/message/index.html",controller:"MessageController",controllerAs:"mes"}}}).state("main.console.expert",{url:"/expert",abstract:!0}).state("main.console.expert.list",{url:"/list",views:{"content@main":{templateUrl:t+"/static/tpls/expert/index.html",controller:"ExpertController",controllerAs:"ExCtrl"}}}).state("main.console.expert.add",{url:"/add",views:{"content@main":{templateUrl:t+"/static/tpls/expert/edit.html",controller:"ExpertEditController",controllerAs:"ExEditCtrl"}}}).state("main.console.expert.update",{url:"/update/:id",views:{"content@main":{templateUrl:t+"/static/tpls/expert/edit.html",controller:"ExpertEditController",controllerAs:"ExEditCtrl"}}}).state("main.console.expert.detail",{url:"/detail/:id",views:{"content@main":{templateUrl:t+"/static/tpls/expert/detail.html",controller:"ExpertEditController",controllerAs:"ExEditCtrl"}}}).state("main.console.statistics",{url:"/statistics",abstract:!0}).state("main.console.statistics.workload",{url:"/workload",views:{"content@main":{templateUrl:t+"/static/tpls/statistics/workload.html",controller:"WorkloadCtrl",controllerAs:"wlCtrl"}}}).state("main.console.statistics.workload.patentIndexOrder",{url:"/patentIndexOrder",views:{"statistics@main.console.statistics.workload":{templateUrl:t+"/static/tpls/statistics/workload/patentIndexOrder.html",controller:"patentIndexOrderController",controllerAs:"pioCtrl"}}}).state("main.console.statistics.workload.indexOrder",{url:"/indexOrder",views:{"statistics@main.console.statistics.workload":{templateUrl:t+"/static/tpls/statistics/workload/indexOrder.html",controller:"indexOrderController",controllerAs:"pioCtrl"}}}).state("main.console.statistics.patent",{url:"/patent",views:{"content@main":{templateUrl:t+"/static/tpls/statistics/patent.html",controller:"WorkloadCtrl",controllerAs:"wlCtrl"}}}).state("main.console.statistics.patent.patentValue",{url:"/patentValue",views:{"statistics@main.console.statistics.patent":{templateUrl:t+"/static/tpls/statistics/patent/patentValue.html",controller:"patentPatentValueController",controllerAs:"pioCtrl"}}}),r.otherwise(function(e,t){e.get("$state").go("main.console.dashboard.personal")})}]).run(["$rootScope","$state","$log","ToastService",function(e,t,n,r){e.$on("$stateNotFound",function(e,t,a,o){n.warn("$stateNotFound",t.to),r.toast({type:"error",body:"您所访问的页面不存在！"})}),e.$on("$stateChangeError",function(e,t,a,o,i,s){n.warn("$stateChangeError",unfoundState.to),r.toast({type:"error",body:"出错了:"+s.message})})}])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,t){var n=function(n){var r=e.defer();return t(n).then(function(e){r.resolve(e.data)},function(e){r.reject(e)}),r.promise};return{get:function(e,t){return t&&"object"==typeof t&&(t._random=Math.random()),n({method:"GET",url:e,params:t})},post:function(e,t){return n({method:"POST",url:e,data:t})},form:function(e,t){return n({method:"POST",url:e,data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}})},put:function(e,t){return n({method:"PUT",url:e,data:t})},patch:function(e,t){return n({method:"PATCH",url:e,data:t})},delete:function(e,t){return n({method:"DELETE",url:e,params:t})},head:function(e,t){return n({method:"HEAD",url:e,params:t})}}}function r(e,n){var r=this;return{getLoginUser:function(){if(r.loginUser)return e.when(r.loginUser);var a={random:Math.random()};return n.get(t+"/api/user",a).then(function(e){return r.loginUser=e.result,r.loginUser})},updateLoginUser:function(e){r.loginUser=e}}}function a(e,t,n){var r=function(t){e.$broadcast(n.PendingToast,t)};return{toast:r,errHandler:function(e){t.error("error",e),"string"!=typeof e&&401!==e.status&&403!==e.status&&500!==e.status&&r({type:"error",body:e.message||"出错了"})}}}function o(){this.getCssClasses=function(e){return{"has-error":e&&e.$dirty&&e.$invalid}},this.showError=function(e,t){return e&&e.$dirty&&e.$error[t]},this.formCanSave=function(e){return e&&e.$dirty&&e.$valid}}function i(e){this.getMessages=function(t,n){return e.get(CONTEXT_PATH+"/api/message/",{pageNum:t,pageSize:n})}}function s(e){this.countPatentProcessOrders=function(){return e.get(CONTEXT_PATH+"/api/stat/patent/process/orders",{})},this.countProcessOrders=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/orders/"+t,{})},this.countUseTimeByProcess=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/taskUseTime/"+t,{})},this.countAlertNumByProcess=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/taskAlertNum/"+t,{})},this.countDueNumByProcess=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/taskDueNum/"+t,{})},this.countMaxUserAlert=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/alertUser/"+t,{})},this.countMaxUserDue=function(t){return e.get(CONTEXT_PATH+"/api/stat/process/dueUser/"+t,{})},this.countDetailForProcessOrders=function(t){return e.get(CONTEXT_PATH+"/api/stat/patent/process/orders/detail/"+t,{})}}e.module("SERVICES",[]).service("HttpService",["$q","$http",n]).service("AuthService",["$q","HttpService",r]).service("ToastService",["$rootScope","$log","GLOBAL_EVENTS",a]).service("FormService",o).service("MessageService",["HttpService",i]).service("StatService",["HttpService",s])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Configuration",["SERVICES","COMPONENTS"])}(angular),function(e,t){"use strict";function n(e,n,r,a,o,i,s){var l=this;o.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),l.contextPath=t,l.init=function(){l.metaType=i,l.valueType=s,l.paginationConf={currentPage:1,itemsPerPage:10},l.searchCondition={fromTime:moment().add(-180,"d").startOf("day").toDate().getTime(),toTime:moment().endOf("day").toDate().getTime()},$("#dateTimeRange").daterangepicker({startDate:moment(l.searchCondition.fromTime),endDate:moment(l.searchCondition.toTime),maxDate:moment(),showDropdowns:!1,showWeekNumbers:!1,timePickerIncrement:1,singleDatePicker:!1,locale:{separator:"~",applyLabel:"确认",cancelLabel:"取消",format:"YYYY-MM-DD",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},opens:"right",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small btn-default",format:"YYYY-MM-DD"},function(e,t,n){o.$apply(function(){l.searchCondition.fromTime=e.toDate().getTime(),l.searchCondition.toTime=t.toDate().getTime()})}).next().on("click",function(){$(this).prev().focus()}),o.$watch(function(){return l.paginationConf.itemsPerPage+" "+l.paginationConf.currentPage},l.search)},l.changeState=function(t,n){r.changeMetaState({key:t,state:n}).then(function(t){t&&0===t.code?(l.search(),e.toast({type:"success",body:"修改元数据状态成功"})):e.toast({type:"error",body:"修改元数据状态失败"})}).catch(function(e){a.info(e)})},l.openMetaEditer=function(e){n.openMetaEditer(e).then(function(e){0==e&&l.search()}).catch(function(e){a.info(e)})},l.addMeta=function(){l.openMetaEditer({model:"add"})},l.updateMeta=function(e){l.openMetaEditer({model:"update",meta:e})},l.viewMeta=function(e){n.openMetaViewer({title:"元数据展示",meta:e}).then(function(e){}).catch(function(e){a.info(e)})},l.reset=function(){l.searchCondition={fromTime:moment().add(-180,"d").startOf("day").toDate().getTime(),toTime:moment().endOf("day").toDate().getTime()}},l.search=function(){l.loading=!0,l.searchCondition.pageSize=l.paginationConf.itemsPerPage,l.searchCondition.pageNum=l.paginationConf.currentPage,r.searchMetas(l.searchCondition).then(function(t){l.loading=!1,t&&0===t.code?(l.paginationConf.totalItems=t.result.total,l.list=t.result.list,l.searching=!1):e.toast({type:"error",body:"获取元数据失败"})}).catch(function(t){l.loading=!1,e.toast({type:"error",body:t.message})})},l.init()}function r(e,t,n,r,a,o,i,s,l,c){var u=this;u.init=function(){u.metaType=l,u.valueType=c,u.title="添加元数据",u.currentMeta={values:[{},{},{}]},"update"==o.model&&(u.currentMeta=o.meta,u.title="编辑元数据")},u.addOneValue=function(){u.currentMeta.values.push({})},u.deleteOneValue=function(e){s.openAlert({title:"提示",message:"您是否要删除该元数据值?"}).then(function(t){if(0===t){if(!e.id){for(var r=0;r<u.currentMeta.values.length;r++){var a=u.currentMeta.values[r];if(e==a)return void u.currentMeta.values.splice(r,1)}return}i.deleteMetaValue(e.id).then(function(t){if(t&&0===t.code){n.toast({type:"success",body:"删除成功"});for(var r=0;r<u.currentMeta.values.length;r++){var a=u.currentMeta.values[r];e.id==a.id&&u.currentMeta.values.splice(r,1)}}else n.toast({type:"error",body:"删除失败"})}).catch(function(e){n.errHandler(e)})}}).catch(function(e){a.info(e)})},u.hasSelectedMetaType=function(){return!!u.currentMeta.type},u.hasSelectedValueType=function(){return!!u.currentMeta.valueType},u.notEmpty=function(e){return!!e},u.cancel=function(){t.dismiss("cancel")},u.ok=function(){if(!u.currentMeta)return void u.init();var e=!1;if(u.currentMeta.type||(n.toast({type:"error",body:"请先选择元数据类型"}),e=!0),u.currentMeta.valueType||(n.toast({type:"error",body:"请先选择元数据值类型"}),e=!0),!e){for(var r=0;r<u.currentMeta.values.length;r++){u.currentMeta.values[r].name||(u.currentMeta.values.splice(r,1),r--)}var a;delete u.currentMeta.user,a="update"==o.model?i.updateMeta(u.currentMeta):i.addMeta(u.currentMeta),a.then(function(e){e&&0===e.code?(n.toast({type:"success",body:"编辑成功"}),t.close(0)):n.toast({type:"error",body:"编辑失败"})}).catch(function(e){n.errHandler(e)})}},u.init()}function a(e,t,n,r,a,o){var i=this;i.init=function(){i.title=a.title,i.currentMeta=a.meta},i.cancel=function(){t.dismiss("cancel")},i.init()}e.module("Configuration").controller("MetaCtrl",["ToastService","ModalService","MetaService","$log","$scope","META_TYPE","VALUE_TYPE",n]).controller("MetaEditCtrl",["$scope","$uibModalInstance","ToastService","HttpService","$log","metaConfig","MetaService","ModalService","META_TYPE","VALUE_TYPE",r]).controller("MetaViewerCtrl",["$scope","$uibModalInstance","ToastService","$log","metaConfig","MetaService",a])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.getMeta=function(n){return e.get(t+"/api/meta/get/"+n,{})},this.getMetaByPrimaryKey=function(n){return e.get(t+"/api/meta/"+n,{})},this.searchMetas=function(n){return e.get(t+"/api/meta/search/",n)},this.getAllMetas=function(n){return e.get(t+"/api/meta/all/",n)},this.getMetaValues=function(n){return e.get(t+"/api/meta/values/"+n,{})},this.addMeta=function(n){return e.post(t+"/api/meta/add/",n)},this.updateMeta=function(n){return e.post(t+"/api/meta/update/",n)},this.changeMetaState=function(n){return e.post(t+"/api/meta/changeState/",n)},this.deleteMetaValue=function(n){return e.delete(t+"/api/meta/value/delete/"+n,{})}}function r(e){this.get=function(n){return e.get(t+"/api/label/get/"+n,{})},this.getByPrimaryKey=function(n){return e.get(t+"/api/label/"+n,{})},this.search=function(n){return e.get(t+"/api/label/search/",n)},this.getByType=function(n,r){return e.get(t+"/api/label/"+n,r)},this.add=function(n){return e.post(t+"/api/label/add/",n)},this.update=function(n){return e.post(t+"/api/label/update/",n)},this.changeState=function(n){return e.post(t+"/api/label/changeState/",n)}}e.module("Configuration").service("MetaService",["HttpService",n]).service("LabelService",["HttpService",r])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Dashboard",["SERVICES","MODALS","ui.bootstrap","ngSanitize"])}(angular),function(e){"use strict";function t(e,t,n,r){}function n(t,n,r,a){var o=this;t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),o.processOrderStat={},o.currentProcessType=2,o.specialProcessOrderStat={},o.changeCurrentProcessType=function(e){o.currentProcessType=e},o.countPatentProcessOrders=function(){a.countPatentProcessOrders().then(function(t){t&&0===t.code&&e.merge(o.processOrderStat,t.result)})},o.countPatentProcessOrders()}function r(e,t,n){var r=this;e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),r.init=function(){r.loading={o1:!1,o2:!1,o3:!1,o4:!1,o5:!1},r.searching={o1:!1,o2:!1,o3:!1,o4:!1,o5:!1},r.orders={o1:null,o2:null,o3:null,o4:null,o5:null},r.paginationConf={o1:{currentPage:1,itemsPerPage:10},o2:{currentPage:1,itemsPerPage:10},o3:{currentPage:1,itemsPerPage:10},o4:{currentPage:1,itemsPerPage:10},o5:{currentPage:1,itemsPerPage:10}},e.$watch(function(){return r.paginationConf.o1.itemsPerPage+" "+r.paginationConf.o1.currentPage},r.findDashboardOrders1),e.$watch(function(){return r.paginationConf.o2.itemsPerPage+" "+r.paginationConf.o2.currentPage},r.findDashboardOrders2),e.$watch(function(){return r.paginationConf.o3.itemsPerPage+" "+r.paginationConf.o3.currentPage},r.findDashboardOrders3),e.$watch(function(){return r.paginationConf.o4.itemsPerPage+" "+r.paginationConf.o4.currentPage},r.findDashboardOrders4),e.$watch(function(){return r.paginationConf.o5.itemsPerPage+" "+r.paginationConf.o5.currentPage},r.findDashboardOrders5)},r.findDashboardOrders1=function(e){r.loading.o1=!0;var a={pageSize:r.paginationConf.o1.itemsPerPage,pageNum:r.paginationConf.o1.currentPage};n.findDashboardOrders1(a).then(function(e){r.loading.o1=!1,0===e.code?(r.paginationConf.o1.totalItems=e.result.total,r.orders.o1=e.result.list,r.searching.o1=!1):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading.o1=!1,t.errHandler(e)})},r.findDashboardOrders2=function(e){r.loading.o2=!0;var a={pageSize:r.paginationConf.o2.itemsPerPage,pageNum:r.paginationConf.o2.currentPage};n.findDashboardOrders2(a).then(function(e){r.loading.o2=!1,0===e.code?(r.paginationConf.o2.totalItems=e.result.total,r.orders.o2=e.result.list,r.searching.o2=!1):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading.o2=!1,t.errHandler(e)})},r.findDashboardOrders3=function(e){r.loading.o3=!0;var a={pageSize:r.paginationConf.o3.itemsPerPage,pageNum:r.paginationConf.o3.currentPage};n.findDashboardOrders3(a).then(function(e){r.loading.o3=!1,0===e.code?(r.paginationConf.o3.totalItems=e.result.total,r.orders.o3=e.result.list,r.searching.o3=!1):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading.o3=!1,t.errHandler(e)})},r.findDashboardOrders4=function(e){r.loading.o4=!0;var a={pageSize:r.paginationConf.o4.itemsPerPage,pageNum:r.paginationConf.o4.currentPage};n.findDashboardOrders4(a).then(function(e){r.loading.o4=!1,0===e.code?(r.paginationConf.o4.totalItems=e.result.total,r.orders.o4=e.result.list,r.searching.o4=!1):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading.o4=!1,t.errHandler(e)})},r.findDashboardOrders5=function(e){r.loading.o5=!0;var a={pageSize:r.paginationConf.o5.itemsPerPage,pageNum:r.paginationConf.o5.currentPage};n.findDashboardOrders5(a).then(function(e){r.loading.o5=!1,0===e.code?(r.paginationConf.o5.totalItems=e.result.total,r.orders.o5=e.result.list,r.searching.o5=!1):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading.o5=!1,t.errHandler(e)})},r.init()}e.module("Dashboard").controller("DashboardPersonalController",["$scope","ToastService","DashboardPersonalService",r]).controller("PatentDashboardCtrl",["$scope","ToastService","ModalService","StatService",n]).controller("EnterpriseDashboardCtrl",["$scope","ToastService","ModalService","StatService",t])}(angular),function(e,t){"use strict";function n(e){this.findDashboardOrders1=function(n){return e.get(t+"/api/instance/process/order/due",n)},this.findDashboardOrders2=function(n){return e.get(t+"/api/instance/process/order/alert",n)},this.findDashboardOrders3=function(n){return e.get(t+"/api/instance/process/order/unfinished",n)},this.findDashboardOrders4=function(n){return e.get(t+"/api/instance/process/order/finished",n)},this.findDashboardOrders5=function(n){
return e.get(t+"/api/instance/process/order/back",n)}}e.module("Dashboard").service("DashboardPersonalService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("ElSearch",["SERVICES","COMPONENTS","ui.bootstrap"])}(angular),function(e){"use strict";function t(e,t,n,r,a,o,i){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var s=this;s.loading=!1,s.keywords=n.keywords||"",s.paginationConf={currentPage:1,itemsPerPage:50},e.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search),s.onSearch=function(e){13===e.keyCode&&s.search()},s.onSearch=function(e){13===e.keyCode&&s.search()},s.search=function(){s.loading=!0,o.search(s.keywords,s.paginationConf.currentPage,s.paginationConf.itemsPerPage).then(function(e){s.loading=!1,0===e.code?(s.paginationConf.totalItems=e.result.total,s.patents=e.result.list,s.searching=!1):r.toast({type:"error",body:"查询企业信息出错："+e.message})}).catch(function(e){s.loading=!1,r.errHandler(e)})},s.search()}e.module("ElSearch").controller("ElPatentCtrl",["$scope","$state","$stateParams","ToastService","ModalService","ElPatentService","ElPatentAction",t])}(angular),function(e,t){"use strict";function n(e){this.search=function(n,r,a){var o={keywords:n||"",pageNum:r||1,pageSize:a||50};return e.get(t+"/api/elsearch/patent",o)}}function r(e){}e.module("ElSearch").service("ElPatentService",["HttpService",n]).service("ElPatentAction",["$uibModal",r])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Expert",["SERVICES","COMPONENTS"])}(angular),function(e,t){"use strict";function n(e,t,n,r,a,o,i){var s=this;e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),s.init=function(){s.selectSpec=!1,s.selectIpc=!1,s.editId=i.params.id,s.editId&&(s.isUpdate=!0,s.get())},s.get=function(){o.get(s.editId).then(function(e){0===e.code?s.expert=e.result:a.toast({type:"error",body:e.detailMessage})})},s.changeSpec=function(){s.selectSpec=!s.selectSpec},s.changeIpc=function(){s.selectIpc=!s.selectIpc},s.edit=function(){s.isUpdate?s.update():s.add()},s.close=function(){i.go("main.console.expert.list")},s.add=function(){o.add(s.expert).then(function(e){0===e.code?(a.toast({type:"success",body:"添加专家成功"}),i.go("main.console.expert.list")):a.toast({type:"error",body:e.detailMessage})})},s.update=function(){o.update(s.expert).then(function(e){0===e.code?(a.toast({type:"success",body:"修改专家成功"}),i.go("main.console.expert.list")):a.toast({type:"error",body:e.detailMessage})})},s.init()}function r(e,t,n,r,a,o,i){var s=this;e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),s.init=function(){s.reset(),s.getAllUsers(),s.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search)},s.reset=function(){s.searchCondition={}},s.getAllUsers=function(){i.getUsers(1,9999).then(function(e){s.users=[],e&&0===e.code?s.users=s.users.concat(e.result.list):a.toast({type:"error",body:"获取用户失败"})}).catch(a.errHandler)},s.openIpcSelector=function(){r.openIpcSelector(s.ipcField).then(function(e){s.ipcField=e,s.searchCondition.specialties=null,e.t1&&(s.searchCondition.specialties=e.t2.code)}).catch(function(e){$log.info(e)})},s.onDatetimeRangeChanged=function(e,t){s.searchCondition.optDateFrom=e?e.toDate().getTime():e,s.searchCondition.optDateTo=t?t.toDate().getTime():t},s.changeAllSelected=function(){s.experts.forEach(function(e){e.selected=s.allSelected})},s.changeSelected=function(){var e=s.patents.filter(function(e){return e.selected}).length;s.allSelected=e==s.patents.length},s.search=function(){s.loading=!0,s.searchCondition.pageSize=s.paginationConf.itemsPerPage,s.searchCondition.pageNum=s.paginationConf.currentPage,s.searchCondition.institutions=e.nullIfSpaceOrEmpty(s.searchCondition.institutions),s.searchCondition.name=e.nullIfSpaceOrEmpty(s.searchCondition.name),s.searchCondition.ipcField=e.nullIfSpaceOrEmpty(s.searchCondition.ipcField),s.searchCondition.keyword=e.nullIfSpaceOrEmpty(s.searchCondition.keyword),s.searchCondition.userId=e.nullIfSpaceOrEmpty(s.searchCondition.userId),s.searchCondition.specialties=e.nullIfSpaceOrEmpty(s.searchCondition.specialties),s.searchCondition.optDateFrom=e.nullIfSpaceOrEmpty(s.searchCondition.optDateFrom),s.searchCondition.optDateTo=e.nullIfSpaceOrEmpty(s.searchCondition.optDateTo),o.search(s.searchCondition).then(function(e){s.loading=!1,0===e.code?(s.paginationConf.totalItems=e.result.total,s.experts=[],e.result.list.forEach(function(e){e.selected=!1,s.experts.push(e)}),s.searching=!1):a.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,a.errHandler(e)})},s.openSpecialtiesDlg=function(){r.openSpecDlg(s.nationalEconomyField).then(function(t){s.nationalEconomyField=t,s.currentNationalEconomyField=e.getNationalEconomy(t),s.searchCondition.specialties=null,s.nationalEconomyField.t1&&(s.searchCondition.specialties=s.currentNationalEconomyField.code)}).catch(function(e){$log.info(e)})},s.getAllIpc=function(){s.loading=!0,o.getAllIPC().then(function(e){if(s.loading=!1,e&&0===e.code){if(s.ipcs=e.result,defaultValue)for(var t=0;t<s.ipcs.length;t++)s.ipcs[t].id===defaultValue.t1.id&&(s.t1=s.ipcs[t]);if(s.t1)for(var t=0;t<s.t1.sonIPCFields.length;t++)s.t1.sonIPCFields[t].id===defaultValue.t2.id&&(s.t2=s.t1.sonIPCFields[t])}else a.toast({type:"error",body:"请求IPC领域失败:"+e.message})}).catch(function(e){s.loading=!1,a.errHandler(e)})},s.init()}e.module("Expert").controller("ExpertController",["$scope","$filter","$location","ModalService","ToastService","ExpertService","UserService",r]).controller("ExpertEditController",["$scope","$filter","$location","ModalService","ToastService","ExpertService","$state",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.search=function(n){return e.get(t+"/api/expert/search/",n)},this.getAllIPC=function(){return e.get(t+"/api/expert/ipc/all/")},this.add=function(n){return e.post(t+"/api/expert/add/",n)},this.update=function(n){return e.post(t+"/api/expert/update/",n)},this.get=function(n){return e.get(t+"/api/expert/"+n)}}e.module("Expert").service("ExpertService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Enterprise",["SERVICES","COMPONENTS","ui.bootstrap"])}(angular),function(e){"use strict";function t(e,t,n,r,a,o){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var i=this;i.init=function(){i.loading=!1,i.allSelected=!1,i.enterprises=[],i.paginationConf={currentPage:1,itemsPerPage:10},i.reset(),e.$watch(function(){return i.paginationConf.itemsPerPage+" "+i.paginationConf.currentPage},i.search)},i.reset=function(){i.query={},i.nationalEconomyField=null,i.currentNationalEconomyField=null,i.region=null},i.openNationalDlg=function(){r.openNationalDlg(i.nationalEconomyField).then(function(t){i.nationalEconomyField=t,i.currentNationalEconomyField=e.getNationalEconomy(t)}).catch(function(e){$log.info(e)})},i.openRegionDlg=function(){r.openRegionDlg(i.region).then(function(e){i.region=e}).catch(function(e){$log.info(e)})},i.onDatetimeRangeChanged=function(e,t,n){i.query.optDateFrom=t?t.toDate().getTime():t,i.query.optDateTo=n?n.toDate().getTime():n},i.changeAllSelected=function(){i.enterprises.forEach(function(e){e.selected=i.allSelected})},i.changeSelected=function(){var e=i.enterprises.filter(function(e){return e.selected}).length;i.allSelected=e==i.enterprises.length},i.search=function(){i.loading=!0,i.query.pageSize=i.paginationConf.itemsPerPage,i.query.pageNum=i.paginationConf.currentPage,i.query.name=e.nullIfSpaceOrEmpty(i.query.name),i.query.nationalEconomyField=null==i.currentNationalEconomyField?null:i.currentNationalEconomyField.code,i.query.provinceId=null==i.region?null:null==i.region.t1?null:i.region.t1.id,i.query.cityId=null==i.region?null:null==i.region.t2?null:i.region.t2.id,i.query.districtId=null==i.region?null:null==i.region.t3?null:i.region.t3.id,a.search(i.query).then(function(e){i.loading=!1,0===e.code?(i.paginationConf.totalItems=e.result.total,i.enterprises=[],e.result.list.forEach(function(e){i.enterprises.push({selected:!1,data:e})}),i.searching=!1):n.toast({type:"error",body:"查询企业信息出错："+e.message})}).catch(function(e){i.loading=!1,n.errHandler(e)})},i.startProcess=function(e,t){var r=[];if(null==t?i.enterprises.forEach(function(e){e.selected&&r.push(e.data)}):r.push(t),0==r.length)return void n.toast({type:"warn",body:"请至少选择一个企业信息！"});i.request(e,r)},i.request=function(e,t){i.loading=!0,a.startProcess(e,t).then(function(e){e&&0===e.code?(i.search(),n.toast({type:"success",body:e.result})):n.toast({type:"info",body:e.message})}).catch(function(e){n.toast({type:"error",body:e.message})}).finally(function(){i.loading=!1})},i.editEnterprise=function(e,n){n<0?t.go("main.console.enterprise.add"):t.go("main.console.enterprise.edit",{id:e.id})},i.init()}function n(t,n,r,a,o,i,s,l){t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var c=this;c.loading=!1,c.isEdit=l,e.merge(this,n),c.enterprise=l?{id:s.id}:{},c.openRegionDlg=function(){a.openRegionDlg(c.region).then(function(e){c.region=e,c.region&&c.region.t1?c.enterprise.provinceId=c.region.t1.id:c.enterprise.provinceId=null,c.region&&c.region.t1?c.enterprise.cityId=c.region.t2.id:c.enterprise.cityId=null,c.region&&c.region.t3?c.enterprise.districtId=c.region.t3.id:c.enterprise.districtId=null,c.regionChanged=!0}).catch(function(e){$log.info(e)})},c.getBottomNationalFields=function(e,t){return o.nationalEconomyFields(e).then(function(e){return e&&0===e.code?(t&&(c.enterprise.nationalEconomyField=e.result.filter(function(e){return e.code===c.enterprise.nationalEconomyField})[0]),e.result):[]})},c.onSubmit=function(){var t=e.copy(c.enterprise);if(t.nationalEconomyField&&"string"==typeof t.nationalEconomyField)return void r.toast({type:"warn",body:"请输入国民经济领域关键词或代码，并从下拉列表中选择！"});"string"!=typeof t.nationalEconomyField&&(t.nationalEconomyField=t.nationalEconomyField.code),c.isEdit?o.update(t).then(function(e){e&&0===e.code?(r.toast({type:"success",body:"编辑企业信息成功！"}),i.go("^.start")):r.toast({type:"error",body:e.message})}).catch(function(e){r.errHandler(e)}):o.save(t).then(function(e){e&&0===e.code?(r.toast({type:"success",body:"添加企业信息成功！"}),i.go("^.start")):r.toast({type:"error",body:e.message})}).catch(function(e){r.errHandler(e)})},c.cancel=function(){i.go("^.start")},c.findDetail=function(t){c.loading=!0,o.detail(t).then(function(t){c.loading=!1,0===t.code?(e.merge(c.enterprise,t.result),c.enterprise.province&&(c.region||(c.region={}),c.region.t1=c.enterprise.province),c.enterprise.city&&(c.region||(c.region={}),c.region.t2=c.enterprise.city),c.enterprise.district&&(c.region||(c.region={}),c.region.t3=c.enterprise.district),c.getBottomNationalFields(c.enterprise.nationalEconomyField,!0)):r.toast({type:"error",body:t.message})}).catch(function(e){r.errHandler(e)})},c.isEdit&&c.findDetail(s.id)}function r(t,n,r,a,o,i,s){t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var l=this;l.init=function(){l.loading=!1,l.allSelected=!1,l.requirements=[],l.paginationConf={currentPage:1,itemsPerPage:10},l.reset(),t.$watch(function(){return l.paginationConf.itemsPerPage+" "+l.paginationConf.currentPage},l.search)},l.reset=function(){l.query={enterprise:{}},l.nationalEconomyField=null,l.currentNationalEconomyField=null,l.region=null},l.onDatetimeRangeChanged=function(e,t,n){l.query.optDateFrom=t?t.toDate().getTime():t,l.query.optDateTo=n?n.toDate().getTime():n},l.changeAllSelected=function(){l.requirements.forEach(function(e){e.selected=l.allSelected})},l.changeSelected=function(){var e=l.requirements.filter(function(e){return e.selected}).length;l.allSelected=e==l.requirements.length},l.openNationalDlg=function(){r.openNationalDlg(l.nationalEconomyField).then(function(e){l.nationalEconomyField=e,l.currentNationalEconomyField=t.getNationalEconomy(e)}).catch(function(e){$log.info(e)})},l.openRegionDlg=function(){r.openRegionDlg(l.region).then(function(e){l.region=e}).catch(function(e){$log.info(e)})},l.search=function(){l.loading=!0,l.query.pageSize=l.paginationConf.itemsPerPage,l.query.pageNum=l.paginationConf.currentPage,l.query.requirement=t.nullIfSpaceOrEmpty(l.query.requirement),l.query.enterprise.name=t.nullIfSpaceOrEmpty(l.query.enterprise.name),l.query.enterprise.nationalEconomyField=null==l.currentNationalEconomyField?null:l.currentNationalEconomyField.code,l.query.enterprise.provinceId=null==l.region?null:null==l.region.t1?null:l.region.t1.id,l.query.enterprise.cityId=null==l.region?null:null==l.region.t2?null:l.region.t2.id,l.query.enterprise.districtId=null==l.region?null:null==l.region.t3?null:l.region.t3.id;var r=e.copy(l.query),o=r.enterprise;o&&(delete r.enterprise,e.forEach(o,function(e,t){r["enterprise."+t]=e})),a.search(r).then(function(e){l.loading=!1,0===e.code?(l.paginationConf.totalItems=e.result.total,l.requirements=[],e.result.list.forEach(function(e){l.requirements.push({selected:!1,data:e})}),l.searching=!1):n.toast({type:"error",body:"查询企业需求出错："+e.message})}).catch(function(e){l.loading=!1,n.errHandler(e)})},l.startProcess=function(e,t,r){var a=[];if(null==r?l.requirements.forEach(function(e){e.selected&&a.push(e.data)}):a.push(r),0==a.length)return void n.toast({type:"warn",body:"请至少选择一个企业需求！"});l.request(e,t,a)},l.request=function(e,t,r){l.loading=!0;var o=i.filter(function(t){return t.key==e})[0].id,c=s.filter(function(e){return e.key==t})[0].id;a.startProcess(o,c,r).then(function(e){e&&0===e.code?(l.search(),n.toast({type:"success",body:e.result})):n.toast({type:"info",body:e.message})}).catch(function(e){n.toast({type:"error",body:e.message})}).finally(function(){l.loading=!1})},l.editRequirement=function(t,n){o.addOrEditRequirement(e.copy(t)).then(function(e,t){t?l.requirements.splice(n,1,e):l.search()}).catch(function(e){})},l.init()}function a(t,n,r,a,o,i,s,l){var c=this;e.merge(this,n),c.isEdit=void 0!==l.id,c.requirement=l,c.getEnterprises=function(e){return o.autoComplete({name:e}).then(function(e){return 0===e.code?e.result:[]})},c.cancel=function(){s.dismiss("cancel")},c.ok=function(){if(c.requirement.enterprise&&"string"==typeof c.requirement.enterprise)return void r.toast({type:"warn",body:"请输入企业名称关键词，并从下拉列表中选择！"});c.requirement.enterpriseId=c.requirement.enterprise.id,c.isEdit?i.update(c.requirement).then(function(e){e&&0===e.code?s.close(e.result,c.isEdit):r.toast({type:"error",body:e.message})}).catch(function(e){r.errHandler(e)}):i.save(c.requirement).then(function(e){e&&0===e.code?s.close(e.result,c.isEdit):r.toast({type:"error",body:e.message})}).catch(function(e){r.errHandler(e)})}}e.module("Enterprise").controller("EnterpriseListCtrl",["$scope","$state","ToastService","ModalService","EnterpriseService","EnterpriseAction",t]).controller("EnterpriseRequirementListCtrl",["$scope","ToastService","ModalService","EnterpriseRequirementService","EnterpriseRequirementAction","INSTANCE_TYPE","PATENT_PROCESS_TYPE",r]).controller("EnterpriseEditCtrl",["$scope","FormService","ToastService","ModalService","EnterpriseService","$state","$stateParams","isEdit",n]).controller("RequirementEditCtrl",["$scope","FormService","ToastService","ModalService","EnterpriseService","EnterpriseRequirementService","$uibModalInstance","requirement",a])}(angular),function(e,t){"use strict";function n(e){this.search=function(n){return e.get(t+"/api/enterprise/",n)},this.autoComplete=function(n){return e.get(t+"/api/enterprise/auto/complete",n)},this.nationalEconomyFields=function(n){return e.get(t+"/api/nationaleconomy/bottoms",{keyword:n})},this.detail=function(n){return e.get(t+"/api/enterprise/"+n)},this.save=function(n){return e.put(t+"/api/enterprise/",n)},this.update=function(n){return e.post(t+"/api/enterprise/",n)},this.delete=function(n){return e.delete(t+"/api/enterprise/",n)},this.startProcess=function(n,r){return e.post(t+"/api/enterprise/start/process/"+n,r)}}function r(e){this.addOrEditEnterprise=function(n){return e.open({animation:!0,templateUrl:t+"/static/tpls/enterprise/edit.html",controller:"EnterpriseEditCtrl",controllerAs:"eec",size:"lg",resolve:{enterprise:n}}).result}}function a(e){this.search=function(n){return e.get(t+"/api/requirement/",n)},this.detail=function(n){return e.get(t+"/api/requirement/"+n)},this.save=function(n){return e.put(t+"/api/requirement/",n)},this.update=function(n){return e.post(t+"/api/requirement/",n)},this.delete=function(n){return e.delete(t+"/api/requirement/",n)},this.startProcess=function(n,r,a){return e.post(t+"/api/requirement/start/process/"+n+"/"+r,a)}}function o(e){this.addOrEditRequirement=function(n){return e.open({animation:!0,templateUrl:t+"/static/tpls/enterprise/edit.require.html",controller:"RequirementEditCtrl",controllerAs:"rec",size:"lg",resolve:{requirement:n}}).result}}e.module("Enterprise").service("EnterpriseService",["HttpService",n]).service("EnterpriseRequirementService",["HttpService",a]).service("EnterpriseAction",["$uibModal",r]).service("EnterpriseRequirementAction",["$uibModal",o])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Patent",["SERVICES","COMPONENTS"])}(angular),function(e,t){"use strict";function n(e){this.search=function(n){return e.get(t+"/api/patent/search",n)}}e.module("Patent").service("PatentService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("MODALS",["SERVICES","ui.bootstrap","ngSanitize"])}(angular),function(e){"use strict";function t(e,t){var n=this;n.alertInfo=t,n.alertClass=function(){var e=n.alertInfo.type||"default";return{"bg-danger":"danger"===e,"bg-warning":"warning"===e,"bg-error":"error"===e,"bg-primary":"primary"===e,"bg-info":"info"===e}},n.ok=function(){e.close(0)},n.cancel=function(){e.dismiss("cancel")}}function n(t,n,r,a){var o=this;o.init=function(){o.loading=!1,o.region={t1:null!=a&&null!=a.t1?e.toJson(a.t1):null,t2:null!=a&&null!=a.t2?e.toJson(a.t2):null,t3:null!=a&&null!=a.t3?e.toJson(a.t3):null},o.getAllRegions()},o.getAllRegions=function(){o.loading=!0,n.getAllRegions().then(function(e){o.loading=!1,e&&0===e.code?(o.regions=e.result,o.t1s=[],o.t2s=[],o.t3s=[],o.regions.forEach(function(e){0!=e.parentId&&null!=e.parentId||o.t1s.push(e)}),null!=o.region&&null!=o.region.t1&&o.regionChange(1,o.region.t1),null!=o.region&&null!=o.region.t2&&o.regionChange(2,o.region.t2)):r.toast({type:"error",body:"请求行政区域失败:"+e.message})}).catch(function(e){o.loading=!1,r.errHandler(e)})},o.regionChange=function(t,n){var r=""==n?null:e.fromJson(n);1==t?(o.t2s=[],o.t3s=[],o.regions.forEach(function(e){e.parentId==r.id&&o.t2s.push(e)})):2==t&&(o.t3s=[],o.regions.forEach(function(e){e.parentId==r.id&&o.t3s.push(e)}))},o.ok=function(){var n={t1:null,t2:null,t3:null};null==o.region?n=null:(n.t1=null==o.region.t1||""==o.region.t1?null:e.fromJson(o.region.t1),n.t2=null==o.region.t2||""==o.region.t2?null:e.fromJson(o.region.t2),n.t3=null==o.region.t3||""==o.region.t3?null:e.fromJson(o.region.t3)),null==n.t1&&null==n.t2&&null==n.t3&&(n=null),t.close(n)},o.cancel=function(){t.close(null)},o.init()}function r(t,n,r,a,o){var i=this;i.init=function(){i.loading=!1,i.getAllIpc()},i.getAllIpc=function(){i.loading=!0,o.getAllIPC().then(function(e){if(i.loading=!1,e&&0===e.code){if(i.ipcs=e.result,a)for(var t=0;t<i.ipcs.length;t++)i.ipcs[t].id===a.t1.id&&(i.t1=i.ipcs[t]);if(i.t1)for(var t=0;t<i.t1.sonIPCFields.length;t++)i.t1.sonIPCFields[t].id===a.t2.id&&(i.t2=i.t1.sonIPCFields[t])}else r.toast({type:"error",body:"请求IPC领域失败:"+e.message})}).catch(function(e){i.loading=!1,r.errHandler(e)})},i.ok=function(){var n={t1:null,t2:null};null==i.ipcs?n=null:(n.t1=null==i.t1||""==i.t1?null:e.fromJson(i.t1),n.t2=null==i.t2||""==i.t2?null:e.fromJson(i.t2)),null==n.t1&&null==n.t2&&(n=null),t.close(n)},i.cancel=function(){t.close(null)},i.init()}function a(t,n,r,a){var o=this;o.init=function(){o.loading=!1,o.national={t1:null!=a&&null!=a.t1?e.toJson(a.t1):null,t2:null!=a&&null!=a.t2?e.toJson(a.t2):null,t3:null!=a&&null!=a.t3?e.toJson(a.t3):null,t4:null!=a&&null!=a.t4?e.toJson(a.t4):null},o.getAllNationals()},o.getAllNationals=function(){o.loading=!0,n.getAllNationals().then(function(e){o.loading=!1,e&&0===e.code?(o.nationals=e.result,o.t1s=[],o.t2s=[],o.t3s=[],o.t4s=[],o.nationals.forEach(function(e){0!=e.parentId&&null!=e.parentId||o.t1s.push(e)}),null!=o.national&&null!=o.national.t1&&o.nationalChange(1,o.national.t1),null!=o.national&&null!=o.national.t2&&o.nationalChange(2,o.national.t2),null!=o.national&&null!=o.national.t3&&o.nationalChange(3,o.national.t3)):r.toast({type:"error",body:"请求国名经济代码失败:"+e.message})}).catch(function(e){o.loading=!1,r.errHandler(e)})},o.nationalChange=function(t,n){var r=""==n?null:e.fromJson(n);1==t?(o.t2s=[],o.t3s=[],o.t4s=[],null!=r&&o.nationals.forEach(function(e){e.parentId==r.id&&o.t2s.push(e)})):2==t?(o.t3s=[],o.t4s=[],null!=r&&o.nationals.forEach(function(e){e.parentId==r.id&&o.t3s.push(e)})):3==t&&(o.t4s=[],null!=r&&o.nationals.forEach(function(e){e.parentId==r.id&&o.t4s.push(e)}))},o.ok=function(){var n={t1:null,t2:null,t3:null,t4:null};null==o.national?n=null:(n.t1=null==o.national.t1||""==o.national.t1?null:e.fromJson(o.national.t1),n.t2=null==o.national.t2||""==o.national.t2?null:e.fromJson(o.national.t2),n.t3=null==o.national.t3||""==o.national.t3?null:e.fromJson(o.national.t3),n.t4=null==o.national.t4||""==o.national.t4?null:e.fromJson(o.national.t4)),null==n.t1&&null==n.t2&&null==n.t3&&null==n.t4&&(n=null),t.close(n)},o.cancel=function(){t.close(null)},o.init()}function o(e,t,n){var r=this;r.loading=!1,r.nodes={id:"0",text:"PMES",icon:"fa fa-circle-o",state:{opened:!0}},r.onTreeReady=function(e,t){r.treeCtrl||(r.treeCtrl=t,r.getOrganizations())},r.organizationChildren=function(e){if(e.sonOrganizations)return e.sonOrganizations.map(function(e){return{id:e.id,name:e.remark,text:e.name,icon:e.pic||"fa fa-file",state:{opened:!0},children:r.organizationChildren(e)}})},r.onNodeSelected=function(e){r.loading=!0,t.getOrganizationById(e).then(function(e){r.loading=!1,e&&0===e.code?r.selectedOrganization=e.result:n.toast({type:"error",body:"请求组织机构失败:"+e.message})}).catch(function(e){r.loading=!1,n.errHandler(e)})},r.getOrganizations=function(){r.loading=!0,t.getOrganizations().then(function(e){r.loading=!1,e&&0===e.code?(r.organizations=e.result,r.nodes.children=e.result.map(function(e){return{id:e.id,name:e.remark,text:e.name,state:{opened:!0},icon:e.pic||"fa fa-folder",children:r.organizationChildren(e)}}),r.treeCtrl&&r.treeCtrl.refresh()):n.toast({type:"error",body:"请求组织机构失败:"+e.message})}).catch(function(e){r.loading=!1,n.errHandler(e)})},r.alertClass=function(){var e=r.alertInfo.type||"default";return{"bg-danger":"danger"===e,"bg-warning":"warning"===e,"bg-error":"error"===e,"bg-primary":"primary"===e,"bg-info":"info"===e}},r.ok=function(){if(!r.selectedOrganization)return void n.toast({type:"info",body:"未获取到您选择的组织机构信息"});e.close(r.selectedOrganization)},r.cancel=function(){e.dismiss("cancel")}}function i(t,n,r,a,o,i){var s=this,l="",c="";s.uploadConfig=i,s.uploadResult=[],a.info("self.uploadConfig",s.uploadConfig),"mp4"===s.uploadConfig.filter?(c="videoFilter",l="/upload/video/"):s.uploadConfig.filter.split(",").some(function(e){return"xlsx"===e||"xls"===e})?(c="excelFilter",l="/upload/excel/"+s.uploadConfig.subjectId):(c="imageFilter",l="/upload");var u=s.uploader=new o({url:l});u.filters.push({name:c,fn:function(e,t){var n=e.name.slice(e.name.lastIndexOf(".")+1);return-1!==s.uploadConfig.filter.indexOf(n)&&u.queue.length<s.uploadConfig.maxFiles}}),u.onAfterAddingFile=function(e){a.info("onAfterAddingFile",e),1===s.uploadConfig.maxFiles&&e.upload()},u.onSuccessItem=function(t,r,o,i){a.info("onSuccessItem",t,r,o,i),0===r.code?s.uploadResult.push(r.result):(t.remove(),e.element("#file").val(null),n.toast({type:"error",body:"上传失败:"+(r.message||"未知原因")}))},u.onErrorItem=function(t,r,o,i){a.info("onErrorItem",t,r,o,i),t.remove(),e.element("#file").val(null),n.toast({type:"error",body:"上传失败:"+(r.message||"未知原因")})},s.ok=function(){a.info("上传结果",s.uploadResult),t.close(s.uploadResult)},s.cancel=function(){t.dismiss("cancel")},s.uploadConfig.openFileDialogImmediately&&r(function(){e.element("#file").click()},1500)}function s(e,t,n,r,a,o){e.vodConfig=o,e.uploadStatus=0,e.uplaodInfo=void 0,e.progress=0;var i=e.uploader=new VODUpload({onUploadFailed:function(e,t,n){a.log("onUploadFailed: file:"+e.file.name+",code:"+t+", message:"+n)},onUploadSucceed:function(t){a.log("uploadInfo",t),e.$apply(function(){e.uploadStatus=2}),a.log("onUploadSucceed: "+t.file.name+", endpoint:"+t.endpoint+", bucket:"+t.bucket+", object:"+t.object)},onUploadProgress:function(t,n,r){var o=Math.ceil(100*r/n);e.$apply(function(){e.progress=o}),a.log("onUploadProgress:file:"+t.file.name+", fileSize:"+n+", percent:"+o+"%")},onUploadstarted:function(t){i.setUploadAuthAndAddress(t,e.uploadInfo.uploadAuth,e.uploadInfo.uploadAddress),a.log("onUploadStarted:"+t.file.name+", endpoint:"+t.endpoint+", bucket:"+t.bucket+", object:"+t.object)}});i.init(),e.fileChanged=function(t){e.$apply(function(){e.uploadFile=t.files[0],e.uplaodInfo=void 0})},e.$watch("uploadFile",function(t){a.log("newValue",t),t&&e.getUploadInfo(t.name)}),e.getUploadInfo=function(t,a){r.get("/api/video/auth/",{fileName:t}).then(function(t){t&&0===t.code?(e.uploadInfo=t.result,a&&a(null)):(a&&a(new Error(t.message)),n.toast({type:"error",body:"请求上传路径出错:"+t.message}))}).catch(function(e){a&&a(e),n.toast({type:"error",body:"请求上传路径出错:"+e.message})})},e.ok=function(){if(0===e.uploadStatus){if(!e.uploadFile)return n.toast({type:"error",body:"请先选择视频文件！"});e.uploadInfo?(i.addFile(e.uploadFile,null,null,null,'{"Vod":{"UserData":"{"IsShowWaterMark":"true","Priority":"7"}"}}'),i.startUpload(),e.uploadStatus=1):e.getUploadInfo(e.uploadFile.name,function(t){t?n.toast({type:"error",body:"获取上传地址失败,请稍候重试！"}):e.ok()})}else 2===e.uploadStatus?t.close(e.uploadInfo.videoId):t.dismiss("cancel")},e.cancel=function(){t.dismiss("cancel")}}e.module("MODALS").controller("AlertCtrl",["$uibModalInstance","alertInfo",t]).controller("OrganizationTreeCtrl",["$uibModalInstance","OrganizationService","ToastService",o]).controller("UploadCtrl",["$uibModalInstance","ToastService","$timeout","$log","FileUploader","uploadConfig",i]).controller("VodCtrl",["$scope","$uibModalInstance","ToastService","HttpService","$log","vodConfig",s]).controller("RegionCtrl",["$uibModalInstance","ModalService","ToastService","defaultValue",n]).controller("NationalCtrl",["$uibModalInstance","ModalService","ToastService","defaultValue",a]).controller("IpcCtrl",["$uibModalInstance","ModalService","ToastService","defaultValue","ExpertService",r])}(angular),function(e,t){"use strict";function n(n,r,a){var o=function(){return a.get(t+"/api/region/all",{})},i=function(){return a.get(t+"/api/nationaleconomy/all",{})},s=function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/alert.html",controller:"AlertCtrl",controllerAs:"alert",size:"lg",resolve:{alertInfo:function(){return e.merge({type:"info",hideCancel:!1},r||{})}}}).result},l=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/organizationTree.html",controller:"OrganizationTreeCtrl",controllerAs:"organTree",size:"lg"}).result},c=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/region.html",controller:"RegionCtrl",controllerAs:"regionCtrl",size:"lg",resolve:{defaultValue:e}}).result},u=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/national.html",controller:"NationalCtrl",controllerAs:"nationalCtrl",size:"lg",resolve:{defaultValue:e}}).result},d=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/specialties.html",controller:"NationalCtrl",controllerAs:"nationalCtrl",size:"lg",resolve:{defaultValue:e}}).result},p=function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/upload.html",controller:"UploadCtrl",controllerAs:"upload",size:"lg",resolve:{uploadConfig:function(){return e.merge({title:"上传",maxFiles:5,openFileDialogImmediately:!0,filter:"jpg,jpeg,png,pdf,mp4"},r||{})}}}).result},f=function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/vod.html",controller:"VodCtrl",controllerAs:"vod",size:"lg",resolve:{vodConfig:function(){return e.merge({title:"上传"},r||{})}}}).result},g=function(){return n.open({animation:!0,templateUrl:t+"/static/tpls/system/user/changePassword.html",controller:"ChangePasswordEditerCtrl",controllerAs:"cp",size:"lg",resolve:{cpConfig:function(){return e.merge({title:"修改密码"},{})}}}).result},m=function(){return n.open({animation:!0,templateUrl:t+"/static/tpls/system/user/changeProfile.html",controller:"ChangeProfileEditerCtrl",controllerAs:"cp",size:"lg",resolve:{cpConfig:function(){return e.merge({title:"编辑个人信息"},{})}}}).result};return{openAlert:s,openUploader:p,openVodUploader:f,openOrganTree:l,openChangePasswordEditer:g,openMetaEditer:function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/meta/metaEditer.html",controller:"MetaEditCtrl",controllerAs:"me",size:"lg",resolve:{metaConfig:function(){return e.merge({title:"元数据编辑"},r||{})}}}).result},openMetaViewer:function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/meta/metaViewer.html",controller:"MetaViewerCtrl",controllerAs:"me",size:"lg",resolve:{metaConfig:function(){return e.merge({title:"元数据展示"},r||{})}}}).result},openLabelEditer:function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/label/labelEditer.html",controller:"LabelEditCtrl",controllerAs:"labEdit",size:"lg",resolve:{labelConfig:function(){return e.merge({title:"标签编辑"},r||{})}}}).result},openLabelViewer:function(r){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/label/labelViewer.html",controller:"LabelViewerCtrl",controllerAs:"labView",size:"lg",resolve:{labelConfig:function(){return e.merge({title:"标签展示"},r||{})}}}).result},openRegionDlg:c,openNationalDlg:u,getAllRegions:o,getAllNationals:i,openSpecDlg:d,openIpcSelector:function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/modal/ipcSelector.html",controller:"IpcCtrl",controllerAs:"ipcCtrl",size:"lg",resolve:{defaultValue:e}}).result},openChangeProfileEditer:m}}e.module("MODALS").service("ModalService",["$uibModal","$log","HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Search",["SERVICES","COMPONENTS","ui.bootstrap"])}(angular),function(e){"use strict";e.module("SIDEBAR",["SERVICES"])}(angular),function(e){"use strict";function t(e,t,n,r,a,o,i){var s=this;s.selectedState=r.current.name,t.$on("$stateChangeSuccess",function(e,t,n,r){s.selectedState=t.name}),e.getLoginUser().then(function(e){s.user=e,s.getAuthorities()}).catch(o.errHandler),s.keywords=a.keywords||"",s.onSearch=function(e){13===e.keyCode&&s.search()},s.search=function(){r.go("main.console.elsearch.patent",{keywords:s.keywords})},s.getAuthorities=function(){i.getAuthoritiesByRoleId(s.user.roleId).then(function(e){e&&0===e.code?s.authorities=e.result:o.toast({type:"error",body:"请求权限失败："+e.message})}).catch(function(e){o.errHandler(e)})},s.isActive=function(e){return!!e&&(e.sonAuthorities.length>0?e.sonAuthorities.map(function(e){return e.url}):[e.url]).some(function(e){return e&&s.selectedState.indexOf(e)>=0})}}e.module("SIDEBAR").controller("SidebarCtrl",["AuthService","$rootScope","$scope","$state","$stateParams","ToastService","AuthorityService",t])}(angular),function(e){"use strict";e.module("Instance",["SERVICES","COMPONENTS"])}(angular),function(e,t){"use strict";function n(t,n,r,a,o){var i=this;e.merge(i,r),i.init=function(){i.loading=!1,i.processType=o.processType,i.taskType=o.taskType,i.taskOrders=o.taskOrders,i.keyword="",i.selectedUserId=-1,i.users=[],i.getUsers()},i.getUsers=function(){a.getUsers(i.taskOrders[0].id).then(function(e){e&&0===e.code?i.users=i.users.concat(e.result.list):n.toast({type:"error",body:"获取用户列表失败:"+e.message})}).catch(n.errHandler)},i.cancel=function(){t.dismiss("cancel")},i.ok=function(){
if(-1==i.selectedUserId)return void n.toast({type:"warn",body:"请分配一名操作人！"});var e=[];i.taskOrders.forEach(function(t){e.push({taskOrderId:t.id,assignUserId:i.selectedUserId})}),i.loading=!0,a.save(e).then(function(e){i.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.toast({type:"error",body:e.message})})},i.init()}function r(t,n,r,a,o){var i=this;e.merge(i,r),i.init=function(){i.loading=!1,i.processType=o.processType,i.taskType=o.taskType,i.taskOrders=o.taskOrders,i.keyword="",i.selectedUserId=-1,i.users=[],i.getUsers()},i.getUsers=function(){a.getRedeployCandidateUser(i.taskOrders[0].id).then(function(e){e&&0===e.code?i.users=i.users.concat(e.result.list):n.toast({type:"error",body:"获取用户列表失败:"+e.message})}).catch(n.errHandler)},i.cancel=function(){t.dismiss("cancel")},i.ok=function(){if(-1==i.selectedUserId)return void n.toast({type:"warn",body:"请分配一名操作人！"});var e=[];i.taskOrders.forEach(function(t){e.push({taskOrderId:t.id,assignUserId:i.selectedUserId})}),i.loading=!0,a.redeploy(e).then(function(e){i.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.toast({type:"error",body:e.message})})},i.init()}function a(t,n,r,a,o,i,s,l,c,u){var d=this;e.merge(d,i),d.init=function(){d.loading=!1,d.processType=l.filter(function(e){return e.key==r.processType})[0],d.taskType=c.filter(function(e){return e.key==r.taskType})[0],d.taskOrderId=r.taskOrderId,d.backUrl=r.backUrl,d.sources=u,d.taskOrderLabels=[],d.reason=null,d.isPatent=d.processType.key.toLowerCase().indexOf("patent")>=0,d.isEnterprise=d.processType.key.toLowerCase().indexOf("enterprise")>=0,d.isAutoIndex="AutoIndex"==d.taskType.key,d.isSemiAutoIndex="SemiAutoIndex"==d.taskType.key,d.isManualIndex="ManualIndex"==d.taskType.key,d.isValueIndex="ValueIndex"==d.taskType.key,d.isPriceIndex="PriceIndex"==d.taskType.key,d.isReadOnly=d.isAutoIndex||d.isValueIndex,d.isAutoIndex&&d.getAutoIndexLabels(),d.isSemiAutoIndex?d.getSemiAutoIndexLabels():d.isManualIndex?d.getManualIndexLabels():d.isValueIndex?d.getValueIndexLabels():d.isPriceIndex&&d.getPriceIndexLabels()},d.getAutoIndexLabels=function(){d.loading=!0,s.getAutoIndexLabels(d.taskOrderId).then(function(e){d.loading=!1,e&&0===e.code?(d.taskOrderLabels=d.taskOrderLabels.concat(e.result),d.tidyTaskOrderLabels()):o.toast({type:"error",body:"获取工单标签列表失败:"+e.message})}).catch(function(e){d.loading=!1,o.errHandler(e)})},d.getManualIndexLabels=function(){d.loading=!0,s.getManualIndexLabels(d.taskOrderId).then(function(e){d.loading=!1,e&&0===e.code?(d.taskOrderLabels=d.taskOrderLabels.concat(e.result.labels),d.reason=e.result.reason,d.tidyTaskOrderLabels()):o.toast({type:"error",body:"获取工单标签列表失败:"+e.message})}).catch(function(e){d.loading=!1,o.errHandler(e)})},d.getSemiAutoIndexLabels=function(){d.loading=!0,s.getSemiAutoIndexLabels(d.taskOrderId).then(function(e){d.loading=!1,e&&0===e.code?(d.taskOrderLabels=d.taskOrderLabels.concat(e.result.labels),d.reason=e.result.reason,d.tidyTaskOrderLabels()):o.toast({type:"error",body:"获取工单标签列表失败:"+e.message})}).catch(function(e){d.loading=!1,o.errHandler(e)})},d.getValueIndexLabels=function(){d.loading=!0,s.getValueIndexLabels(d.taskOrderId).then(function(e){d.loading=!1,e&&0===e.code?(d.taskOrderLabels=d.taskOrderLabels.concat(e.result),d.tidyTaskOrderLabels()):o.toast({type:"error",body:"获取工单标签列表失败:"+e.message})}).catch(function(e){d.loading=!1,o.errHandler(e)})},d.getPriceIndexLabels=function(){d.loading=!0,s.getPriceIndexLabels(d.taskOrderId).then(function(e){d.loading=!1,e&&0===e.code?(d.taskOrderLabels=d.taskOrderLabels.concat(e.result),d.tidyTaskOrderLabels()):o.toast({type:"error",body:"获取工单标签列表失败:"+e.message})}).catch(function(e){d.loading=!1,o.errHandler(e)})},d.tidyTaskOrderLabels=function(){d.taskOrderLabels.forEach(function(e){1!=e.label.valueType&&2!=e.label.valueType||null==e.label.value&&(e.label.value=e.label.defaultValue),5==e.label.valueType&&(e.label.minValue=NaN==parseFloat(e.label.minValue)?0:parseFloat(e.label.minValue),e.label.maxValue=NaN==parseFloat(e.label.maxValue)?0:parseFloat(e.label.maxValue),e.label.defaultValue=NaN==parseFloat(e.label.defaultValue)?0:parseFloat(e.label.defaultValue),null==e.label.value?e.label.value=e.label.defaultValue:e.label.value=NaN==parseFloat(e.label.value)?0:parseFloat(e.label.value))})},d.validCtrl=function(e,t,n){if(d.isAutoIndex)return!1;var r=!1,a=e.$$controls.filter(function(e){return e.$name=="tb"+t.label.key});if(1==a.length)if(1==t.label.valueType&&null==t.label.metaKey)r=(a[0].$dirty||n)&&a[0].$invalid;else if(null!=t.label.metaKey)t.label.isRequired&&(r=(a[0].$dirty||n)&&(null==t.label.value||""==t.label.value));else if(2==t.label.valueType)r=(a[0].$dirty||n)&&a[0].$invalid;else if(3==t.label.valueType)r=(a[0].$dirty||n)&&a[0].$invalid;else if(5==t.label.valueType)if(t.label.minValue==t.label.maxValue)r=(a[0].$dirty||n)&&a[0].$invalid;else{var o=parseFloat(t.label.value);r=(a[0].$dirty||n)&&(a[0].$invalid||NaN==o||o<t.label.minValue||o>t.label.maxValue)}return r},d.canSave=function(e){if(d.isAutoIndex)return!0;var t=d.taskOrderLabels.filter(function(t){return d.validCtrl(e,t,!0)});return t=0==t.length},d.back=function(){window.location.href=d.backUrl},d.save=function(){var e=[{taskOrderId:d.taskOrderId,caledLabels:d.taskOrderLabels}];d.loading=!0,s.save(e).then(function(e){d.loading=!1,e&&0===e.code?(o.toast({type:"success",body:"标引成功!"}),d.back()):o.toast({type:"error",body:e.message})}).catch(function(e){d.loading=!1,o.toast({type:"error",body:e.message})})},d.hold=function(){var e={taskOrderId:d.taskOrderId,caledLabels:d.taskOrderLabels};d.loading=!0,s.hold(e).then(function(e){d.loading=!1,e&&0===e.code?(o.toast({type:"success",body:"保存成功!"}),d.back()):o.toast({type:"error",body:e.message})}).catch(function(e){d.loading=!1,o.toast({type:"error",body:e.message})})},d.init()}function o(e,t,n,r){var a=this;a.init=function(){if(a.labels=n.labels,a.reason1=n.reason1,n.lastLabels&&n.lastLabels.length>0)for(var e=0;e<a.labels.length;e++)for(var t=0;t<n.lastLabels.length;t++)if(a.labels[e].id===n.lastLabels[t].id){a.labels[e].id=n.lastLabels[t];break}},a.cancel=function(){e.dismiss("cancel")},a.ok=function(){a.makeReason(),e.close({reason1:a.reason1,reason2:a.reason2,lastLabels:a.selectedLabels})},a.makeReason=function(){a.reason2="",a.selectedLabels=[];for(var e=0;e<a.labels.length;e++){var t=a.labels[e];t.selected&&t.reason&&(a.reason2=a.reason2+"<p>名称:"+t.label.name+",来源:"+r(t.label.source)+",原因:"+t.reason+";</p>",a.selectedLabels.push(t))}},a.init()}function i(t,n,r,a,o,i,s,l,c,u){a.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var d=this;e.merge(d,n),d.init=function(){d.loading=!1,d.processType=l.filter(function(e){return e.key==o.processType})[0],d.taskType=c.filter(function(e){return e.key==o.taskType})[0],d.isPatent=d.processType.key.toLowerCase().indexOf("patent")>=0,d.isEnterprise=d.processType.key.toLowerCase().indexOf("enterprise")>=0,d.taskOrderId=o.taskOrderId,d.reason="",d.maudit()},d.getValue=function(e){return e.strValue||""===e.strValue?e.strValue:e.textValue||""},d.maudit=function(){d.loading=!0;var e=null;if(4===d.taskType.id)e=r.maudit(d.taskOrderId);else{if(10!==d.taskType.id)return;e=r.semiaudit(d.taskOrderId)}e.then(function(e){d.loading=!1,0===e.code?(4===d.taskType.id&&(d.manualAuditOrder=e.result.manualAuditOrder,d.labels=[].concat(d.manualAuditOrder?d.manualAuditOrder.labels:[])),10===d.taskType.id&&(d.semiAutoOrder=e.result.semiAutoOrder,d.labels=[].concat(d.semiAutoOrder?d.semiAutoOrder.labels:[])),d.lastReason=e.result.reason):(t.toast({type:"error",body:"获取待审核信息失败"+e.message}),"您未拥有该工单的处理权限或者该工单已被别人处理"===e.message&&d.back())}).catch(function(e){d.loading=!1,t.errHandler(e)})},d.back=function(){window.history.back()},d.editReason=function(){d.loading||i.openReasonEditer({labels:d.labels,lastLabels:d.lastLabels,reason1:d.reason1}).then(function(e){d.reason1=e.reason1,d.reason2=e.reason2,d.lastLabels=d.lastLabels,d.reason=(d.reason1?"<p>"+d.reason1+"。</p>":"")+(d.reason2?"<p>退单标签详情:</p>"+d.reason2:"")}).catch(function(e){t.errHandler(e)})},d.pass=function(){d.deal(!0)},d.chargeback=function(){if(!d.reason1&&!d.reason2)return void s.openAlert({title:"提示",message:"您未填写退单理由,是否确认要退单?"}).then(function(e){0===e&&d.deal(!1)}).catch(function(e){$log.info(e)});d.deal(!1)},d.deal=function(e){d.submitting=!0,r.deal({taskOrderId:d.taskOrderId,pass:!!e,reason:(d.reason1?"<p>"+d.reason1+"。</p>":"")+(d.reason2?"<p>退单标签详情:</p>"+d.reason2:"")}).then(function(n){d.submitting=!1,0===n.code?(t.toast({type:"success",body:e?"处理成功":"退单成功"}),d.back()):(t.toast({type:"error",body:"处理失败"+n.message}),"您未拥有该工单的处理权限或者该工单已被别人处理"===n.message&&d.back())}).catch(function(e){d.submitting=!1,d.loading=!1,t.errHandler(e)})},d.init()}function s(t,n,r,a,o,i,s){var l=this;e.merge(l,i),l.init=function(){l.loading=!1,l.taskOrderId=r.taskOrderId,l.backUrl=r.backUrl,l.patents=[],l.qry={keywords:r.keywords},l.paginationConf={currentPage:1,itemsPerPage:10},t.$watch(function(){return l.paginationConf.itemsPerPage+" "+l.paginationConf.currentPage},l.getAllPatents)},l.changeAllSelected=function(){l.patents.forEach(function(e){e.selected=l.allSelected})},l.changeSelected=function(){var e=l.patents.filter(function(e){return e.selected}).length;l.allSelected=e==l.patents.length},l.getAllPatents=function(){l.loading=!0,l.qry.pageSize=l.paginationConf.itemsPerPage,l.qry.pageNum=l.paginationConf.currentPage,s.searchPatent(l.qry).then(function(e){l.loading=!1,0===e.code?(l.paginationConf.totalItems=e.result.total,l.patents=[],e.result.list.forEach(function(e){l.patents.push({selected:!1,data:e})}),l.searching=!1):o.toast({type:"error",body:e.message})}).catch(function(e){l.loading=!1,o.errHandler(e)})},l.back=function(){window.location.href=l.backUrl},l.save=function(){var e="";l.patents.forEach(function(t){t.selected&&(""==e?e+=t.data.id:e=e+","+t.data.id)});var t=[{taskOrderId:l.taskOrderId,matchResult:e}];l.loading=!0,s.save(t).then(function(e){l.loading=!1,e&&0===e.code?(o.toast({type:"success",body:"人工筛选成功!"}),l.back()):o.toast({type:"error",body:e.message})}).catch(function(e){l.loading=!1,o.toast({type:"error",body:e.message})})},l.init()}function l(t,n,r,a,o,i){function s(e){if(e){if(e.label){var t=e.label.key;e.value=l.patent[t],e.name=e.name+":"+e.value}e.children&&e.children.length>0&&e.children.forEach(s)}}t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var l=this;l.loading=!1,l.tree={id:0,name:"专利价值评估"},l.labelGroups=[],l.valueKeys=["patentValue","technologicalValue","economicValue","legalValue"],l.getDetail=function(e){l.loading=!0,a.getValueIndexDetail(e).then(function(e){l.loading=!1,0===e.code?(l.patent=e.result,l.patent.valueIndexOrder.taskOrders.forEach(function(e){e.labels.forEach(function(e){var t=e.label.key;l.patent[t]=e.strValue||e.textValue})}),l.getValueLabelsetLabels()):r.toast({type:"error",body:e.message})}).catch(function(e){l.loading=!1,r.errHandler(e)})},l.getValueLabelsetLabels=function(){l.treeCtrl&&l.treeCtrl.showLoading(),o.getLabelsetLabels(3).then(function(t){if(l.treeCtrl&&l.treeCtrl.hideLoading(),0===t.code){l.labelsetLabels=t.result,l.labelGroups.splice(0,l.labelGroups.length);var n=l.labelsetLabels.filter(function(e){return e.parentId>=0});e.forEach(i,function(e){n.push({label:e})});for(var a=n.length%3==0?n.length/3:Math.floor(n.length/3)+1,o=0;o<a;o++)l.labelGroups.push(n.slice(3*o,3*o+3));l.buildValueTree()}else r.toast({type:"error",body:t.message})}).catch(function(e){l.treeCtrl&&l.treeCtrl.hideLoading(),r.errHandler(e)})},l.buildValueTree=function(){var t=l.labelsetLabels.filter(function(e){return 0===e.parentId})[0];e.merge(l.tree,t),s(l.tree),l.refreshTree()},l.refreshTree=function(){l.treeCtrl&&l.treeCtrl.setOption()},l.onChartCtrlAware=function(e){l.treeCtrl=e},l.getDetail(n.id)}function c(e,n,r,a,o,i,s,l,c,u,d,p,f,g,m){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var h=this;h.init=function(){h.loading=!1,h.contextPath=t,h.allSelected=!1,h.autoRefresh=!0,h.processType=p.filter(function(e){return e.key==a.processType})[0],h.taskType=f.filter(function(e){return e.key==a.taskType})[0],h.taskOrderStates=g,h.users=[],h.getAllUsers(),h.period="5",h.periods=[{id:1,name:"1分钟"},{id:2,name:"2分钟"},{id:3,name:"3分钟"},{id:4,name:"4分钟"},{id:5,name:"5分钟"}],m.getLoginUser().then(function(e){h.user=e,h.searchCondition&&1!=h.user.role.id&&(h.searchCondition.userId=h.user.id)}).catch(s.errHandler),h.isPatent=h.processType.key.toLowerCase().indexOf("patent")>=0,h.isEnterprise=h.processType.key.toLowerCase().indexOf("enterprise")>=0,h.showCheckBox="AssignOrder"==h.taskType.key||"AutoIndex"==h.taskType.key||"ManualIndex"==h.taskType.key||"ManualIndexAudit"==h.taskType.key||"SemiAutoIndex"==h.taskType.key||"SemiAutoIndexAudit"==h.taskType.key,h.showResend="AutoIndex"==h.taskType.key||"ManualIndex"==h.taskType.key||"ManualIndexAudit"==h.taskType.key||"SemiAutoIndex"==h.taskType.key||"ManualIndexAudit"==h.taskType.key,h.maxDate=Date.now(),h.reset(),h.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return h.paginationConf.itemsPerPage+" "+h.paginationConf.currentPage},h.search),h.createTimer()},h.reset=function(){h.searchCondition={processType:h.processType.id,taskType:h.taskType.id,actTaskId:a.actTaskId},h.nationalEconomyField=null,h.currentNationalEconomyField=null,h.region=null,h.user&&1!=h.user.role.id&&(h.searchCondition.userId=h.user.id)},h.openNationalDlg=function(){l.openNationalDlg(h.nationalEconomyField).then(function(t){h.nationalEconomyField=t,h.currentNationalEconomyField=e.getNationalEconomy(t)}).catch(function(e){$log.info(e)})},h.openRegionDlg=function(){l.openRegionDlg(h.region).then(function(e){h.region=e}).catch(function(e){$log.info(e)})},h.onAutoRefreshChanged=function(){null!=h.timer&&n.cancel(h.timer),h.createTimer()},h.createTimer=function(){h.timer=n(function(){h.autoRefresh&&h.search()},6e4*h.period)},e.$on("$destroy",function(){null!=h.timer&&n.cancel(h.timer)}),h.onDatetimeRangeChanged=function(e,t,n){"ad"==e?(h.searchCondition.fromAd=t?t.toDate().getTime():t,h.searchCondition.toAd=n?n.toDate().getTime():n):"up"==e&&(h.searchCondition.fromUpdateTime=t?t.toDate().getTime():t,h.searchCondition.toUpdateTime=n?n.toDate().getTime():n)},h.getAllUsers=function(){d.getUsers(1,9999).then(function(e){e&&0===e.code?h.users=h.users.concat(e.result.list):s.toast({type:"error",body:"获取用户失败"})}).catch(s.errHandler)},h.changeAllSelected=function(){h.taskOrders.forEach(function(e){e.selected=h.allSelected&&0==e.data.state})},h.changeSelected=function(){var e=h.taskOrders.filter(function(e){return e.selected}).length;h.allSelected=e==h.taskOrders.filter(function(e){return 0==e.data.state}).length},h.search=function(){if(h.loading=!0,h.searchCondition.pageSize=h.paginationConf.itemsPerPage,h.searchCondition.pageNum=h.paginationConf.currentPage,"enterpriseInfoIndex"==h.processType.key){var t={};t.processType=h.searchCondition.processType,t.taskType=h.searchCondition.taskType,t.actInstanceId=e.nullIfSpaceOrEmpty(h.searchCondition.actInstanceId),t.actTaskId=e.nullIfSpaceOrEmpty(h.searchCondition.actTaskId),t.name=e.nullIfSpaceOrEmpty(h.searchCondition.name),t.nationalEconomyField=null==h.currentNationalEconomyField?null:h.currentNationalEconomyField.code,t.provinceId=null==h.region?null:null==h.region.t1?null:h.region.t1.id,t.cityId=null==h.region?null:null==h.region.t2?null:h.region.t2.id,t.districtId=null==h.region?null:null==h.region.t3?null:h.region.t3.id,t.taskState=h.searchCondition.state,t.userId=h.searchCondition.userId,t.optDateFrom=h.searchCondition.fromUpdateTime,t.optDateTo=h.searchCondition.toUpdateTime,t.pageSize=h.searchCondition.pageSize,t.pageNum=h.searchCondition.pageNum,c.searchEnterpriseInfoTaskOrder(t).then(function(e){h.loading=!1,0===e.code?(h.paginationConf.totalItems=e.result.total,h.taskOrders=[],e.result.list.forEach(function(e){h.taskOrders.push({selected:!1,data:e})}),h.searching=!1):s.toast({type:"error",body:e.message})}).catch(function(e){h.loading=!1,s.errHandler(e)})}else if("enterpriseRequireIndex"==h.processType.key){var t={};t.processType=h.searchCondition.processType,t.taskType=h.searchCondition.taskType,t.actInstanceId=e.nullIfSpaceOrEmpty(h.searchCondition.actInstanceId),t.actTaskId=e.nullIfSpaceOrEmpty(h.searchCondition.actTaskId),t.requirement=e.nullIfSpaceOrEmpty(h.searchCondition.requirement),t.taskState=h.searchCondition.state,t.userId=h.searchCondition.userId,t.optDateFrom=h.searchCondition.fromUpdateTime,t.optDateTo=h.searchCondition.toUpdateTime,null==e.nullIfSpaceOrEmpty(h.searchCondition.name)&&null==h.nationalEconomyField&&null==h.region||(t["enterprise.name"]=e.nullIfSpaceOrEmpty(h.searchCondition.name),t["enterprise.nationalEconomyField"]=null==h.currentNationalEconomyField?null:h.currentNationalEconomyField.code,t["enterprise.provinceId"]=null==h.region?null:null==h.region.t1?null:h.region.t1.id,t["enterprise.cityId"]=null==h.region?null:null==h.region.t2?null:h.region.t2.id,t["enterprise.districtId"]=null==h.region?null:null==h.region.t3?null:h.region.t3.id),t.pageSize=h.searchCondition.pageSize,t.pageNum=h.searchCondition.pageNum,c.searchEnterpriseRequirementTaskOrder(t).then(function(e){h.loading=!1,0===e.code?(h.paginationConf.totalItems=e.result.total,h.taskOrders=[],e.result.list.forEach(function(e){h.taskOrders.push({selected:!1,data:e})}),h.searching=!1):s.toast({type:"error",body:e.message})}).catch(function(e){h.loading=!1,s.errHandler(e)})}else if("enterpriseRequireMatch"==h.processType.key){var t={};t.processType=h.searchCondition.processType,t.taskType=h.searchCondition.taskType,t.actInstanceId=e.nullIfSpaceOrEmpty(h.searchCondition.actInstanceId),t.actTaskId=e.nullIfSpaceOrEmpty(h.searchCondition.actTaskId),t.taskState=h.searchCondition.state,t.userId=h.searchCondition.userId,t.optDateFrom=h.searchCondition.fromUpdateTime,t.optDateTo=h.searchCondition.toUpdateTime,null==e.nullIfSpaceOrEmpty(h.searchCondition.keywords)&&null==e.nullIfSpaceOrEmpty(h.searchCondition.requirement)||(t["enterpriseRequirement.keywords"]=e.nullIfSpaceOrEmpty(h.searchCondition.keywords),t["enterpriseRequirement.requirement"]=e.nullIfSpaceOrEmpty(h.searchCondition.requirement)),null==e.nullIfSpaceOrEmpty(h.searchCondition.name)&&null==e.nullIfSpaceOrEmpty(h.searchCondition.unifiedSocialCreditCode)&&null==h.nationalEconomyField&&null==h.region&&null==e.nullIfSpaceOrEmpty(h.searchCondition.type)||(t["enterpriseRequirement.enterprise.name"]=e.nullIfSpaceOrEmpty(h.searchCondition.name),t["enterpriseRequirement.enterprise.unifiedSocialCreditCode"]=e.nullIfSpaceOrEmpty(h.searchCondition.unifiedSocialCreditCode),t["enterpriseRequirement.enterprise.nationalEconomyField"]=null==h.currentNationalEconomyField?null:h.currentNationalEconomyField.code,t["enterpriseRequirement.enterprise.provinceId"]=null==h.region?null:null==h.region.t1?null:h.region.t1.id,t["enterpriseRequirement.enterprise.cityId"]=null==h.region?null:null==h.region.t2?null:h.region.t2.id,t["enterpriseRequirement.enterprise.districtId"]=null==h.region?null:null==h.region.t3?null:h.region.t3.id,t["enterpriseRequirement.enterprise.type"]=e.nullIfSpaceOrEmpty(h.searchCondition.type)),t.pageSize=h.searchCondition.pageSize,t.pageNum=h.searchCondition.pageNum,c.searchEnterpriseRequirementMatchPatentTaskOrder(t).then(function(e){h.loading=!1,0===e.code?(h.paginationConf.totalItems=e.result.total,h.taskOrders=[],e.result.list.forEach(function(e){h.taskOrders.push({selected:!1,data:e})}),h.searching=!1):s.toast({type:"error",body:e.message})}).catch(function(e){h.loading=!1,s.errHandler(e)})}else{var t={};t.processType=h.searchCondition.processType,t.taskType=h.searchCondition.taskType,t.actInstanceId=e.nullIfSpaceOrEmpty(h.searchCondition.actInstanceId),t.actTaskId=e.nullIfSpaceOrEmpty(h.searchCondition.actTaskId),t.state=h.searchCondition.state,t.an=e.nullIfSpaceOrEmpty(h.searchCondition.an),t.ti=e.nullIfSpaceOrEmpty(h.searchCondition.ti),t.fromAd=h.searchCondition.fromAd,t.toAd=h.searchCondition.toAd,t.pa=e.nullIfSpaceOrEmpty(h.searchCondition.pa),t.pin=e.nullIfSpaceOrEmpty(h.searchCondition.pin),t.lastLegalStatus=e.nullIfSpaceOrEmpty(h.searchCondition.lastLegalStatus),t.userId=h.searchCondition.userId,t.fromUpdateTime=h.searchCondition.fromUpdateTime,t.toUpdateTime=h.searchCondition.toUpdateTime,t.pageSize=h.searchCondition.pageSize,t.pageNum=h.searchCondition.pageNum,c.searchPatentTaskOrder(t).then(function(e){h.loading=!1,0===e.code?(h.paginationConf.totalItems=e.result.total,h.taskOrders=[],e.result.list.forEach(function(e){h.taskOrders.push({selected:!1,data:e})}),h.searching=!1):s.toast({type:"error",body:e.message})}).catch(function(e){h.loading=!1,s.errHandler(e)})}},h.doTask=function(e){var t=[];if(null==e){if(h.taskOrders.forEach(function(e){e.selected&&t.push(e.data)}),0==t.length)return void s.toast({type:"warn",body:"请至少选择一个工单！"})}else t.push(e);switch(h.taskType.key){case"AssignOrder":u.openAssignOrderEditer({processType:h.processType,taskType:h.taskType,taskOrders:t}).then(function(e){s.toast({type:"success",body:"派单成功！"}),h.search()}).catch(function(e){s.errHandler(e)});break;case"AutoIndex":case"SemiAutoIndex":case"ManualIndex":case"ValueIndex":case"PriceIndex":r.go("main.console.patent.process.index",{processType:h.processType.key,taskType:h.taskType.key,taskOrderId:e.id,backUrl:i.absUrl()});break;case"ManualIndexAudit":case"SemiAutoIndexAudit":r.go("main.console.patent.process.audit",{processType:h.processType.key,taskType:h.taskType.key,taskOrderId:e.id,backUrl:i.absUrl()});break;case"ArtificialSelection":r.go("main.console.match.patent.detail",{taskOrderId:e.id,keywords:e.match.enterpriseRequirement.keywords,backUrl:i.absUrl()})}},h.doRedeploy=function(e){var t=[];t.push(e),u.openRedeployOrderEditer({processType:h.processType,taskType:h.taskType,taskOrders:t}).then(function(e){s.toast({type:"success",body:"转派成功！"}),h.search()}).catch(function(e){s.errHandler(e)})},h.init()}e.module("Instance").controller("TaskOrderController",["$scope","$interval","$state","$stateParams","$filter","$location","ToastService","ModalService","TaskOrderService","TaskOrderAction","UserService","PATENT_PROCESS_TYPE","PATENT_TASK_TYPE","TASK_ORDER_STATE","AuthService",c]).controller("AssignOrderController",["$uibModalInstance","ToastService","FormService","TaskOrderService","modalParams",n]).controller("RedeployOrderController",["$uibModalInstance","ToastService","FormService","TaskOrderService","modalParams",r]).controller("IndexOrderController",["$scope","$state","$stateParams","$filter","ToastService","FormService","TaskOrderService","PATENT_PROCESS_TYPE","PATENT_TASK_TYPE","PATENT_LABEL_SOURCE",a]).controller("AuditOrderController",["ToastService","FormService","TaskOrderService","$scope","$stateParams","TaskOrderAction","ModalService","PATENT_PROCESS_TYPE","PATENT_TASK_TYPE","TASK_ORDER_STATE",i]).controller("ChargebackReasonEditerController",["$uibModalInstance","ToastService","params","changeLabelSourceFilter",o]).controller("ErPMatchDetailController",["$scope","$state","$stateParams","$filter","ToastService","FormService","TaskOrderService",s]).controller("ValueIndexDetailController",["$scope","$stateParams","ToastService","TaskOrderService","LabelsetService","EXTRA_VALUE_LABELS",l])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,n){this.searchPatentTaskOrder=function(n){return e.get(t+"/api/instance/process/order/searchPatentTaskOrder",n)},this.searchEnterpriseInfoTaskOrder=function(n){return e.get(t+"/api/instance/process/order/searchEnterpriseInfoTaskOrder",n)},this.searchEnterpriseRequirementTaskOrder=function(n){return e.get(t+"/api/instance/process/order/searchEnterpriseRequirementTaskOrder",n)},this.searchEnterpriseRequirementMatchPatentTaskOrder=function(n){return e.get(t+"/api/instance/process/order/searchEnterpriseRequirementMatchPatentTaskOrder",n)},this.save=function(n){return e.post(t+"/api/instance/process/order/save",n)},this.hold=function(n){return e.post(t+"/api/instance/process/order/hold/",n)},this.deal=function(n){return e.post(t+"/api/instance/process/order/deal/",n)},this.getUsers=function(n){return e.get(t+"/api/instance/process/order/users/"+n,{})},this.getAutoIndexLabels=function(n){return e.get(t+"/api/instance/process/order/labels/auto/"+n,{})},this.getManualIndexLabels=function(n){return e.get(t+"/api/instance/process/order/labels/manual/"+n,{})},this.getSemiAutoIndexLabels=function(n){return e.get(t+"/api/instance/process/order/labels/semi/"+n,{})},this.getValueIndexLabels=function(n){return e.get(t+"/api/instance/process/order/labels/value/"+n,{})},this.getValueIndexDetail=function(n){return e.get(t+"/api/instance/process/order/detail/"+n,{_random:Math.random()})},this.getPriceIndexLabels=function(n){return e.get(t+"/api/instance/process/order/labels/price/"+n,{})},this.maudit=function(n){return e.get(t+"/api/instance/process/order/labels/maudit/"+n,{})},this.semiaudit=function(n){return e.get(t+"/api/instance/process/order/labels/semiaudit/"+n,{})},this.maudit=function(n){return e.get(t+"/api/instance/process/order/labels/maudit/"+n,{})},this.searchPatent=function(n){return e.get(t+"/api/elsearch/patent",n)},this.getRedeployCandidateUser=function(n){return e.get(t+"/api/instance/process/order/redeploy/users/"+n,{})},this.redeploy=function(n){return e.post(t+"/api/instance/process/order/redeploy",n)}}function r(e,n){this.openAssignOrderEditer=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/instance/assignOrder.html",controller:"AssignOrderController",controllerAs:"assignOrderCtrl",size:"lg",resolve:{modalParams:e}}).result},this.openRedeployOrderEditer=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/instance/redeployOrder.html",controller:"RedeployOrderController",controllerAs:"roc",size:"lg",resolve:{modalParams:e}}).result},this.openReasonEditer=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/instance/chargebackReasonEditer.html",controller:"ChargebackReasonEditerController",controllerAs:"chargebackReasonEditerCtrl",size:"lg",resolve:{params:e}}).result}}e.module("Instance").service("TaskOrderService",["HttpService",n]).service("TaskOrderAction",["TaskOrderService","$uibModal",r])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Message",["SERVICES","ui.bootstrap","ngSanitize"])}(angular),function(e){"use strict";function t(e,t,n,r,a,o,i,s){var l=this;e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),l.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return l.paginationConf.itemsPerPage+" "+l.paginationConf.currentPage},l.getAllMessage),l.getAllMessage=function(){l.loading=!0,s.getMessages(l.paginationConf.currentPage,l.paginationConf.itemsPerPage).then(function(e){if(l.loading=!1,0===e.code){l.paginationConf.totalItems=e.result.total,l.messages=e.result.list,l.unreadNum=0;for(var t=0;t<l.messages.length;t++){l.messages[t]}}else o.toast({type:"error",body:"获取消息列表出错："+e.message})}).catch(function(e){l.loading=!1,o.errHandler(e)})},l.dealMessage=function(e){e.url&&t.go(e.url)},l.getAllMessage()}e.module("Message").controller("MessageController",["$scope","$state","$window","$log","AuthService","ToastService","ModalService","MessageService",t])}(angular),function(e){"use strict";e.module("ProcessOrder",["SERVICES","COMPONENTS"])}(angular),function(e,t){"use strict";function n(n,r,a,o,i,s,l,c,u){function d(e,t){var n=new Image;n.src=e,n.complete?t(n.width,n.height):n.onload=function(){t(n.width,n.height)}}n.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var p=this;p.loading=!1,p.processImageUrl=function(e){var n=u.filter(function(t){return t.id==e})[0];return n?t+n.url:""},p.getOrderDetail=function(e){p.loading=!0,i.processOrderDetail(e).then(function(e){p.loading=!1,0===e.code?(p.processOrder=e.result,p.getCurrentProcessLocation()):o.toast({type:"error",body:"获取流程详情出错："+e.message})}).catch(function(e){p.loading=!1,o.errHandler(e)})},p.viewTaskOrder=function(e){s.viewTaskOrderDetail(e).catch(function(e){})},p.viewProcessOrder=function(){s.viewProcessOrderDetail(p.processOrder).catch(function(e){})},p.getCurrentProcessLocation=function(){var t=c.filter(function(e){return e.id===p.processOrder.processType})[0],n=p.processOrder.taskOrders[p.processOrder.taskOrders.length-1];l.getCurrentProcessLocation(t.key,n.actTaskId).then(function(t){if(0===t.code){if(p.currentProcessLocation=t.result,p.currentProcessLocation&&void 0!==p.currentProcessLocation.width){var n=e.element("#process_current_indicator"),r=e.element(".img-responsive"),a=r.attr("src");$(window).on("resize",function(){d(a,function(e,t){var a=r.width()/e;n.css("border","2px solid red"),n.css("width",p.currentProcessLocation.width*a+"px"),n.css("height",p.currentProcessLocation.height*a+"px"),n.css("left",p.currentProcessLocation.x*a+10+"px"),n.css("top",p.currentProcessLocation.y*a+10+"px")})}),$(window).trigger("resize")}}else o.toast({type:"error",body:"获取流程进度信息出错："+t.message})}).catch(function(e){o.errHandler(e)})},p.getOrderDetail(a.orderId)}function r(e,t,n,r,a,o,i,s){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var l=this;l.init=function(){l.loading=!1,l.instanceType=n.instanceType,l.instanceId=n.instanceId,l.processOrders=[],l.getAllProcesses()},l.processes=[],l.getAllProcesses=function(){l.loading=!0,a.getAllProcesses(l.instanceType).then(function(e){l.loading=!1,e&&0===e.code?(l.processes=l.processes.concat(e.result),l.getAllProcessOrders()):r.toast({type:"error",body:"获取流程模版失败"})}).catch(function(e){l.loading=!1,r.errHandler(e)})},l.getAllProcessOrders=function(){l.loading=!0;var e={instanceType:l.instanceType,instanceId:l.instanceId,processId:null};a.getAllProcessOrders(e).then(function(e){l.loading=!1,0===e.code?(l.processOrders=[],l.processOrders=l.processOrders.concat(e.result),l.views=l.processOrders,l.tabs=[],null!=l.processes&&l.processes.forEach(function(e){var t={data:e,num:null==l.processOrders?0:l.processOrders.filter(function(t){return e.id==t.processCnfId}).length};l.tabs.push(t)})):r.toast({type:"error",body:"获取流程详情出错："+e.message})}).catch(function(e){l.loading=!1,r.errHandler(e)})},l.onTabSelected=function(e){if(100==e)return void(l.views=l.processOrders);l.views=[],null!=l.processOrders&&l.processOrders.forEach(function(t){t.processCnfId==l.tabs[e].data.id&&l.views.push(t)})},l.viewTaskOrder=function(e){o.viewTaskOrderDetail(e).catch(function(e){})},l.init()}function a(e,t,n,r,a){e.loading=!1,e.taskOrder=a,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")},e.getTaskOrderLabels=function(){e.loading=!0,r.taskOrderLabels(e.taskOrder.id).then(function(t){e.loading=!1,0===t.code?e.labels=t.result:n.toast({type:"error",body:"获取工单详情出错："+t.message})}).catch(function(t){e.loading=!1,n.errHandler(t)})},e.getTaskOrderLabels()}function o(e,t,n,r,a){e.loading=!1,e.processOrder=a,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")},e.getTaskOrderLabels=function(){e.loading=!0,r.processOrderLabels(e.processOrder.id).then(function(t){e.loading=!1,0===t.code?e.labels=t.result:n.toast({type:"error",body:"获取定单详情出错："+t.message})}).catch(function(t){e.loading=!1,n.errHandler(t)})},e.getTaskOrderLabels()}function i(e,t,n,r,a,o,i,s,l,c){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var u=this;u.init=function(){u.loading=!1,u.instanceType=l.filter(function(e){return e.key==n.instanceType})[0],u.processOrderStates=c,u.processOrders=[],u.maxDate=Date.now(),u.reset(),u.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return u.paginationConf.itemsPerPage+" "+u.paginationConf.currentPage},u.search),u.getAllProcesses()},u.reset=function(){u.searchCondition={},u.nationalEconomyField=null,u.currentNationalEconomyField=null},u.processes=[],u.getAllProcesses=function(){o.getAllProcesses(u.instanceType.id).then(function(e){e&&0===e.code?u.processes=u.processes.concat(e.result):a.toast({
type:"error",body:"获取流程模版失败"})}).catch(a.errHandler)},u.onDatetimeRangeChanged=function(e,t,n){"up"==e&&(u.searchCondition.fromUpdateTime=t?t.toDate().getTime():t,u.searchCondition.toUpdateTime=n?n.toDate().getTime():n)},u.openNationalDlg=function(){r.openNationalDlg(u.nationalEconomyField).then(function(t){u.nationalEconomyField=t,u.currentNationalEconomyField=e.getNationalEconomy(t)}).catch(function(e){$log.info(e)})},u.search=function(){u.loading=!0,u.searchCondition.pageSize=u.paginationConf.itemsPerPage,u.searchCondition.pageNum=u.paginationConf.currentPage,"Patent"==u.instanceType.key?(u.searchCondition.instanceType=u.instanceType.id,u.searchCondition.actInstanceId=e.nullIfSpaceOrEmpty(u.searchCondition.actInstanceId),u.searchCondition.actTaskId=e.nullIfSpaceOrEmpty(u.searchCondition.actTaskId),u.searchCondition.state=u.searchCondition.state,u.searchCondition.an=e.nullIfSpaceOrEmpty(u.searchCondition.an),u.searchCondition.ti=e.nullIfSpaceOrEmpty(u.searchCondition.ti),u.searchCondition.pa=e.nullIfSpaceOrEmpty(u.searchCondition.pa),u.searchCondition.pin=e.nullIfSpaceOrEmpty(u.searchCondition.pin),u.searchCondition.lastLegalStatus=e.nullIfSpaceOrEmpty(u.searchCondition.lastLegalStatus),u.searchCondition.fromUpdateTime=u.searchCondition.fromUpdateTime,u.searchCondition.toUpdateTime=u.searchCondition.toUpdateTime,o.searchPatent(u.searchCondition).then(function(e){u.loading=!1,0===e.code?(u.paginationConf.totalItems=e.result.total,u.processOrders=[],u.processOrders=u.processOrders.concat(e.result.list),u.searching=!1):a.toast({type:"error",body:e.message})}).catch(function(e){u.loading=!1,a.errHandler(e)})):"EnterpriseRequire"==u.instanceType.key&&(u.searchCondition.instanceType=u.instanceType.id,u.searchCondition.actInstanceId=e.nullIfSpaceOrEmpty(u.searchCondition.actInstanceId),u.searchCondition.actTaskId=e.nullIfSpaceOrEmpty(u.searchCondition.actTaskId),u.searchCondition.state=u.searchCondition.state,u.searchCondition.name=e.nullIfSpaceOrEmpty(u.searchCondition.name),u.searchCondition.requirement=e.nullIfSpaceOrEmpty(u.searchCondition.requirement),u.searchCondition.fromUpdateTime=u.searchCondition.fromUpdateTime,u.searchCondition.toUpdateTime=u.searchCondition.toUpdateTime,u.searchCondition.nationalEconomyField=null==u.currentNationalEconomyField?null:u.currentNationalEconomyField.code,o.searchRequirement(u.searchCondition).then(function(e){u.loading=!1,0===e.code?(u.paginationConf.totalItems=e.result.total,u.processOrders=[],u.processOrders=u.processOrders.concat(e.result.list),u.searching=!1):a.toast({type:"error",body:e.message})}).catch(function(e){u.loading=!1,a.errHandler(e)}))},u.init()}e.module("ProcessOrder").controller("ProcessDetailController",["$scope","$state","$stateParams","ToastService","ProcessOrderService","ProcessOrderAction","ActService","PATENT_PROCESS_TYPE","PATENT_PROCESS_IMAGES",n]).controller("TaskOrderDetailController",["$scope","$uibModalInstance","ToastService","ProcessOrderService","taskOrder",a]).controller("ProcessOrderDetailController",["$scope","$uibModalInstance","ToastService","ProcessOrderService","processOrder",o]).controller("ProcessOrderQueryController",["$scope","$state","$stateParams","ModalService","ToastService","ProcessOrderService","ProcessOrderAction","ActService","INSTANCE_TYPE","PROCESS_ORDER_STATE",i]).controller("ProcessDetailsController",["$scope","$state","$stateParams","ToastService","ProcessOrderService","ProcessOrderAction","ActService","PATENT_PROCESS_TYPE",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.getCurrentProcessLocation=function(n,r){return e.get(t+"/api/act/image/"+n+"/"+r)}}function r(e){this.processOrderDetail=function(n){return e.get(t+"/api/process/order/"+n,{_random:Math.random()})},this.searchPatent=function(n){return e.get(t+"/api/process/order/searchPatent",n)},this.searchRequirement=function(n){return e.get(t+"/api/process/order/searchRequirement",n)},this.getAllProcessOrders=function(n){return e.get(t+"/api/process/order/all",n)},this.taskOrderLabels=function(n){return e.get(t+"/api/process/order/task/"+n+"/labels",{_random:Math.random()})},this.getAllProcesses=function(n){return e.get(t+"/api/process/all/"+n,{_random:Math.random()})},this.processOrderLabels=function(n){return e.get(t+"/api/process/labels/"+n,{_random:Math.random()})}}function a(e){this.viewTaskOrderDetail=function(n){return e.open({animation:!0,templateUrl:t+"/static/tpls/processorder/taskOrderDetail.html",controller:"TaskOrderDetailController",size:"lg",resolve:{taskOrder:n}}).result},this.viewProcessOrderDetail=function(n){return e.open({animation:!0,templateUrl:t+"/static/tpls/processorder/processOrderDetail.html",controller:"ProcessOrderDetailController",size:"lg",resolve:{processOrder:n}}).result}}e.module("ProcessOrder").service("ActService",["HttpService",n]).service("ProcessOrderService",["HttpService",r]).service("ProcessOrderAction",["$uibModal",a])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("Statistics",["SERVICES"])}(angular),function(e){"use strict";function t(e,t,n,r){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var a=this;a.currentStateStyle=function(e){return{active:e===a.selectedState}}}function n(e,t,n,r){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var a=this;a.init=function(){a.reset(),a.title="专利流程定单完成数",a.yName="数量(个)",a.searchTime=0,a.xs=[],a.numList=[],a.search()},a.reset=function(){a.searchCondtion={}},a.search=function(){a.loading=!0,r.getPatentIndexOrderNum(a.searchCondtion).then(function(e){if(a.loading=!1,e&&0===e.code){a.xs=[],a.numList=[];for(var t=0;t<e.result.length;t++)a.xs.push(e.result[t].name),a.numList.push(e.result[t].orderNum);a.searchTime=a.searchTime+1}else ToastService.toast({type:"error",body:"查询统计信息失败："+e.message})}).catch(function(e){a.loading=!1,ToastService.toast({type:"error",body:e.message})})},a.onDatetimeRangeChanged=function(e,t){a.searchCondtion.startTime=e?e.toDate().getTime():e,a.searchCondtion.endTime=t?t.toDate().getTime():t},a.init()}function r(e,t,n,r){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var a=this;a.init=function(){a.reset(),a.title="各流程定单完成数",a.yName="数量(个)",a.searchTime=0,a.xs=[],a.numList=[],a.search()},a.reset=function(){a.searchCondtion={}},a.search=function(){a.loading=!0,r.getProcessOrderNum(a.searchCondtion).then(function(e){if(a.loading=!1,e&&0===e.code){a.xs=[],a.numList=[];for(var t=0;t<e.result.length;t++)a.xs.push(e.result[t].name),a.numList.push(e.result[t].orderNum);a.searchTime=a.searchTime+1}else ToastService.toast({type:"error",body:"查询统计信息失败："+e.message})}).catch(function(e){a.loading=!1,ToastService.toast({type:"error",body:e.message})})},a.onDatetimeRangeChanged=function(e,t){a.searchCondtion.startTime=e?e.toDate().getTime():e,a.searchCondtion.endTime=t?t.toDate().getTime():t},a.init()}function a(e,t,n,r){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var a=this;a.init=function(){a.reset(),a.title="专利价值分布和平均分",a.yName="数量(个)",a.searchTime=0,a.xs=[],a.numList=[],a.search()},a.reset=function(){a.searchCondtion={}},a.search=function(){a.loading=!0,a.searchCondtion.patentType||(a.searchCondtion.patentType=null),r.getPatentValue(a.searchCondtion).then(function(e){if(a.loading=!1,e&&0===e.code){a.xs=[],a.numList=[];for(var t=0;t<e.result.ranges.length;t++)a.xs.push(e.result.ranges[t].name),a.numList.push(e.result.ranges[t].value);a.title="专利价值分布(平均分:"+Math.round(1e4*(isNaN(e.result.avg)?0:e.result.avg))/100+"分)",a.searchTime=a.searchTime+1}else ToastService.toast({type:"error",body:"查询统计信息失败："+e.message})}).catch(function(e){a.loading=!1,ToastService.toast({type:"error",body:e.message})})},a.onDatetimeRangeChanged=function(e,t,n){"A"==e&&(a.searchCondtion.fromADate=t?t.toDate().getTime():t,a.searchCondtion.toADate=n?n.toDate().getTime():n),"O"==e&&(a.searchCondtion.fromODate=t?t.toDate().getTime():t,a.searchCondtion.toODate=n?n.toDate().getTime():n)},a.init()}e.module("Statistics").controller("WorkloadCtrl",["$scope","$state","ToastService","StatisticsService",t]).controller("patentIndexOrderController",["$scope","$state","ToastService","StatisticsService",n]).controller("indexOrderController",["$scope","$state","ToastService","StatisticsService",r]).controller("patentPatentValueController",["$scope","$state","ToastService","StatisticsService",a])}(angular),function(e,t){"use strict";function n(e){this.getPatentIndexOrderNum=function(n){return e.get(t+"/api/statistics/patentIndexOrderNum/",n)},this.getProcessOrderNum=function(n){return e.get(t+"/api/statistics/processOrderNum/",n)},this.getPatentValue=function(n){return e.get(t+"/api/statistics/patent/value",n)}}e.module("Statistics").service("StatisticsService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";e.module("System",["SERVICES","COMPONENTS"])}(angular),function(e){"use strict";function t(e,t,n){var r=this;n.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),r.getAllRole=function(){r.loading=!0,e.getRoles().then(function(e){r.loading=!1,e&&0===e.code?r.list=e.result:t.toast({type:"error",body:"查询角色失败："+e.message})}).catch(function(e){r.loading=!1,t.toast({type:"error",body:e.message})})},r.getAllRole()}function n(e,t,n,r,a,o){var i=this;t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),i.searching=!1,i.findUser=function(){i.searchCondition.pageSize=i.paginationConf.itemsPerPage,i.searchCondition.pageNum=i.paginationConf.currentPage,i.loading=!0,r.findUser(i.searchCondition).then(function(e){e&&0===e.code?(i.paginationConf.totalItems=e.result.total,i.loading=!1,i.list=e.result.list,i.searching=!1):a.toast({type:"error",body:"搜索用户失败"})}).catch(function(e){a.toast({type:"error",body:e.message})})},i.getAllRole=function(){o.getRoles().then(function(e){e&&0===e.code?i.roles=e.result:a.toast({type:"error",body:"查询角色失败："+e.message})})},i.remove=function(t){n.openAlert({title:"提示",message:"您是否要禁用该用户?"}).then(function(e){0===e&&r.deleteUser(t).then(function(e){e&&0===e.code&&(i.findUser(),a.toast({type:"success",body:"已成功禁用用户"}))}).catch(function(e){a.toast({type:"error",body:e.message})})}).catch(function(t){e.info(t)})},i.recover=function(e){r.recoverUser(e).then(function(e){e&&0===e.code&&(i.findUser(),a.toast({type:"success",body:"已成功启用用户"}))}).catch(function(e){a.toast({type:"error",body:e.message})})},i.init=function(){i.paginationConf={currentPage:1,itemsPerPage:10},i.searchCondition={accountNonExpired:!0},t.$watch(function(){return i.paginationConf.itemsPerPage+" "+i.paginationConf.currentPage},i.findUser),i.getAllRole()},i.reset=function(){i.searchCondition={accountNonExpired:!0}},i.init()}function r(e,t,n,r){var a=this;r.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),a.nodes={id:"0",text:"PMES",icon:"fa fa-home",state:{opened:!0}},a.isButtonList=[{key:"否",value:!1},{key:"是",value:!0}],a.onTreeReady=function(e,t){a.treeCtrl||(a.treeCtrl=t,a.getAuthorities())},a.authChildren=function(e){if(e.sonAuthorities)return e.sonAuthorities.map(function(e){return{id:e.id,name:e.name,text:e.title,icon:e.pic||"fa  fa-circle-o",state:{opened:!0},children:a.authChildren(e)}})},a.onNodeSelected=function(n){a.loading=!0,e.getAuthorityById(n).then(function(e){a.loading=!1,e&&0===e.code?a.selectedAuthority=e.result:t.toast({type:"error",body:"请求权限失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.getAuthorities=function(){a.loading=!0,e.getAuthorities().then(function(e){a.loading=!1,e&&0===e.code?(a.auths=e.result,a.nodes.children=e.result.map(function(e){return{id:e.id,name:e.name,text:e.title,state:{opened:!0},icon:e.pic||"fa fa-files-o",children:a.authChildren(e)}}),a.treeCtrl&&a.treeCtrl.refresh()):t.toast({type:"error",body:"请求权限失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.addAuthority=function(){a.selectedAuthority||(a.selectedAuthority={}),a.selectedAuthority&&a.selectedAuthority.id&&(a.selectedAuthority.parentId=a.selectedAuthority.id,a.selectedAuthority.id=0,delete a.selectedAuthority.id,delete a.selectedAuthority.name,delete a.selectedAuthority.title,delete a.selectedAuthority.url,delete a.selectedAuthority.pic,delete a.selectedAuthority.sortOrder,a.selectedAuthority.isMenu=!1)},a.deleteAuthority=function(n){e.deleteAuthorityById(n).then(function(e){a.loading=!1,e&&0===e.code?(t.toast({type:"success",body:"删除权限成功！"}),a.selectedAuthority=null,a.getAuthorities()):t.toast({type:"error",body:"删除权限失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.submitAuth=function(){var n=null;a.loading=!0,n=a.selectedAuthority.id>0?e.updateAuthority(a.selectedAuthority):e.addAuthority(a.selectedAuthority),n.then(function(e){a.loading=!1,e&&0===e.code?(t.toast({type:"success",body:a.selectedAuthority.id>0?"修改权限成功！":"添加权限成功！"}),0===a.selectedAuthority.id&&(a.selectedAuthority=null),a.getAuthorities()):t.toast({type:"error",body:(a.selectedAuthority.id>0?"修改权限失败：":"添加权限失败：")+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.deleteAuth=function(){n.openAlert({title:"提示",message:"您是否要删除该权限?"}).then(function(e){0===e&&a.deleteAuthority(a.selectedAuthority.id)},function(){})}}function a(e,t,n,r){var a=this;r.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),a.loading=!1,a.nodes={id:"0",text:"PMES",icon:"fa fa-home",state:{opened:!0}},a.onTreeReady=function(e,t){a.treeCtrl||(a.treeCtrl=t,a.getOrganizations())},a.organizationChildren=function(e){if(e.sonOrganizations)return e.sonOrganizations.map(function(e){return{id:e.id,name:e.remark,text:e.name,icon:e.pic||"fa fa-circle-o",state:{opened:!0},children:a.organizationChildren(e)}})},a.onNodeSelected=function(n){a.loading=!0,e.getOrganizationById(n).then(function(e){a.loading=!1,e&&0===e.code?a.selectedOrganization=e.result:t.toast({type:"error",body:"请求组织机构失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.getOrganizations=function(){a.loading=!0,e.getOrganizations().then(function(e){a.loading=!1,e&&0===e.code?(a.organizations=e.result,a.nodes.children=e.result.map(function(e){return{id:e.id,name:e.remark,text:e.name,state:{opened:!0},icon:e.pic||"fa fa-files-o",children:a.organizationChildren(e)}}),a.treeCtrl&&a.treeCtrl.refresh()):t.toast({type:"error",body:"请求组织机构失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.addOrganization=function(){a.selectedOrganization||(a.selectedOrganization={}),a.selectedOrganization&&a.selectedOrganization.id&&(a.selectedOrganization.parentId=a.selectedOrganization.id,a.selectedOrganization.id=0,delete a.selectedOrganization.id,delete a.selectedOrganization.name,delete a.selectedOrganization.remark)},a.deleteOrganization=function(n){a.loading=!0,e.deleteOrganizationById(n).then(function(e){a.loading=!1,e&&0===e.code?(t.toast({type:"success",body:"删除组织机构成功！"}),a.selectedOrganization=null,a.getOrganizations()):t.toast({type:"error",body:"删除组织机构失败："+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.submitOrganization=function(){var n=null;n=a.selectedOrganization.id>0?e.updateOrganization(a.selectedOrganization):e.addOrganization(a.selectedOrganization),n.then(function(e){a.loading=!1,e&&0===e.code?(t.toast({type:"success",body:a.selectedOrganization.id>0?"修改组织机构成功！":"添加组织机构成功！"}),0===a.selectedOrganization.id&&(a.selectedOrganization=null),a.getOrganizations()):t.toast({type:"error",body:(a.selectedOrganization.id>0?"修改组织机构失败：":"添加组织机构失败：")+e.message})}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.deleteOrgan=function(){n.openAlert({title:"提示",message:"您是否要删除该组织机构?"}).then(function(e){0===e&&a.deleteOrganization(a.selectedOrganization.id)},function(){})}}e.module("System").controller("RoleCtrl",["RoleService","ToastService","$scope",t]).controller("UserCtrl",["$log","$scope","ModalService","UserService","ToastService","RoleService",n]).controller("AuthorityCtrl",["AuthorityService","ToastService","ModalService","$scope",r]).controller("OrganizationCtrl",["OrganizationService","ToastService","ModalService","$scope",a])}(angular),function(e,t){"use strict";function n(e){this.getUsers=function(n,r){return e.get(t+"/api/user/all/",{pageNum:n,pageSize:r})},this.addUser=function(n){return e.post(t+"/api/user/add/",n)},this.updateUser=function(n){return e.post(t+"/api/user/update/",n)},this.deleteUser=function(n){return e.get(t+"/api/user/delete/"+n,{})},this.recoverUser=function(n){return e.get(t+"/api/user/recover/"+n,{})},this.findUser=function(n){return e.get(t+"/api/user/search/",n)},this.findUserById=function(n){return e.get(t+"/api/user/info/"+n,{})},this.modifyPassword=function(n){return e.post(t+"/api/user/modifyPassword/",n)},this.modifyProfile=function(n){return e.post(t+"/api/user/profile/update/",n)}}function r(e){this.getRoles=function(){return e.get(t+"/api/role/all/",{_random:Math.random()})},this.getRoleById=function(n){return e.get(t+"/api/role/"+n,{_random:Math.random()})},this.updateRoleAuth=function(n){return e.post(t+"/api/role/bindAuthorities/",n)},this.updateRole=function(n){return e.post(t+"/api/user/updateUserRole",n)}}function a(e,n){this.getAuthorities=function(){return n.get(t+"/api/auth/all/",{_random:Math.random()})},this.getAuthoritiesByRoleId=function(e){return n.get(t+"/api/auth/findByRole/"+e,{_random:Math.random()})},this.getAuthorityTreeDataByRoleId=function(r){var a=e.defer();return n.get(t+"/api/auth/all/",{_random:Math.random()}).then(function(e){if(e&&0===e.code){var o=e.result;n.get(t+"/api/auth/findByRole/"+r,{_random:Math.random()}).then(function(e){if(e&&0===e.code){var t=e.result;a.resolve({authorities:o,roleAuthorities:t})}else{var n=new Error(e.message);n.code=e.code,a.reject(n)}})}else{var i=new Error(e.message);i.code=e.code,a.reject(i)}}).catch(a.reject),a.promise},this.getAuthorityById=function(e){return n.get(t+"/api/auth/"+e,{_random:Math.random()})},this.addAuthority=function(e){return n.post(t+"/api/auth/add/",e)},this.updateAuthority=function(e){return n.post(t+"/api/auth/update/",e)},this.deleteAuthorityById=function(e){return n.get(t+"/api/auth/delete/"+e,{_random:Math.random()})}}function o(e){this.getOrganizations=function(){return e.get(t+"/api/organization/all/",{_random:Math.random()})},this.getOrganizationById=function(n){return e.get(t+"/api/organization/"+n,{_random:Math.random()})},this.addOrganization=function(n){return e.post(t+"/api/organization/add/",n)},this.updateOrganization=function(n){return e.post(t+"/api/organization/update/",n)},this.deleteOrganizationById=function(n){return e.get(t+"/api/organization/delete/"+n,{_random:Math.random()})}}e.module("System").service("UserService",["HttpService",n]).service("RoleService",["HttpService",r]).service("OrganizationService",["HttpService",o]).service("AuthorityService",["$q","HttpService",a])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,n,r,a,o,i,s,l,c,u,d,p,f,g){var m=this;i.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),m.contextPath=t,m.init=function(){m.labelType=s,m.valueType=l,m.patentIndexType=c,m.patentLabelSource=u,m.enterpriseInfomationIndexType=d,m.enterpriseInfomationLabelSource=p,m.enterpriseRequirementIndexType=f,m.enterpriseRequirementLabelSource=g,m.paginationConf={currentPage:1,itemsPerPage:10},m.searchCondition={type:1,fromTime:moment().add(-180,"d").startOf("day").toDate().getTime(),toTime:moment().endOf("day").toDate().getTime()},$("#dateTimeRange").daterangepicker({startDate:moment(m.searchCondition.fromTime),endDate:moment(m.searchCondition.toTime),maxDate:moment(),showDropdowns:!1,showWeekNumbers:!1,timePickerIncrement:1,singleDatePicker:!1,locale:{separator:"~",applyLabel:"确认",cancelLabel:"取消",format:"YYYY-MM-DD",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},opens:"right",buttonClasses:["btn btn-default"],applyClass:"btn-small btn-primary",cancelClass:"btn-small btn-default",format:"YYYY-MM-DD"},function(e,t,n){i.$apply(function(){m.searchCondition.fromTime=e.toDate().getTime(),m.searchCondition.toTime=t.toDate().getTime()})}).next().on("click",function(){$(this).prev().focus()}),i.$watch(function(){return m.paginationConf.itemsPerPage+" "+m.paginationConf.currentPage},m.search),i.$watch(function(){return m.searchCondition.type},function(e,t){switch(m.indexTypes=[],m.labelSources=[],delete m.searchCondition.indexType,delete m.searchCondition.source,e){case 1:m.indexTypes=m.patentIndexType,m.labelSources=m.patentLabelSource;break;case 2:m.indexTypes=m.enterpriseInfomationIndexType,m.labelSources=m.enterpriseInfomationLabelSource;break;case 3:m.indexTypes=m.enterpriseRequirementIndexType,m.labelSources=m.enterpriseRequirementLabelSource}})},m.changeState=function(t,n){r.changeState({id:t,state:n}).then(function(t){t&&0===t.code?(m.search(),e.toast({type:"success",body:"修改标签状态成功"})):e.toast({type:"error",body:"修改标签状态失败:"+t.message})}).catch(function(e){o.info(e)})},m.reset=function(){m.searchCondition={type:1,fromTime:moment().add(-180,"d").startOf("day").toDate().getTime(),toTime:moment().endOf("day").toDate().getTime()}},m.openLabelEditer=function(e){n.openLabelEditer(e).then(function(e){0==e&&m.search()}).catch(function(e){o.info(e)})},m.add=function(){m.openLabelEditer({model:"add"})},m.update=function(e){m.openLabelEditer({model:"update",label:e})},m.view=function(e){n.openLabelViewer({label:e}).then(function(e){}).catch(function(e){o.info(e)})},m.search=function(){m.loading=!0,m.searchCondition.pageSize=m.paginationConf.itemsPerPage,m.searchCondition.pageNum=m.paginationConf.currentPage,r.search(m.searchCondition).then(function(t){m.loading=!1,t&&0===t.code?(m.paginationConf.totalItems=t.result.total,m.list=t.result.list,m.searching=!1):e.toast({type:"error",body:"获取标签失败"})}).catch(function(t){m.loading=!1,e.toast({type:"error",body:t.message})})},m.init()}function r(e,t,n,r,a,o,i,s,l,c,u,d,p,f,g,m,h){var y=this;y.init=function(){y.labelType=c,y.valueType=u,y.patentIndexType=d,y.patentLabelSource=p,y.enterpriseInfomationIndexType=f,y.enterpriseInfomationLabelSource=g,y.enterpriseRequirementIndexType=m,y.enterpriseRequirementLabelSource=h,y.loadMetas(),e.$watch(function(){return y.currentLabel.type},function(e,t){switch(y.indexTypes=[],y.labelSources=[],t!==e&&(delete y.currentLabel.indexType,delete y.currentLabel.source),e){case 1:y.indexTypes=y.patentIndexType,y.labelSources=y.patentLabelSource;break;case 2:y.indexTypes=y.enterpriseInfomationIndexType,y.labelSources=y.enterpriseInfomationLabelSource;break;case 3:y.indexTypes=y.enterpriseRequirementIndexType,y.labelSources=y.enterpriseRequirementLabelSource}}),e.$watch(function(){return y.currentLabel.type+","+y.currentLabel.valueType},function(e,t){if(e!==t&&y.allMetas){var n=e.substring(0,e.indexOf(",")),r=e.substring(e.indexOf(",")+1);y.metas=[];for(var a=0;a<y.allMetas.length;a++){var o=y.allMetas[a];o.type==n&&o.valueType==r&&y.metas.push(o)}}}),y.title="添加标签",y.currentLabel={type:1,showInProcess:0,isRequired:0,isMultiple:0},"update"==o.model&&(y.currentLabel=o.label,y.title="编辑标签")},y.notEmpty=function(e){return!!e},y.cancel=function(){t.dismiss("cancel")},y.ok=function(){if(!y.currentLabel)return void y.init();var e=!1;if(y.currentLabel.type||(n.toast({type:"error",body:"请先选择标签类型"}),e=!0),y.currentLabel.valueType||(n.toast({type:"error",body:"请先选择标签值类型"}),e=!0),!e){var r;delete y.currentLabel.user,r="update"==o.model?s.update(y.currentLabel):s.add(y.currentLabel),r.then(function(e){e&&0===e.code?(n.toast({type:"success",body:"编辑成功"}),t.close(0)):n.toast({type:"error",body:"编辑失败"})}).catch(function(e){n.errHandler(e)})}},y.loadMetas=function(){i.getAllMetas({pageSize:0,pageNum:0}).then(function(e){if(e&&0===e.code){y.allMetas=e.result,y.metas=[];for(var t=0;t<y.allMetas.length;t++){var r=y.allMetas[t];r.type==y.currentLabel.type&&r.valueType==y.currentLabel.valueType&&y.metas.push(r)}}else n.toast({type:"error",body:"获取元数据列表失败"})}).catch(function(e){n.errHandler(e)})},y.init()}function a(e,t,n,r,a){var o=this;o.init=function(){o.currentLabel=a.label},o.cancel=function(){t.dismiss("cancel")},o.init()}e.module("Configuration").controller("LabelController",["ToastService","ModalService","LabelService","MetaService","$log","$scope","LABEL_TYPE","VALUE_TYPE","PATENT_INDEX_TYPE","PATENT_LABEL_SOURCE","ENTERPRISE_INFO_INDEX_TYPE","ENTERPRISE_INFO_LABEL_SOURCE","ENTERPRISE_REQUIREMENT_INDEX_TYPE","ENTERPRISE_REQUIREMENT_LABEL_SOURCE",n]).controller("LabelEditCtrl",["$scope","$uibModalInstance","ToastService","HttpService","$log","labelConfig","MetaService","LabelService","ModalService","LABEL_TYPE","VALUE_TYPE","PATENT_INDEX_TYPE","PATENT_LABEL_SOURCE","ENTERPRISE_INFO_INDEX_TYPE","ENTERPRISE_INFO_LABEL_SOURCE","ENTERPRISE_REQUIREMENT_INDEX_TYPE","ENTERPRISE_REQUIREMENT_LABEL_SOURCE",r]).controller("LabelViewerCtrl",["$scope","$uibModalInstance","ToastService","$log","labelConfig",a])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(t,n,r,a,o,i,s,l){var c=this;e.merge(c,a),c.nodeTypes=s,c.selectedNodeType=c.nodeTypes[0],c.showsLabelForm=!1,c.labelset=l,c.labels=c.labelset.labelsetLabels.filter(function(e){return 0!==e.parentId&&!e.parentId}),c.tree={id:0,name:c.labelset.name,type:1,children:c.labelset.labelsetLabels.filter(function(e){return 0===e.parentId})},c.findTreeNode=function(e,t){if(e.id===t)return e;for(var n in e.children){var r=c.findTreeNode(e.children[n],t);if(r)return r}return null},c.findParentTreeNode=function(e,t){for(var n in e.children){var r=e.children[n];if(r.id===t)return e;var a=c.findParentTreeNode(r,t);if(a)return a}return null},c.onChartCtrlAware=function(e){c.treeCtrl=e},c.onTreeSelected=function(e){c.selectedLabel=c.labelset.labelsetLabels.filter(function(t){return e.id===t.id})[0],c.selectedLabel||(c.selectedLabel=c.tree)},c.refreshTree=function(){c.treeCtrl&&c.treeCtrl.setOption()},c.showLabelForm=function(){c.showsLabelForm=!0},c.hideLabelForm=function(){c.showsLabelForm=!1},c.addLabelsToTree=function(){if(0===c.labels.filter(function(e){return e.selected}).length)return void r.toast({type:"error",body:"请至少选择一个标签！"});for(var e=c.labels.length;e--;){var t=c.labels[e];if(t.selected){t.type=c.selectedNodeType.id;c.labelset.labelsetLabels.filter(function(e){return t.id===e.id})[0].parentId=c.selectedLabel.id;var n=c.findTreeNode(c.tree,c.selectedLabel.id);n.children||(n.children=[]),n.children.push(t),c.labels.splice(e,1)}}c.refreshTree()},c.getChildrenLabels=function(){if(n.log("self.selectedLabel",c.selectedLabel),!c.selectedLabel||0===c.selectedLabel.type)return[];var e=c.selectedLabel.children.map(function(e){return e.id});n.log("childLabelIds",e);var t=c.labelset.labelsetLabels.filter(function(t){return e.indexOf(t.id)>=0});return n.log("labels",t),t},c.removeNode=function(){if(c.selectedLabel){if(0===c.selectedLabel.id)return void r.toast({type:"error",body:"请不能移除根节点！"});if(c.selectedLabel.children&&c.selectedLabel.children.length>0)return void r.toast({type:"error",body:"请先移除叶子节点的子节点！"});delete c.selectedLabel.parentId,c.selectedLabel.selected=!1;for(var e=c.findParentTreeNode(c.tree,c.selectedLabel.id),t=0;t<e.children.length;t++){var n=e.children[t];if(n.id===c.selectedLabel.id){e.children.splice(t,1);break}}for(var a=c.labelset.labelsetLabels.filter(function(t){return e.id===t.id})[0],t=0;t<a.children.length;t++){var n=a.children[t];if(n.id===c.selectedLabel.id){a.children.splice(t,1);break}}c.labels.push(c.selectedLabel),delete c.selectedLabel,c.refreshTree()}},c.onChange=function(e,t){},c.cancel=function(){t.dismiss("cancel")},c.ok=function(){i.update(c.labelset).then(function(e){e&&0===e.code?t.close(e.result):r.toast({type:"error",body:e.message})}).catch(function(e){r.toast({type:"error",body:e.message})})}}function r(t,n,r,a,o,i,s){var l=this;e.merge(l,a),l.labelset=s,l.labels=[],l.loading=!1,l.labelKeyword="",l.labelsetKeyword="",l.allSelected=!1,l.setLabelAllSelected=!1,l.cancel=function(){t.dismiss("cancel")},l.getLabelType=function(){switch(l.labelset.type){case 1:case 2:case 3:case 4:case 5:return 1;case 6:return 2;case 7:return 3;case 8:return 4}},l.isAllSelected=function(){return l.labels&&l.labels.length>0&&l.labels.every(function(e){return e.selected})},l.selectAllLabels=function(){if(l.labels&&l.labels.length>0){var t=n("filter");e.forEach(t(l.labels,l.labelKeyword),function(e){e.selected=l.allSelected})}},l.isAllSetLabelSelected=function(){return l.labelset&&l.labelset.labelsetLabels.length>0&&l.labelset.labelsetLabels.every(function(e){return e.selected||0===e.parentId})},l.selectAllSetLabels=function(){if(l.labelset&&l.labelset.labelsetLabels.length>0){var t=n("filter");e.forEach(t(l.labelset.labelsetLabels,l.labelsetKeyword),function(e){0===e.parentId||e.parentId||(e.selected=l.setLabelAllSelected)})}},l.getAddedLabelIds=function(){return l.labelset.labelsetLabels.map(function(e){return e.labelId})},l.addLabels=function(){if(0===l.labels.filter(function(e){return e.selected}).length)return void r.toast({type:"warn",body:"请至少选择一个标签！"});for(var e=l.labels.length;e--;){var t=l.labels[e];t.selected&&(l.labelset.labelsetLabels.unshift({labelsetId:l.labelset.id,labelId:t.id,label:t,type:0,name:t.name,weight:0}),l.labels.splice(e,1))}},l.removeLabels=function(){if(0===l.labelset.labelsetLabels.filter(function(e){return e.selected}).length)return void r.toast({type:"warn",body:"请至少选择一个标签！"});for(var e=l.labelset.labelsetLabels.length;e--;){var t=l.labelset.labelsetLabels[e];t.selected&&(t.label.selected=!1,l.labels.unshift(t.label),l.labelset.labelsetLabels.splice(e,1))}},l.findLabels=function(){var t={pageSize:9999,pageNum:1,name:l.labelKeyword,type:l.getLabelType()};o.search(t).then(function(t){if(t&&0===t.code){l.labels.splice(0,l.labels.length);var n=l.getAddedLabelIds();e.forEach(t.result.list,function(e){n.indexOf(e.id)<0&&l.labels.push(e)})}else r.toast({type:"error",body:"获取标签失败"})}).catch(r.errHandler)},l.ok=function(){i.update(l.labelset).then(function(e){e&&0===e.code?t.close(e.result):r.toast({type:"error",body:e.message})}).catch(function(e){r.toast({type:"error",body:e.message})})},l.findLabels()}function a(t,n,r,a){var o=this;e.merge(o,r),o.loading=!1,o.labelset={version:"1",type:"1",name:""},o.cancel=function(){t.dismiss("cancel")},o.ok=function(){o.loading=!0,a.add(o.labelset).then(function(e){o.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){o.loading=!1,n.toast({type:"error",body:e.message})})}}function o(e,n,r,a){var o=this;e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()}),o.loading=!1,o.contextPath=t,o.maxDate=Date.now(),o.searchCondition={type:""},o.paginationConf={currentPage:1,itemsPerPage:10},o.onDatetimeRangeChanged=function(e,t){o.searchCondition.fromTime=e?e.toDate().getTime():e,o.searchCondition.toTime=t?t.toDate().getTime():t},e.$watch(function(){return o.paginationConf.itemsPerPage+" "+o.paginationConf.currentPage},o.search),o.search=function(){o.loading=!0,r.search(o.searchCondition).then(function(e){o.loading=!1,0===e.code?(o.paginationConf.totalItems=e.result.total,o.labelsets=e.result.list):n.toast({type:"error",body:e.message})}).catch(function(e){o.loading=!1,n.errHandler(e)})},o.add=function(){a.addLabelset().then(function(e){n.toast({type:"success",body:"添加标签体系成功！"}),o.search()}).catch(function(e){n.errHandler(e)})},o.toggleState=function(e){o.loading=!0;var t={id:e.id,state:0===e.state?1:0};r.toggleState(t).then(function(t){o.loading=!1,0===t.code?(e.state=0===e.state?1:0,n.toast({type:"success",body:"标签体系"+(0===e.state?"禁用":"启用")+"成功！"})):n.toast({type:"error",body:t.message})}).catch(function(e){o.loading=!1,n.errHandler(e)})},o.addLabels=function(e){a.addLabelsetLabels(e).then(function(e){n.toast({type:"success",body:"添加标签体系标签成功！"}),o.search()}).catch(function(e){n.errHandler(e)})},o.addLabelsetRelation=function(e){a.addLabelsetRelation(e).then(function(e){n.toast({type:"success",body:"设置标签体系标签关系成功！"}),o.search()}).catch(function(e){n.errHandler(e)})},o.search()}
e.module("Configuration").controller("LabelsetController",["$scope","ToastService","LabelsetService","LabelsetAction",o]).controller("AddLabelsetController",["$uibModalInstance","ToastService","FormService","LabelsetService",a]).controller("LabelsetLabelsController",["$uibModalInstance","$filter","ToastService","FormService","LabelService","LabelsetService","labelset",r]).controller("LabelsetRelationController",["$uibModalInstance","$log","ToastService","FormService","LabelService","LabelsetService","TREE_NODE_TYPES","labelset",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.search=function(n){return e.get(t+"/api/labelset/search",n)},this.add=function(n){return e.put(t+"/api/labelset/",n)},this.update=function(n){return e.post(t+"/api/labelset/",n)},this.toggleState=function(n){return e.post(t+"/api/labelset/state",n)},this.getLabelsetLabels=function(n){return e.get(t+"/api/labelset/labels/"+n)}}function r(n,r){this.addLabelset=function(){return r.open({animation:!0,templateUrl:t+"/static/tpls/configuration/labelset/addLabelset.html",controller:"AddLabelsetController",controllerAs:"addLabelset",size:"lg"}).result},this.addLabelsetLabels=function(n){return r.open({animation:!0,templateUrl:t+"/static/tpls/configuration/labelset/addLabelsetLabel.html",controller:"LabelsetLabelsController",controllerAs:"labelsetLabel",size:"lg",resolve:{labelset:function(){return e.copy(n)}}}).result},this.addLabelsetRelation=function(n){return r.open({animation:!0,templateUrl:t+"/static/tpls/configuration/labelset/addLabelsetLabelRelation.html",controller:"LabelsetRelationController",controllerAs:"labelsetRelation",size:"lg",resolve:{labelset:function(){return e.copy(n)}}}).result}}e.module("Configuration").service("LabelsetService",["HttpService",n]).service("LabelsetAction",["LabelsetService","$uibModal",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,t,n,r,a,o,i,s){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var l=this;l.mode=1,l.init=function(){l.backUrl=n.absUrl(),l.processTypes=s.filter(function(e){return e.show}),l.allSelected=!1,l.loading=!1,l.paginationConf={currentPage:1,itemsPerPage:10},l.reset(),e.$watch(function(){return l.paginationConf.itemsPerPage+" "+l.paginationConf.currentPage},l.search)},l.reset=function(){l.ans=null,l.searchCondition={}},l.onDatetimeRangeChanged=function(e,t,n){"ad"==e?(l.searchCondition.fromAd=t?t.toDate().getTime():t,l.searchCondition.toAd=n?n.toDate().getTime():n):"od"==e&&(l.searchCondition.fromOd=t?t.toDate().getTime():t,l.searchCondition.fromPd=t?t.toDate().getTime():t,l.searchCondition.toOd=n?n.toDate().getTime():n,l.searchCondition.toPd=n?n.toDate().getTime():n)},l.onPatentTypeSelected=function(e){l.searchCondition.types=[],null!=e&&e.forEach(function(e){l.searchCondition.types.push(null==e.value?e.name:e.value)})},l.onLegalStatusSelected=function(e){l.searchCondition.lastLegalStatus=[],null!=e&&e.forEach(function(e){l.searchCondition.lastLegalStatus.push(null==e.value?e.name:e.value)})},l.changeAllSelected=function(){l.patents.forEach(function(e){e.selected=l.allSelected})},l.changeSelected=function(){var e=l.patents.filter(function(e){return e.selected}).length;l.allSelected=e==l.patents.length},l.search=function(){l.loading=!0,l.searchCondition.pageSize=l.paginationConf.itemsPerPage,l.searchCondition.pageNum=l.paginationConf.currentPage,l.searchCondition.ti=e.nullIfSpaceOrEmpty(l.searchCondition.ti),l.searchCondition.an=e.nullIfSpaceOrEmpty(l.searchCondition.an),l.searchCondition.ans=null==e.nullIfSpaceOrEmpty(l.ans)?null:e.nullIfSpaceOrEmpty(l.ans).replace(/\n/g,",").split(","),l.searchCondition.onm=e.nullIfSpaceOrEmpty(l.searchCondition.onm),l.searchCondition.pnm=e.nullIfSpaceOrEmpty(l.searchCondition.pnm),l.searchCondition.pa=e.nullIfSpaceOrEmpty(l.searchCondition.pa),l.searchCondition.pin=e.nullIfSpaceOrEmpty(l.searchCondition.pin),l.searchCondition.username=e.nullIfSpaceOrEmpty(l.searchCondition.username),i.search(l.mode,l.searchCondition).then(function(e){l.loading=!1,0===e.code?(l.paginationConf.totalItems=e.result.total,l.patents=[],e.result.list.forEach(function(e){l.patents.push({selected:!1,data:e})}),l.searching=!1):a.toast({type:"error",body:e.message})}).catch(function(e){l.loading=!1,a.errHandler(e)})},l.startProcess=function(e,t){var n=[];if(null==t?l.patents.forEach(function(e){e.selected&&n.push(e.data)}):n.push(t),0==n.length)return void a.toast({type:"warn",body:"请至少选择一个专利！"});if(3==e&&n.filter(function(e){return null!=e.valueIndexOrder}).length>0){var o="专利已进行评估，是否启动？";n.length>1&&(o="部分专利已进行评估，是否启动？"),r.openAlert({title:"提示",message:o}).then(function(t){0===t&&l.request(e,n)}).catch(function(e){$log.info(e)})}else l.request(e,n)},l.request=function(e,t){l.loading=!0,i.startProcess(e,t).then(function(n){if(n&&0===n.code)switch(a.toast({type:"success",body:n.result}),e){case 2:t.forEach(function(e){e.index||(e.index={}),e.index.hasBaseIndexing=1});break;case 3:t.forEach(function(e){e.index||(e.index={}),e.index.hasValueIndexing=1});break;case 4:t.forEach(function(e){e.index||(e.index={}),e.index.hasPriceIndexing=1});break;case 5:t.forEach(function(e){e.index||(e.index={}),e.index.hasDeepIndexing=1})}else a.toast({type:"info",body:n.message})}).catch(function(e){a.toast({type:"error",body:e.message})}).finally(function(){l.loading=!1})},l.init()}e.module("Patent").controller("PatentProcessStartController",["$scope","$filter","$location","ModalService","ToastService","PatentService","PatentStartService","PATENT_PROCESS_TYPE",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.search=function(n,r){return e.get(t+"/api/patent/start/search/"+n,r)},this.startProcess=function(n,r){return e.post(t+"/api/patent/start/process/"+n,r)}}e.module("Patent").service("PatentStartService",["HttpService",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(t,n,r,a,o){var i=this;e.merge(i,r),i.init=function(){i.loading=!1,i.process={name:""},i.title="添加流程模版","update"==o.action&&(i.process=o.process,i.title="修改流程模版")},i.cancel=function(){t.dismiss("cancel")},i.ok=function(){i.loading=!0,a.edit(i.process).then(function(e){i.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.toast({type:"error",body:e.message})})},i.init()}function r(t,n,r,a,o,i){var s=this;e.merge(s,r),s.init=function(){s.loading=!1,s.labelsets=[],s.process=i.process,s.getAllLabelsets()},s.getAllLabelsets=function(){var e={pageSize:9999,pageNum:1};a.search(e).then(function(e){e&&0===e.code?s.labelsets=s.labelsets.concat(e.result.list):n.toast({type:"error",body:"获取标签体系失败"})}).catch(n.errHandler)},s.cancel=function(){t.dismiss("cancel")},s.ok=function(){s.loading=!0,o.setLabelset(s.process).then(function(e){s.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,n.toast({type:"error",body:e.message})})},s.init()}function a(t,n,r,a,o){var i=this;e.merge(i,r),i.init=function(){i.loading=!1,i.process=o.process},i.cancel=function(){t.dismiss("cancel")},i.ok=function(){i.loading=!0,a.changeTime(i.process).then(function(e){i.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.toast({type:"error",body:e.message})})},i.init()}function o(e,n,r,a,o){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var i=this;i.init=function(){i.loading=!1,i.contextPath=t,i.maxDate=Date.now(),i.searchCondition={},i.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return i.paginationConf.itemsPerPage+" "+i.paginationConf.currentPage},i.search)},i.reset=function(){i.searchCondition={}},i.onDatetimeRangeChanged=function(e,t){i.searchCondition.fromTime=e?e.toDate().getTime():e,i.searchCondition.toTime=t?t.toDate().getTime():t},i.search=function(){i.loading=!0,i.searchCondition.pageSize=i.paginationConf.itemsPerPage,i.searchCondition.pageNum=i.paginationConf.currentPage,a.search(i.searchCondition).then(function(e){i.loading=!1,0===e.code?(i.paginationConf.totalItems=e.result.total,i.processes=e.result.list,i.searching=!1):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.errHandler(e)})},i.add=function(){o.processEditer({action:"add"}).then(function(e){n.toast({type:"success",body:"添加流程模版成功！"}),i.search()}).catch(function(e){n.errHandler(e)})},i.update=function(e){o.processEditer({action:"update",process:e}).then(function(e){n.toast({type:"success",body:"修改流程模版成功！"}),i.search()}).catch(function(e){n.errHandler(e)})},i.setLabelset=function(e){o.setLabelset({process:e,labelsets:i.labelsets}).then(function(e){n.toast({type:"success",body:"标签体系设置成功！"}),i.search()}).catch(function(e){n.errHandler(e)})},i.removeLabelset=function(e){r.openAlert({title:"提示",message:"您确定要删除该流程模版的标签体系吗?"}).then(function(t){0===t&&a.removeLabelset(e).then(function(e){e&&0===e.code&&(i.search(),n.toast({type:"success",body:e.result}))}).catch(function(e){n.toast({type:"error",body:e.message})})}).catch(function(e){$log.info(e)})},i.changeState=function(e){a.changeState(e).then(function(e){e&&0===e.code&&(i.search(),n.toast({type:"success",body:e.result}))}).catch(function(e){n.toast({type:"error",body:e.message})})},i.changeTime=function(e){o.changeTime({process:e}).then(function(e){n.toast({type:"success",body:"预警时间和超时时间设置成功！"}),i.search()}).catch(function(e){n.errHandler(e)})},i.init()}e.module("Configuration").controller("ProcessController",["$scope","ToastService","ModalService","ProcessService","ProcessAction",o]).controller("ProcessEditerController",["$uibModalInstance","ToastService","FormService","ProcessService","editConfig",n]).controller("SetLabelsetController",["$uibModalInstance","ToastService","FormService","LabelsetService","ProcessService","editConfig",r]).controller("ChangeTimeController",["$uibModalInstance","ToastService","FormService","ProcessService","editConfig",a])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,n){this.search=function(n){return e.get(t+"/api/process/search",n)},this.edit=function(n){return e.post(t+"/api/process/edit",n)},this.changeState=function(n){return e.get(t+"/api/process/changestate/"+n,{})},this.setLabelset=function(n){return e.post(t+"/api/process/setlabelset",n)},this.removeLabelset=function(n){return e.get(t+"/api/process/removelabelset/"+n,{})},this.changeTime=function(n){return e.post(t+"/api/process/changetime",n)}}function r(e,n){this.processEditer=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/process/processEditer.html",controller:"ProcessEditerController",controllerAs:"processEditer",size:"lg",resolve:{editConfig:e}}).result},this.setLabelset=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/process/setLabelset.html",controller:"SetLabelsetController",controllerAs:"setLabelset",size:"lg",resolve:{editConfig:e}}).result},this.changeTime=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/process/changeTime.html",controller:"ChangeTimeController",controllerAs:"changeTime",size:"lg",resolve:{editConfig:e}}).result}}e.module("Configuration").service("ProcessService",["HttpService",n]).service("ProcessAction",["ProcessService","$uibModal",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,t,n,r,a,o){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var i=this;i.loading=!1,i.modifyFlag=o,i.paginationConf={currentPage:1,itemsPerPage:10},i.searchCondition={},i.reset=function(){i.searchCondition={}},i.onDatetimeRangeChanged=function(e,t,n){"ad"===e?(i.searchCondition.fromAd=t?t.toDate().getTime():t,i.searchCondition.toAd=n?n.toDate().getTime():n):"od"===e&&(i.searchCondition.fromOd=t?t.toDate().getTime():t,i.searchCondition.toOd=n?n.toDate().getTime():n,i.searchCondition.fromPd=t?t.toDate().getTime():t,i.searchCondition.toPd=n?n.toDate().getTime():n)},i.onPatentTypeSelected=function(e){i.searchCondition.types=[],null!=e&&e.forEach(function(e){i.searchCondition.types.push(null==e.value?e.name:e.value)})},i.onLegalStatusSelected=function(e){i.searchCondition.lastLegalStatus=[],null!=e&&e.forEach(function(e){i.searchCondition.lastLegalStatus.push(null==e.value?e.name:e.value)})},i.search=function(){i.loading=!0,i.searchCondition.pageSize=i.paginationConf.itemsPerPage,i.searchCondition.pageNum=i.paginationConf.currentPage,i.searchCondition.actInstanceId=e.nullIfSpaceOrEmpty(i.searchCondition.actInstanceId),i.searchCondition.actTaskId=e.nullIfSpaceOrEmpty(i.searchCondition.actTaskId),i.searchCondition.an=e.nullIfSpaceOrEmpty(i.searchCondition.an),i.searchCondition.ti=e.nullIfSpaceOrEmpty(i.searchCondition.ti),i.searchCondition.pa=e.nullIfSpaceOrEmpty(i.searchCondition.pa),i.searchCondition.pin=e.nullIfSpaceOrEmpty(i.searchCondition.pin),i.searchCondition.lastLegalStatus=e.nullIfSpaceOrEmpty(i.searchCondition.lastLegalStatus),a.searchCompletePatents(i.searchCondition).then(function(e){i.loading=!1,0===e.code?(i.paginationConf.totalItems=e.result.total,i.patents=e.result.list,i.searching=!1):r.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,r.errHandler(e)})},e.$watch(function(){return i.paginationConf.itemsPerPage+" "+i.paginationConf.currentPage},i.search),i.search()}function r(t,n,r,a,o,i,s,l,c){t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var u=this;u.loading=!1,u.active=0,u.tabs=c.filter(function(e){return e.show}),u.onTabSelected=function(e){var t=u.tabs[e];t.labels?3===t&&u.refreshTree():u.findPatentLabels(r.id,t)},u.changeText=function(e){return null==e||""==e.trim()?e:e.replace(/;/g,"; ")},u.findPatentDetail=function(e){s.findPatentDetail(e).then(function(e){u.loading=!1,0===e.code?u.patent=e.result:i.toast({type:"error",body:"查询专利详情出错："+e.message})}).catch(function(e){u.loading=!1,i.errHandler(e)})},u.findPatentLabels=function(e,t){t.loading=!0,s.findPatentLabelsByProcessType(e,t.id).then(function(e){t.loading=!1,0===e.code?(t.labels=e.result,3===t.id&&(t.values={},t.labels.forEach(function(e){var n=e.label.key;t.values[n]=e.strValue||e.textValue}),u.getValueLabelsetLabels(t))):i.toast({type:"error",body:"查询专利详情出错："+e.message})}).catch(function(e){t.loading=!1,i.errHandler(e)})},u.onChartCtrlAware=function(e){u.treeCtrl=e},u.getValueLabelsetLabels=function(e){u.treeCtrl&&u.treeCtrl.showLoading(),l.getLabelsetLabels(3).then(function(t){u.treeCtrl&&u.treeCtrl.hideLoading(),0===t.code?(e.labelsetLabels=t.result,u.buildValueTree(e)):i.toast({type:"error",body:t.message})}).catch(function(e){u.treeCtrl&&u.treeCtrl.hideLoading(),i.errHandler(e)})},u.buildValueTree=function(t){var n=t.labelsetLabels.filter(function(e){return 0===e.parentId})[0];e.merge(t.tree,n),u.setValueForTree(t.values,t.tree),u.refreshTree()},u.setValueForTree=function(e,t){if(t){if(t.label){var n=t.label.key;t.value=e[n],t.name=t.name+":"+(t.value||"无")}t.children&&t.children.length>0&&t.children.forEach(function(t){u.setValueForTree(e,t)})}},u.refreshTree=function(){u.treeCtrl&&o(function(){u.treeCtrl.setOption()},100)},u.tabs.forEach(function(e){3===e.id&&(e.values={},e.tree={id:0,name:"专利价值评估"},e.labels||u.findPatentLabels(r.id,e))}),u.findPatentDetail(r.id)}e.module("Search").controller("PatentSearchController",["$scope","$state","$stateParams","ToastService","PatentSearchService","modifyFlag",n]).controller("PatentDetailController",["$scope","$state","$stateParams","$log","$timeout","ToastService","PatentSearchService","LabelsetService","PATENT_PROCESS_TYPE",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.searchCompletePatents=function(n){return e.get(t+"/api/search/patent/",n)},this.findPatentDetail=function(n){return e.get(t+"/api/search/patent/"+n)},this.findPatentLabelsByProcessType=function(n,r){return e.get(t+"/api/search/patent/"+n+"/"+r+"/labels/latest")}}e.module("Search").service("PatentSearchService",["HttpService",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(t,n,r,a){var o=this;e.merge(o,r),o.init=function(){o.loading=!1,o.processTask={name:""}},o.cancel=function(){t.dismiss("cancel")},o.ok=function(){o.loading=!0,a.add(o.processTask).then(function(e){o.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){o.loading=!1,n.toast({type:"error",body:e.message})})},o.init()}function r(t,n,r,a,o){var i=this;e.merge(i,r),i.init=function(){i.loading=!1,i.processTask=o.processTask},i.cancel=function(){t.dismiss("cancel")},i.ok=function(){i.loading=!0,a.changeTime(i.processTask).then(function(e){i.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){i.loading=!1,n.toast({type:"error",body:e.message})})},i.init()}function a(t,n,r,a,o,i,s,l,c){var u=this;e.merge(u,i),u.init=function(){u.loading=!1,u.processTask=c.processTask,u.sourceObject={labels:[],keyword:"",allSelected:!1},u.targetObject={labels:[],keyword:"",allSelected:!1},u.processes=[],u.getAllProcesses()},u.getAllSourceLabels=function(e){e.forEach(function(e){0==u.targetObject.labels.length?u.sourceObject.labels.push({selected:!1,id:e.label.id,name:e.label.name,source:e.label.source}):0==u.targetObject.labels.filter(function(t){return e.label.id==t.id}).length&&u.sourceObject.labels.push({selected:!1,id:e.label.id,name:e.label.name,source:e.label.source})})},u.getAllTargetLabels=function(e){e.forEach(function(e){u.targetObject.labels.push({selected:!1,id:e.label.id,name:e.label.name,source:e.label.source})})},u.changeProcess=function(){return u.sourceObject.allSelected=!1,u.targetObject.allSelected=!1,null==u.process&&null==u.processTask.process?(u.sourceObject.labels=[],void(u.targetObject.labels=[])):u.process==u.processTask.process?(u.getAllTargetLabels(u.processTask.labels),void(null!=u.process&&null!=u.process.labelset?u.getAllSourceLabels(u.process.labelset.labelsetLabels):u.sourceObject.labels=[])):(u.targetObject.labels=[],void(null!=u.process&&null!=u.process.labelset?u.getAllSourceLabels(u.process.labelset.labelsetLabels):u.sourceObject.labels=[]))},u.getAllProcesses=function(){var e={pageSize:9999,pageNum:1};s.search(e).then(function(e){if(e&&0===e.code){if(u.processes=u.processes.concat(e.result.list),null!=u.processTask.processId){var t=u.processes.filter(function(e){return e.id==u.processTask.processId});t.length>0&&(u.process=t[0])}null!=u.processTask.labels&&u.getAllTargetLabels(u.processTask.labels),null!=u.process&&null!=u.process.labelsetId&&u.getAllSourceLabels(u.process.labelset.labelsetLabels)}else a.toast({type:"error",body:"获取流程模版失败"})}).catch(a.errHandler)},u.addLabels=function(){var t=u.targetObject.labels.length;if(0==t)return void a.toast({type:"warn",body:"请至少选择一个标签！"});for(;t--;){var n=u.targetObject.labels[t];if(n.selected&&n.name.indexOf(u.targetObject.keyword)>=0){var r=e.copy(n);r.selected=!1,u.sourceObject.labels.unshift(r),u.targetObject.labels.splice(t,1)}}u.clearSelectedState()},u.removeLabels=function(){var t=u.sourceObject.labels.length;if(0==t)return void a.toast({type:"warn",body:"请至少选择一个标签！"});for(;t--;){var n=u.sourceObject.labels[t];if(n.selected&&n.name.indexOf(u.sourceObject.keyword)>=0){var r=e.copy(n);r.selected=!1,u.targetObject.labels.unshift(r),u.sourceObject.labels.splice(t,1)}}u.clearSelectedState()},u.clearSelectedState=function(){u.sourceObject.allSelected=!1,u.targetObject.allSelected=!1,u.sourceObject.labels.forEach(function(e){e.selected=!1}),u.targetObject.labels.forEach(function(e){e.selected=!1})},u.changeAllSelected=function(e){e.labels.filter(function(t){return t.name.indexOf(e.keyword)<0}).forEach(function(e){e.selected=!1}),e.labels.filter(function(t){return t.name.indexOf(e.keyword)>=0}).forEach(function(t){t.selected=e.allSelected})},u.changeSelected=function(e){e.labels.filter(function(t){return t.name.indexOf(e.keyword)<0}).forEach(function(e){e.selected=!1});var t=e.labels.filter(function(t){return t.name.indexOf(e.keyword)>=0}).length,n=e.labels.filter(function(t){return t.name.indexOf(e.keyword)>=0&&t.selected}).length;e.allSelected=t==n},u.cancel=function(){n.dismiss("cancel")},u.ok=function(){null!=u.process&&0==u.targetObject.labels.length?o.openAlert({title:"提示",message:"没有为环节配置任何标签，确定保存吗?"}).then(function(e){0===e&&u.updateLabels()}).catch(function(e){$log.info(e)}):null==u.process?o.openAlert({title:"提示",message:"没有为环节配置流程模版，确定保存吗?"}).then(function(e){0===e&&u.updateLabels()}).catch(function(e){$log.info(e)}):u.updateLabels()},u.updateLabels=function(){u.loading=!0,u.processTask.processId=null==u.process?null:u.process.id,u.processTask.labels=[],u.targetObject.labels.forEach(function(e){u.processTask.labels.push({labelId:e.id})}),l.addTaskLabel(u.processTask).then(function(e){u.loading=!1,e&&0===e.code?n.close(e.result):a.toast({type:"error",body:e.message})}).catch(function(e){u.loading=!1,a.toast({type:"error",body:e.message})})},u.init()}function o(t,n,r,a,o,i){var s=this;e.merge(s,r),s.init=function(){s.loading=!1,s.roles=[],s.processTask=i.processTask,s.getAllRoles()},s.getAllRoles=function(){a.getRoles().then(function(e){e&&0===e.code?s.roles=s.roles.concat(e.result):n.toast({type:"error",body:"获取角色失败"})}).catch(n.errHandler)},s.cancel=function(){t.dismiss("cancel")},s.ok=function(){s.loading=!0,o.changeRole(s.processTask).then(function(e){s.loading=!1,e&&0===e.code?t.close(e.result):n.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,n.toast({type:"error",body:e.message})})},s.init()}function i(e,n,r,a,o,i){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var s=this;s.init=function(){s.loading=!1,s.contextPath=t,s.maxDate=Date.now(),s.searchCondition={},s.paginationConf={currentPage:1,itemsPerPage:10},e.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search),s.getAllProcesses()},s.onDatetimeRangeChanged=function(e,t){s.searchCondition.fromTime=e?e.toDate().getTime():e,s.searchCondition.toTime=t?t.toDate().getTime():t},e.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search),s.processes=[],s.getAllProcesses=function(){var e={pageSize:9999,pageNum:1};a.search(e).then(function(e){e&&0===e.code?s.processes=s.processes.concat(e.result.list):n.toast({type:"error",body:"获取流程模版失败"})}).catch(n.errHandler)},s.search=function(){s.loading=!0,s.searchCondition.pageSize=s.paginationConf.itemsPerPage,s.searchCondition.pageNum=s.paginationConf.currentPage,o.search(s.searchCondition).then(function(e){s.loading=!1,0===e.code?(s.paginationConf.totalItems=e.result.total,s.processTasks=e.result.list,s.searching=!1):n.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,n.errHandler(e)})},s.add=function(){i.addProcessTask().then(function(e){n.toast({type:"success",body:"添加环节成功！"}),s.search()}).catch(function(e){n.errHandler(e)})},s.changeState=function(e){o.changeState(e).then(function(e){e&&0===e.code&&(s.search(),n.toast({type:"success",body:e.result}))}).catch(function(e){n.toast({type:"error",body:e.message})})},s.addTaskLabel=function(e){i.addTaskLabel({processTask:e}).then(function(e){n.toast({type:"success",body:"环节配置标签成功！"}),s.search()}).catch(function(e){n.errHandler(e)})},s.changeTime=function(e){i.changeTime({processTask:e}).then(function(e){n.toast({type:"success",body:"预警时间和超时时间设置成功！"}),s.search()}).catch(function(e){n.errHandler(e)})},s.changeRole=function(e){i.changeRole({processTask:e}).then(function(e){n.toast({type:"success",body:"角色设置成功！"}),s.search()}).catch(function(e){n.errHandler(e)})},s.init()}e.module("Configuration").controller("ProcessTaskController",["$scope","ToastService","ModalService","ProcessService","ProcessTaskService","ProcessTaskAction",i]).controller("AddProcessTaskController",["$uibModalInstance","ToastService","FormService","ProcessTaskService",n]).controller("ChangeTimeController",["$uibModalInstance","ToastService","FormService","ProcessTaskService","editConfig",r]).controller("AddTaskLabelController",["$scope","$uibModalInstance","$filter","ToastService","ModalService","FormService","ProcessService","ProcessTaskService","editConfig",a]).controller("ChangeRoleController",["$uibModalInstance","ToastService","FormService","RoleService","ProcessTaskService","editConfig",o])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,n){this.search=function(n){return e.get(t+"/api/processtask/search",n)},this.add=function(n){return e.post(t+"/api/processtask/add",n)},this.changeState=function(n){return e.get(t+"/api/processtask/changestate/"+n,{})},this.changeTime=function(n){return e.post(t+"/api/processtask/changetime",n)},this.addTaskLabel=function(n){return e.post(t+"/api/processtask/addtasklabels",n)},this.changeRole=function(n){return e.post(t+"/api/processtask/changerole",n)}}function r(e,n){this.addProcessTask=function(){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/task/addTask.html",controller:"AddProcessTaskController",controllerAs:"addProcessTask",size:"lg"}).result},this.addTaskLabel=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/task/addTaskLabel.html",controller:"AddTaskLabelController",controllerAs:"addTaskLabel",size:"lg",resolve:{editConfig:e}}).result},this.changeTime=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/task/changeTime.html",controller:"ChangeTimeController",controllerAs:"changeTime",size:"lg",resolve:{editConfig:e}}).result},this.changeRole=function(e){return n.open({animation:!0,templateUrl:t+"/static/tpls/configuration/task/changeRole.html",controller:"ChangeRoleController",controllerAs:"changeRole",size:"lg",resolve:{editConfig:e}}).result}}e.module("Configuration").service("ProcessTaskService",["HttpService",n]).service("ProcessTaskAction",["ProcessTaskService","$uibModal",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,t,n,r,a,o,i){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var s=this;s.init=function(){s.loading=!1,s.paginationConf={currentPage:1,itemsPerPage:10},s.reset(),s.getAllUsers(),e.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search)},s.reset=function(){s.query={state:1},s.nationalEconomyField=null,s.currentNationalEconomyField=null,s.region=null},s.getAllUsers=function(){o.getUsers(1,9999).then(function(e){e&&0===e.code?s.users=e.result.list:a.toast({type:"error",body:"获取用户失败"})}).catch(a.errHandler)},s.openNationalDlg=function(){r.openNationalDlg(s.nationalEconomyField).then(function(t){s.nationalEconomyField=t,s.currentNationalEconomyField=e.getNationalEconomy(t)}).catch(function(e){$log.info(e)})},s.openRegionDlg=function(){r.openRegionDlg(s.region).then(function(e){s.region=e}).catch(function(e){$log.info(e)})},s.onDatetimeRangeChanged=function(e,t,n){s.query.optDateFrom=t?t.toDate().getTime():t,s.query.optDateTo=n?n.toDate().getTime():n},s.search=function(){s.loading=!0,s.query.pageSize=s.paginationConf.itemsPerPage,s.query.pageNum=s.paginationConf.currentPage,s.query.name=e.nullIfSpaceOrEmpty(s.query.name),s.query.nationalEconomyField=null==s.currentNationalEconomyField?null:s.currentNationalEconomyField.code,s.query.provinceId=null==s.region?null:null==s.region.t1?null:s.region.t1.id,s.query.cityId=null==s.region?null:null==s.region.t2?null:s.region.t2.id,s.query.districtId=null==s.region?null:null==s.region.t3?null:s.region.t3.id,i.searchCompleteEnterprises(s.query).then(function(e){s.loading=!1,0===e.code?(s.paginationConf.totalItems=e.result.total,s.enterprises=e.result.list,s.searching=!1):a.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,a.errHandler(e)})},s.init()}function r(e,t,n,r,a,o){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var i=this;i.basicLoading=!1,i.detailLoading=!1,i.findEnterpriseDetail=function(e){o.detail(e).then(function(e){i.basicLoading=!1,0===e.code?i.enterprise=e.result:a.toast({type:"error",body:"查询企业信息出错："+e.message})}).catch(function(e){i.basicLoading=!1,a.errHandler(e)})},i.findLabels=function(e){i.detailLoading=!0,o.labels(e).then(function(e){i.detailLoading=!1,0===e.code?i.labels=e.result:a.toast({type:"error",body:"查询企业详情出错："+e.message})}).catch(function(e){i.detailLoading=!1,a.errHandler(e)})},i.findEnterpriseDetail(n.id),i.findLabels(n.id)}e.module("Search").controller("EnterpriseSearchController",["$scope","$state","$stateParams","ModalService","ToastService","UserService","EnterpriseSearchService",n]).controller("EnterpriseDetailController",["$scope","$state","$stateParams","$log","ToastService","EnterpriseSearchService",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.searchCompleteEnterprises=function(n){return e.get(t+"/api/enterprise/",n)},this.detail=function(n){return e.get(t+"/api/enterprise/"+n,{})},this.labels=function(n){return e.get(t+"/api/search/patent/"+n+"/6/labels/latest")}}e.module("Search").service("EnterpriseSearchService",["HttpService",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(t,n,r,a,o,i){t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var s=this;s.init=function(){s.loading=!1,s.reset(),s.paginationConf={currentPage:1,itemsPerPage:10},t.$watch(function(){return s.paginationConf.itemsPerPage+" "+s.paginationConf.currentPage},s.search)},s.reset=function(){s.query={enterprise:{},state:1},s.nationalEconomyField=null,s.currentNationalEconomyField=null,s.region=null},s.openNationalDlg=function(){a.openNationalDlg(s.nationalEconomyField).then(function(e){s.nationalEconomyField=e,s.currentNationalEconomyField=t.getNationalEconomy(e)}).catch(function(e){$log.info(e)})},s.openRegionDlg=function(){a.openRegionDlg(s.region).then(function(e){s.region=e}).catch(function(e){$log.info(e)})},s.onDatetimeRangeChanged=function(e,t,n){s.query.optDateFrom=t?t.toDate().getTime():t,s.query.optDateTo=n?n.toDate().getTime():n},s.search=function(){s.loading=!0,s.query.pageSize=s.paginationConf.itemsPerPage,s.query.pageNum=s.paginationConf.currentPage,s.query.requirement=t.nullIfSpaceOrEmpty(s.query.requirement),s.query.enterprise.name=t.nullIfSpaceOrEmpty(s.query.enterprise.name),s.query.enterprise.nationalEconomyField=null==s.currentNationalEconomyField?null:s.currentNationalEconomyField.code,s.query.enterprise.provinceId=null==s.region?null:null==s.region.t1?null:s.region.t1.id,s.query.enterprise.cityId=null==s.region?null:null==s.region.t2?null:s.region.t2.id,s.query.enterprise.districtId=null==s.region?null:null==s.region.t3?null:s.region.t3.id;var n=e.copy(s.query),r=n.enterprise;r&&(delete n.enterprise,e.forEach(r,function(e,t){n["enterprise."+t]=e})),i.searchCompleteRequirements(n).then(function(e){s.loading=!1,0===e.code?(s.paginationConf.totalItems=e.result.total,s.requirements=e.result.list,s.searching=!1):o.toast({type:"error",body:e.message})}).catch(function(e){s.loading=!1,o.errHandler(e)})},s.init()}function r(e,t,n,r,a,o){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var i=this;i.basicLoading=!1,i.detailLoading=!1,i.findRequirementDetail=function(e){o.detail(e).then(function(e){i.basicLoading=!1,0===e.code?i.requirement=e.result:a.toast({type:"error",body:"查询企业需求出错："+e.message})}).catch(function(e){i.basicLoading=!1,a.errHandler(e)})},i.findLabels=function(e){i.detailLoading=!0,o.labels(e).then(function(e){i.detailLoading=!1,0===e.code?i.labels=e.result:a.toast({type:"error",body:"查询企业需求出错："+e.message})}).catch(function(e){i.detailLoading=!1,a.errHandler(e)})},i.findRequirementDetail(n.id),i.findLabels(n.id)}e.module("Search").controller("RequirementSearchController",["$scope","$state","$stateParams","ModalService","ToastService","RequirementSearchService",n]).controller("RequirementDetailController",["$scope","$state","$stateParams","$log","ToastService","RequirementSearchService",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.searchCompleteRequirements=function(n){return e.get(t+"/api/requirement/",n)},this.detail=function(n){
return e.get(t+"/api/requirement/"+n,{})},this.labels=function(n){return e.get(t+"/api/search/patent/"+n+"/7/labels/latest")}}e.module("Search").service("RequirementSearchService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";function t(e,t,n,r,a,o,i,s,l){l.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var c=this;c.editId=t.params.id,c.findUser=function(){c.editId&&(c.loading=!0,r.findUserById(c.editId).then(function(t){c.loading=!1,0===t.code?(c.user=t.result,c.roleId=c.user.roleId,c.organizationId=c.user.organizationId,c.organization=c.user.organization,c.name=c.user.name,c.username=c.user.username,c.phone=c.user.phone,c.email=c.user.email,e.info(c.user)):a.toast({type:"error",body:"查询用户出错: "+t.message})}))},c.findAllRoles=function(){o.getRoles().then(function(e){0===e.code?c.roles=e.result:a.toast({type:"error",message:e.detailMessage})})},c.findAllOrganizations=function(){s.getOrganizations().then(function(e){0===e.code?c.organizations=e.result:a.toast({type:"error",message:e.detailMessage})})},c.findUser(),c.findAllRoles(),c.findAllOrganizations(),c.hasSelected=function(e){return!!e},c.editUser=function(){var o={formData:{id:c.editId,name:c.name,username:c.username,phone:c.phone,email:c.email,roleId:c.roleId,organizationId:c.organization.id}};return o.formData.username&&o.formData.phone?c.organization?void n.openAlert({title:"提示",message:"您是否要提交?"}).then(function(e){0===e&&r.updateUser(o.formData).then(function(e){0===e.code?(a.toast({type:"success",body:"已完成编辑用户"}),t.go("main.console.system.users")):a.toast({type:"error",body:e.detailMessage})})}).catch(function(t){e.info(t)}):void a.toast({type:"info",body:"您未选择组织机构"}):void a.toast({type:"info",body:"输入用户信息格式不正确"})},c.addUser=function(){var o={formData:{name:c.name,username:c.username,password:c.password,phone:c.phone,email:c.email,roleId:c.roleId,organizationId:c.organization.id}};return o.formData.username&&o.formData.phone?c.organization?void n.openAlert({title:"提示",message:"您是否要提交?"}).then(function(n){0===n&&r.addUser(o.formData).then(function(e){0===e.code?(a.toast({type:"success",body:"已成功添加用户"}),t.go("main.console.system.users")):a.toast({type:"error",body:e.detailMessage})}).catch(function(t){e.info(t)})}).catch(function(t){e.info(t)}):void a.toast({type:"info",body:"您未选择组织机构"}):void a.toast({type:"info",body:"输入用户信息格式不正确"})},c.close=function(){t.go("main.console.system.users")},c.openOrganTree=function(){n.openOrganTree().then(function(e){c.organization=e}).catch(function(t){e.info(t)})}}function n(e,t,n,r,a,o,i,s){var l=this;l.init=function(){l.title="编辑个人信息",l.verifyPassword="",s.getLoginUser().then(function(e){l.user=e}).catch(n.errHandler)},l.cancel=function(){t.dismiss("cancel")},l.ok=function(){o.modifyProfile(l.user).then(function(e){e&&0===e.code&&(n.toast({type:"success",body:"编辑个人信息成功"}),t.close(0))}).catch(n.errHandler)},l.init()}function r(e,t,n,r,a,o,i,s){var l=this;l.init=function(){l.title="修改密码",l.passwordParam={userId:"",oldPassword:"",newPassword:""},l.verifyPassword="",s.getLoginUser().then(function(e){l.passwordParam.userId=e.id}).catch(n.errHandler)},l.checkOldPassword=function(e){return e.inputOldPassword.$dirty&&e.inputOldPassword.$error.required?{hasError:!0,msg:"原密码不能为空！"}:{hasError:!1,msg:""}},l.checkNewPassword=function(e){return e.inputNewPassword.$dirty&&e.inputNewPassword.$error.required?{hasError:!0,msg:"新密码不能为空！"}:e.inputNewPassword.$dirty&&l.passwordParam.oldPassword==l.passwordParam.newPassword?{hasError:!0,msg:"新密码和原密码一样！"}:{hasError:!1,msg:""}},l.checkVerifyPassword=function(e){return e.inputVerifyPassword.$dirty&&e.inputVerifyPassword.$error.required?{hasError:!0,msg:"新密码校验不能为空！"}:e.inputVerifyPassword.$dirty&&l.verifyPassword!=l.passwordParam.newPassword?{hasError:!0,msg:"两次录入的新密码不一样！"}:{hasError:!1,msg:""}},l.canSave=function(e){return""==l.passwordParam.oldPassword||""==l.passwordParam.newPassword||""==l.verifyPassword||(l.checkOldPassword(e).hasError||l.checkNewPassword(e).hasError||l.checkVerifyPassword(e).hasError)},l.cancel=function(){t.dismiss("cancel")},l.ok=function(){o.modifyPassword(l.passwordParam).then(function(e){e&&0===e.code&&(n.toast({type:"success",body:e.result}),t.close(0))}).catch(n.errHandler)},l.init()}e.module("System").controller("UserEditController",["$log","$state","ModalService","UserService","ToastService","RoleService","AuthService","OrganizationService","$scope",t]).controller("ChangePasswordEditerCtrl",["$scope","$uibModalInstance","ToastService","HttpService","$log","UserService","ModalService","AuthService",r]).controller("ChangeProfileEditerCtrl",["$scope","$uibModalInstance","ToastService","HttpService","$log","UserService","ModalService","AuthService",n])}(angular),function(e,t){"use strict";function n(e,t,n,r,a){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var o=this;o.mode=1,o.init=function(){o.allSelected=!1,o.loading=!1,o.paginationConf={currentPage:1,itemsPerPage:10},o.reset(),e.$watch(function(){return o.paginationConf.itemsPerPage+" "+o.paginationConf.currentPage},o.search)},o.reset=function(){o.ans=null,o.searchCondition={}},o.onPatentTypeSelected=function(e){o.searchCondition.types=[],null!=e&&e.forEach(function(e){o.searchCondition.types.push(null==e.value?e.name:e.value)})},o.onLegalStatusSelected=function(e){o.searchCondition.lastLegalStatus=[],null!=e&&e.forEach(function(e){o.searchCondition.lastLegalStatus.push(null==e.value?e.name:e.value)})},o.changeAllSelected=function(){o.patents.forEach(function(e){e.selected=o.allSelected})},o.changeSelected=function(){var e=o.patents.filter(function(e){return e.selected}).length;o.allSelected=e==o.patents.length},o.search=function(){o.loading=!0,o.searchCondition.pageSize=o.paginationConf.itemsPerPage,o.searchCondition.pageNum=o.paginationConf.currentPage,o.searchCondition.ti=e.nullIfSpaceOrEmpty(o.searchCondition.ti),o.searchCondition.an=e.nullIfSpaceOrEmpty(o.searchCondition.an),o.searchCondition.ans=null==e.nullIfSpaceOrEmpty(o.ans)?null:e.nullIfSpaceOrEmpty(o.ans).replace(/\n/g,",").split(","),o.searchCondition.onm=e.nullIfSpaceOrEmpty(o.searchCondition.onm),o.searchCondition.pnm=e.nullIfSpaceOrEmpty(o.searchCondition.pnm),o.searchCondition.pa=e.nullIfSpaceOrEmpty(o.searchCondition.pa),o.searchCondition.pin=e.nullIfSpaceOrEmpty(o.searchCondition.pin),o.searchCondition.username=e.nullIfSpaceOrEmpty(o.searchCondition.username),a.search(o.mode,o.searchCondition).then(function(e){o.loading=!1,0===e.code?(o.paginationConf.totalItems=e.result.total,o.patents=[],e.result.list.forEach(function(e){o.patents.push({selected:!1,data:e})}),o.searching=!1):n.toast({type:"error",body:e.message})}).catch(function(e){o.loading=!1,n.errHandler(e)})},o.start=function(e){e.disabled=!0,a.start(e.id).then(function(t){e.disabled=!1,0===t.code?(n.toast({type:"success",body:t.result}),e.hasBatchIndexed=1):n.toast({type:"error",body:"重新评估失败"})}).catch(function(t){e.disabled=!1,n.errHandler(t)})},o.init()}function r(t,n,r,a,o,i){function s(e){if(e){if(e.label){var t=e.label.key;e.value=l.patent[t],e.name=e.name+":"+e.value}e.children&&e.children.length>0&&e.children.forEach(s)}}t.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var l=this;l.loading=!1,l.tree={id:0,name:"专利价值快速评估"},l.labelGroups=[],l.valueKeys=["patentValue","technologicalValue","economicValue","legalValue"],l.getDetail=function(e){l.loading=!0,a.detail(e).then(function(e){l.loading=!1,0===e.code?(l.patent=e.result,l.patent.assessmentOrder?(l.patent.assessmentOrder.taskOrders.forEach(function(e){e.labels.forEach(function(e){var t=e.label.key;l.patent[t]=e.strValue||e.textValue})}),l.getValueLabelsetLabels()):r.toast({type:"error",body:"此专利尚未进行价值评估！"})):r.toast({type:"error",body:e.message})}).catch(function(e){l.loading=!1,r.errHandler(e)})},l.getValueLabelsetLabels=function(){l.treeCtrl&&l.treeCtrl.showLoading(),o.getLabelsetLabels(1).then(function(t){if(l.treeCtrl&&l.treeCtrl.hideLoading(),0===t.code){l.labelsetLabels=t.result,l.labelGroups.splice(0,l.labelGroups.length);var n=l.labelsetLabels.filter(function(e){return e.parentId>=0});e.forEach(i,function(e){n.push({label:e})});for(var a=n.length%3==0?n.length/3:Math.floor(n.length/3)+1,o=0;o<a;o++)l.labelGroups.push(n.slice(3*o,3*o+3));l.buildValueTree()}else r.toast({type:"error",body:t.message})}).catch(function(e){l.treeCtrl&&l.treeCtrl.hideLoading(),r.errHandler(e)})},l.buildValueTree=function(){var t=l.labelsetLabels.filter(function(e){return 0===e.parentId})[0];e.merge(l.tree,t),s(l.tree),l.refreshTree()},l.refreshTree=function(){l.treeCtrl&&l.treeCtrl.setOption()},l.onChartCtrlAware=function(e){l.treeCtrl=e},l.getDetail(n.id)}e.module("Patent").controller("HumenController",["$scope","$filter","ToastService","PatentService","HumenService",n]).controller("AssessmentController",["$scope","$stateParams","ToastService","HumenService","LabelsetService","EXTRA_VALUE_LABELS",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.search=function(n,r){return e.get(t+"/api/patent/assessment/humen/search/"+n,r)},this.detail=function(n){return e.get(t+"/api/patent/assessment/humen/detail/"+n,{_random:Math.random()})},this.start=function(n){return e.get(t+"/api/patent/assessment/humen/start/"+n,{_random:Math.random()})}}e.module("Patent").service("HumenService",["HttpService",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e,t,n){n.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var r=this;r.init=function(){r.loading=!1,r.paginationConf={currentPage:1,itemsPerPage:10},n.$watch(function(){return r.paginationConf.itemsPerPage+" "+r.paginationConf.currentPage},r.search)},r.search=function(){r.loading=!0,r.searching=!0,e.getIndexError(r.paginationConf).then(function(e){r.loading=!1,0===e.code?(r.searching=!1,r.paginationConf.totalItems=e.result.total,r.list=e.result.list):t.toast({type:"error",body:e.message})}).catch(function(e){r.loading=!1,t.errHandler(e)})},r.init()}function r(e,t,n,r,a){e.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var o=this;o.init=function(){o.loading=!1,o.paginationConf={currentPage:1,itemsPerPage:10},o.timedTaskTypes=a,o.timedTaskStates=[{id:0,name:"未完成"},{id:1,name:"已完成"}],o.reset(),e.$watch(function(){return o.paginationConf.itemsPerPage+" "+o.paginationConf.currentPage},o.search)},o.reset=function(){o.searchCondition={}},o.onDatetimeRangeChanged=function(e,t){o.searchCondition.fromCreateTime=e?e.toDate().getTime():e,o.searchCondition.toCreateTime=t?t.toDate().getTime():t},o.getPercent=function(e){return null==e||null==e.finishAmount||null==e.totalAmount?null:Math.floor(100*e.finishAmount/e.totalAmount)},o.search=function(){o.loading=!0,o.searchCondition.pageSize=o.paginationConf.itemsPerPage,o.searchCondition.pageNum=o.paginationConf.currentPage,r.search(o.searchCondition).then(function(e){o.loading=!1,0===e.code?(o.paginationConf.totalItems=e.result.total,o.tasks=e.result.list,o.searching=!1):n.toast({type:"error",body:e.message})}).catch(function(e){o.loading=!1,n.errHandler(e)})},o.init()}e.module("Patent").controller("TimedTaskController",["$scope","$filter","ToastService","TimedTaskService","TIMED_TASK_TYPE",r]).controller("IndexErrorController",["TimedTaskService","ToastService","$scope",n])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.search=function(n){return e.get(t+"/api/patent/assessment/task/search",n)},this.getIndexError=function(n){return e.get(t+"/api/patent/assessment/humen/indexError/",n)}}e.module("Patent").service("TimedTaskService",["HttpService",n])}(angular,CONTEXT_PATH),function(e){"use strict";function t(e,t,n,r){var a=this;a.loading=!1,a.roleId=e.params.id,a.nodes={id:"0",text:"PMES2.0",icon:"fa fa-circle-o",state:{opened:!0}},a.checkedNodes=[],a.onTreeReady=function(e,t){a.tree=e,a.treeCtrl||(a.treeCtrl=t,a.getAuthorities())},a.authChildren=function(e){if(e.sonAuthorities)return e.sonAuthorities.map(function(e){return{id:e.id,name:e.name,text:e.title,icon:e.pic||"fa fa-file",state:{opened:!0},children:a.authChildren(e)}})},a.getAuthorities=function(){a.loading=!0,n.getAuthorityTreeDataByRoleId(a.roleId).then(function(e){a.loading=!1,a.authorities=e.authorities,a.roleAuthorities=e.roleAuthorities,a.nodes.children=a.authorities.map(function(e){return{id:e.id,name:e.name,text:e.title,state:{opened:!0},icon:e.pic||"fa fa-folder",children:a.authChildren(e)}});var t=function(e){0===e.sonAuthorities.length?a.checkedNodes.push({id:e.id}):e.sonAuthorities.map(t)};a.roleAuthorities.map(t),a.treeCtrl&&a.treeCtrl.refresh()}).catch(function(e){a.loading=!1,t.errHandler(e)})},a.submitAuths=function(){if(!a.tree)return void t.toast({type:"error",body:"权限树未创建！"});var e=a.tree.jstree(!0),n=e.get_checked();if(0===n.length)return void t.toast({type:"error",body:"请至少选择一个权限！"});for(var o=0,i=n.length;o<i;o++){var s=e.get_node(n[o]).parents;n=n.concat(s)}n=$.vakata.array_unique(n.filter(function(e){return"0"!==e&&"#"!==e}).map(function(e){return parseInt(e,10)})),a.loading=!0,r.updateRoleAuth({roleId:a.roleId,authIds:n}).then(function(e){a.loading=!1,e&&0===e.code?t.toast({type:"success",body:"修改角色权限成功！"}):t.toast({type:"error",body:"修改角色权限失败："+e.messasge})}).catch(function(e){a.loading=!1,t.errHandler(e)})}}e.module("System").controller("RoleCheckController",["$state","ToastService","AuthorityService","RoleService",t])}(angular),function(e,t){"use strict";function n(n,r,a,o,i){n.$on("$viewContentLoaded",function(e){$.AdminLTE.layout.fix()});var s=this;s.loading=!1,s.patentId=r.id,s.findDetail=function(){s.loading=!0,i.detail(s.patentId).then(function(e){0===e.code?s.patent=e.result:o.toast({type:"error",body:e.message})}).catch(function(e){o.toast({type:"error",body:e.message})}).finally(function(){s.loading=!1})},s.modifyLabel=function(n,r){s.loading=!0;var l=e.copy(n);a.open({animation:!0,templateUrl:t+"/static/tpls/patent/modify/edit.label.html",controller:"PatentLabelModifyController",size:"lg",resolve:{label:l}}).result.then(function(e){return i.modifyLabel(s.patent.id,e)}).then(function(e){0===e.code?(s.patent.latestLabels[r]=e.result,o.toast({type:"success",body:"修改标签值成功！"})):o.toast({type:"error",body:e.message})}).catch(function(e){"string"!=typeof e&&o.toast({type:"error",body:e.message})}).finally(function(){s.loading=!1})},s.findDetail()}function r(e,t,n){e.label=n,e.ok=function(){(e.label.strValue||e.label.textValue)&&t.close(e.label)},e.cancel=function(){t.dismiss("cancel")}}e.module("Patent").controller("PatentModifyController",["$scope","$stateParams","$uibModal","ToastService","PatentModifyService",n]).controller("PatentLabelModifyController",["$scope","$uibModalInstance","label",r])}(angular,CONTEXT_PATH),function(e,t){"use strict";function n(e){this.detail=function(n){return e.get(t+"/api/patent/"+n,{})},this.modifyLabel=function(n,r){return e.post(t+"/api/patent/"+n+"/label",r)}}e.module("Patent").service("PatentModifyService",["HttpService",n])}(angular,CONTEXT_PATH);